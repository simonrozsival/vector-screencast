var Helpers;!function(t){!function(t){t[t.Silent=0]="Silent",t[t.Normal=1]="Normal",t[t.Verbose=2]="Verbose",t[t.Annoying=3]="Annoying"}(t.LogLevel||(t.LogLevel={}));var e=t.LogLevel,n=function(){function t(){}return t.SetLevel=function(t){this.level=t},t.Log=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];t<=this.level&&console.log(e)},t.level=e.Normal,t}();t.Debug=n}(Helpers||(Helpers={}));var Helpers;!function(t){!function(t){t[t.Warning=0]="Warning",t[t.Fatal=1]="Fatal"}(t.ErrorType||(t.ErrorType={}));var e=t.ErrorType,n=function(){function n(){}return n.TurnOn=function(){this.doLog=!0},n.TurnOff=function(){this.doLog=!1},n.SetLogFunction=function(t){this.LogFunction=t},n.Report=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];this.doLog&&this.LogFunction(t,e)},n.ErrorTypeName=function(t){switch(t){case e.Warning:return"Warning";case e.Fatal:return"Fatal error";default:return"Unknown error type"}},n.doLog=!0,n.LogFunction=function(r,o){if(r===e.Fatal)throw new Error("Fatal Error: "+o.join(";Â "));t.Debug.Log(t.LogLevel.Normal,n.ErrorTypeName(r),o)},n}();t.Errors=n}(Helpers||(Helpers={}));var Helpers;!function(t){var e=function(){function t(t,e){this.x=t,this.y=e}return Object.defineProperty(t.prototype,"X",{get:function(){return this.x},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"Y",{get:function(){return this.y},enumerable:!0,configurable:!0}),t.prototype.isEqualTo=function(t){return this.X===t.X&&this.Y===t.Y},t.prototype.getSize=function(){return Math.sqrt(this.getSizeSq())},t.prototype.getSizeSq=function(){return this.x*this.x+this.y*this.y},t.prototype.distanceTo=function(t){var e=this.x-t.X,n=this.y-t.Y;return Math.sqrt(e*e+n*n)},t.prototype.normalize=function(){var t=this.getSize();if(0===t)throw new Error("Can't normalize zero vector.");return this.scale(1/t),this},t.prototype.getNormal=function(){return new t(-this.y,this.x).normalize()},t.prototype.add=function(t){return this.x+=t.X,this.y+=t.Y,this},t.prototype.subtract=function(t){return this.x-=t.X,this.y-=t.Y,this},t.prototype.scale=function(t){return this.x*=t,this.y*=t,this},t.prototype.pointInBetween=function(e){return new t((this.x+e.X)/2,(this.y+e.Y)/2)},t.prototype.clone=function(){return new t(this.x,this.y)},t}();t.Vector2=e}(Helpers||(Helpers={}));var UI;!function(t){var e=function(){function t(t,e){this.name=t,this.cssValue=e}return Object.defineProperty(t.prototype,"Name",{get:function(){return this.name},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"CssValue",{get:function(){return this.cssValue},enumerable:!0,configurable:!0}),Object.defineProperty(t,"BackgroundColor",{get:function(){return new t(this.backgroundPrototype.Name,this.backgroundPrototype.CssValue)},set:function(t){this.backgroundPrototype=t},enumerable:!0,configurable:!0}),Object.defineProperty(t,"ForegroundColor",{get:function(){return new t(this.foregroundPrototype.Name,this.foregroundPrototype.CssValue)},set:function(t){this.foregroundPrototype=t},enumerable:!0,configurable:!0}),t.backgroundPrototype=new t("Dark gray","#111"),t.foregroundPrototype=new t("White","#fff"),t}();t.Color=e}(UI||(UI={}));var UI;!function(t){var e=function(){function t(t,e,n){this.name=t,this.size=e,this.unit=n}return Object.defineProperty(t.prototype,"Name",{get:function(){return this.name},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"Size",{get:function(){return this.size},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"Unit",{get:function(){return this.unit},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"CssValue",{get:function(){return""+this.size+this.unit},enumerable:!0,configurable:!0}),t}();t.BrushSize=e}(UI||(UI={}));var __extends=this.__extends||function(t,e){function n(){this.constructor=t}for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);n.prototype=e.prototype,t.prototype=new n},Helpers;!function(t){!function(t){t[t.ChangeBrushSize=0]="ChangeBrushSize",t[t.ChangeColor=1]="ChangeColor",t[t.Cursor=2]="Cursor"}(t.StateType||(t.StateType={}));var e=t.StateType,n=function(){function t(t,e){this.type=t,this.time=e}return t.prototype.GetType=function(){return this.type},t.prototype.GetTime=function(){return this.time},t}();t.State=n;var r=function(n){function r(t,r,o,i){n.call(this,e.Cursor,t),this.x=r,this.y=o,this.pressure=i}return __extends(r,n),Object.defineProperty(r.prototype,"X",{get:function(){return this.x},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"Y",{get:function(){return this.y},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"Pressure",{get:function(){return this.pressure},enumerable:!0,configurable:!0}),r.prototype.getPosition=function(){return new t.Vector2(this.x,this.y)},r}(n);t.CursorState=r;var o=function(t){function n(n,r){t.call(this,e.ChangeColor,n),this.color=r}return __extends(n,t),Object.defineProperty(n.prototype,"Color",{get:function(){return this.color},enumerable:!0,configurable:!0}),n}(n);t.ColorState=o;var i=function(t){function n(n,r){t.call(this,e.ChangeBrushSize,n),this.size=r}return __extends(n,t),Object.defineProperty(n.prototype,"Size",{get:function(){return this.size},enumerable:!0,configurable:!0}),n}(n);t.SizeState=i}(Helpers||(Helpers={}));var Helpers;!function(t){var e=function(){function t(){}return t.CreateElement=function(e,n,r){var o=document.createElement(e);if(n&&t.SetAttributes(o,n),r&&Array.isArray(r))for(var i in r)o.appendChild(r[i]);return o},t.SetAttributes=function(t,e){for(var n in e)t.setAttribute(n,e[n])},t}();t.HTML=e}(Helpers||(Helpers={}));var Helpers;!function(t){function e(t,e){return void 0===e&&(e=i),Number(t.toFixed(e))}function n(t,n){return void 0===n&&(n=i),e(t,n).toString()}function r(t){var e,n=Math.floor(t/60);e=n+":";var r=Math.floor(t%60);return e+=9>=r?"0"+r.toString(10):r.toString(10)}function o(t){return r(Math.floor(t/1e3))}var i=3;t.maxDecPlaces=e,t.precise=n,t.secondsToString=r,t.millisecondsToString=o}(Helpers||(Helpers={}));var Helpers;!function(t){var e=t.precise,n=function(){function t(){}return Object.defineProperty(t,"Namespace",{get:function(){return this.namespace},enumerable:!0,configurable:!0}),t.CreateDot=function(t,n,r){return this.CreateElement("circle",{cx:e(t.X),cy:e(t.Y),r:e(n),fill:r,stroke:"transparent"})},t.CreateCircle=function(t,n,r){return n>0?this.CreateElement("circle",{cx:e(t.X),cy:e(t.Y),r:e(n),stroke:r,fill:"transparent","stroke-width":1}):null},t.CreateLine=function(t,n,r,o){return r>0?this.CreateElement("path",{fill:"transparent",stroke:o,"stroke-width":e(r),d:this.MoveToString(t)+" "+this.LineToString(n)}):null},t.CreateElement=function(t,e){var n=document.createElementNS(this.namespace,t);return e&&this.SetAttributes(n,e),n},t.SetAttributes=function(t,e){t||console.log(e);for(var n in e)t.setAttributeNS(null,n,e[n])},t.MoveToString=function(t){return"M "+e(t.X)+","+e(t.Y)},t.LineToString=function(t){return"L "+e(t.X)+","+e(t.Y)},t.CurveToString=function(t,n,r){return"C "+e(t.X)+","+e(t.Y)+" "+e(n.X)+","+e(n.Y)+" "+e(r.X)+","+e(r.Y)},t.ArcString=function(t,n,r){return"A "+e(n)+","+e(n)+" "+r+" 0,0 "+e(t.X)+","+e(t.Y)},t.attr=function(t,e){var n=t.attributes.getNamedItemNS(null,e);if(n)return n.textContent;throw new Error("Attribute "+e+" is missing in "+t.localName)},t.numAttr=function(t,e){return Number(t.attributes.getNamedItemNS(null,e).textContent)},t.namespace="http://www.w3.org/2000/svg",t}();t.SVG=n;var r=function(){function t(){}return Object.defineProperty(t,"Namespace",{get:function(){return this.namespace},enumerable:!0,configurable:!0}),t.CreateElement=function(t,e){var n=document.createElementNS(this.namespace,"a:"+t);return e&&this.SetAttributes(n,e),n},t.SetAttributes=function(t,e){t||console.log(e);for(var n in e){var r=document.createAttributeNS(this.namespace,"a:"+n);r.textContent=e[n],t.attributes.setNamedItemNS(r)}},t.attr=function(t,e,n){var r=t.attributes.getNamedItemNS(this.Namespace,e);if(r)return r.textContent;if(n)return n;throw new Error("Attribute "+e+" is missing in "+t.localName)},t.numAttr=function(e,n,r){return Number(t.attr(e,n,void 0!==r?r.toString():void 0))},t.namespace="http://www.rozsival.com/2015/vector-video",t}();t.SVGA=r}(Helpers||(Helpers={}));var Helpers;!function(t){var e=function(){function e(){}return e.catmullRomToBezier=function(e,r,o,i){return new n(r,new t.Vector2(-1/6*e.X+r.X+1/6*o.X,-1/6*e.Y+r.Y+1/6*o.Y),o,new t.Vector2(1/6*r.X+o.X+-1/6*i.X,1/6*r.Y+o.Y+-1/6*i.Y))},e}();t.Spline=e;var n=function(){function t(t,e,n,r){this.start=t,this.startCP=e,this.end=n,this.endCP=r}return Object.defineProperty(t.prototype,"Start",{get:function(){return this.start},set:function(t){this.start=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"StartCP",{get:function(){return this.startCP},set:function(t){this.startCP=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"End",{get:function(){return this.end},set:function(t){this.end=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"EndCP",{get:function(){return this.endCP},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"EndCp",{set:function(t){this.endCP=t},enumerable:!0,configurable:!0}),t}();t.BezierCurveSegment=n}(Helpers||(Helpers={}));var Helpers;!function(t){!function(t){t[t.Start=0]="Start",t[t.Pause=1]="Pause",t[t.Continue=2]="Continue",t[t.Stop=3]="Stop",t[t.ReachEnd=4]="ReachEnd",t[t.Replay=5]="Replay",t[t.JumpTo=6]="JumpTo",t[t.VideoInfoLoaded=7]="VideoInfoLoaded",t[t.BufferStatus=8]="BufferStatus",t[t.CursorState=9]="CursorState",t[t.ChangeColor=10]="ChangeColor",t[t.ChangeBrushSize=11]="ChangeBrushSize",t[t.StartPath=12]="StartPath",t[t.DrawSegment=13]="DrawSegment",t[t.DrawPath=14]="DrawPath",t[t.CurrentTime=15]="CurrentTime",t[t.Render=16]="Render",t[t.ClearCanvas=17]="ClearCanvas",t[t.RedrawCanvas=18]="RedrawCanvas",t[t.CanvasSize=19]="CanvasSize",t[t.CanvasScalingFactor=20]="CanvasScalingFactor",t[t.RegisterRecordingTool=21]="RegisterRecordingTool",t[t.RecordingToolFinished=22]="RecordingToolFinished",t[t.RecordingFinished=23]="RecordingFinished",t[t.StartUpload=24]="StartUpload",t[t.DownloadData=25]="DownloadData",t[t.VolumeUp=26]="VolumeUp",t[t.VolumeDown=27]="VolumeDown",t[t.Mute=28]="Mute",t[t.Busy=29]="Busy",t[t.Ready=30]="Ready",t[t.length=31]="length"}(t.VideoEventType||(t.VideoEventType={}));var e=t.VideoEventType,n=function(){function t(t){this.type=t,this.listeners=new Array(0)}return Object.defineProperty(t.prototype,"Type",{get:function(){return this.type},enumerable:!0,configurable:!0}),t.prototype.on=function(t){this.listeners.push(t)},t.prototype.off=function(t){var e=this.listeners.indexOf(t);e>=0&&this.listeners.splice(e,1)},t.prototype.trigger=function(t){for(var e=0;e<this.listeners.length;e++){var n=this.listeners[e];n.apply(this,t)}},t.prototype.triggerAsync=function(t,e){setTimeout(function(){t.apply(this,e)},0)},t}(),r=function(){function t(){}return t.on=function(e,r){t.events[e]||(t.events[e]=new n(e)),t.events[e].on(r)},t.off=function(e,n){t.events[e]&&t.events[e].off(n)},t.trigger=function(e){for(var n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];var o=t.events[e];o&&o.trigger(n)},t.events=new Array(e.length),t}();t.VideoEvents=r}(Helpers||(Helpers={}));var UI;!function(t){var e=Helpers.HTML,n=function(){function t(t,n){this.element=t instanceof HTMLElement?t:e.CreateElement(t),n&&(this.element.textContent=n)}return t.prototype.GetHTML=function(){return this.element},t.prototype.HasClass=function(t){return this.GetHTML().classList.contains(t)},t.prototype.AddClass=function(t){return this.AddClasses(t)},t.prototype.AddClasses=function(){for(var t=[],e=0;e<arguments.length;e++)t[e-0]=arguments[e];for(var n=0;n<t.length;n++)this.GetHTML().classList.add(t[n]);return this},t.prototype.RemoveClass=function(t){return this.RemoveClasses(t)},t.prototype.RemoveClasses=function(){for(var t=[],e=0;e<arguments.length;e++)t[e-0]=arguments[e];for(var n=0;n<t.length;n++)this.GetHTML().classList.remove(t[n]);return this},t}();t.SimpleElement=n;var r=function(t){function e(e,r){t.call(this,"button"),this.AddClass("ui-button"),this.content=new n("span",e),this.GetHTML().appendChild(this.content.GetHTML()),r&&(this.GetHTML().onclick=r)}return __extends(e,t),e.prototype.ChangeContent=function(t){return this.content.GetHTML().innerHTML=t,this},e}(n);t.Button=r;var o=function(t){function e(e,r,o){t.call(this,r,o),this.iconClass=e,this.icon=new n("span","").AddClasses("icon",e),this.AddClass("has-icon"),this.GetHTML().appendChild(this.icon.GetHTML())}return __extends(e,t),e.prototype.ChangeIcon=function(t){return this.icon.RemoveClass(this.iconClass).AddClass(t),this.iconClass=t,this},e}(r);t.IconButton=o;var i=function(t){function n(e,n,r){t.call(this,e,"",r),this.ChangeContent(n),this.AddClass("icon-only-button")}return __extends(n,t),n.prototype.ChangeContent=function(t){return e.SetAttributes(this.GetHTML(),{title:t}),this},n}(o);t.IconOnlyButton=i;var a=function(t){function e(e){t.call(this,"p",e)}return __extends(e,t),e}(n);t.Paragraph=a;var s=function(t){function e(e,n){t.call(this,"h"+e,n)}return __extends(e,t),e}(n);t.Heading=s;var u=function(t){function e(e){t.call(this,2,e)}return __extends(e,t),e}(s);t.H2=u;var h=function(){function t(t,n){this.element=e.CreateElement(t),n&&e.SetAttributes(this.element,{id:n}),this.elements=[]}return Object.defineProperty(t.prototype,"Children",{get:function(){return this.elements},enumerable:!0,configurable:!0}),t.prototype.AddChild=function(t){return this.AddChildren(t)},t.prototype.AddChildren=function(){for(var t=[],e=0;e<arguments.length;e++)t[e-0]=arguments[e];for(var n=0;n<t.length;n++)this.elements.push(t[n]),this.GetHTML().appendChild(t[n].GetHTML());return this},t.prototype.GetHTML=function(){return this.element},t.prototype.HasClass=function(t){return this.GetHTML().classList.contains(t)},t.prototype.AddClass=function(t){return this.AddClasses(t)},t.prototype.AddClasses=function(){for(var t=[],e=0;e<arguments.length;e++)t[e-0]=arguments[e];for(var n=0;n<t.length;n++)this.GetHTML().classList.add(t[n]);return this},t.prototype.RemoveClass=function(t){return this.RemoveClasses(t)},t.prototype.RemoveClasses=function(){for(var t=[],e=0;e<arguments.length;e++)t[e-0]=arguments[e];for(var n=0;n<t.length;n++)this.GetHTML().classList.remove(t[n]);return this},t}();t.Panel=h}(UI||(UI={}));var Drawing;!function(t){var e=function(){function t(){}return Object.defineProperty(t.prototype,"Left",{get:function(){throw new Error("Not implemented")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"Right",{get:function(){throw new Error("Not implemented")},enumerable:!0,configurable:!0}),t}();t.Segment=e;var n=function(t){function e(e,n){t.call(this),this.left=e,this.right=n}return __extends(e,t),Object.defineProperty(e.prototype,"Left",{get:function(){return this.left},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"Right",{get:function(){return this.right},enumerable:!0,configurable:!0}),e}(e);t.QuadrilateralSegment=n;var r=function(t){function e(e,n){t.call(this,e,n)}return __extends(e,t),e}(n);t.ZeroLengthSegment=r;var o=function(t){function e(e,n){t.call(this),this.left=e,this.right=n}return __extends(e,t),Object.defineProperty(e.prototype,"Left",{get:function(){return this.left.End},set:function(t){this.left.End=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"Right",{get:function(){return this.right.End},set:function(t){this.right.End=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"LeftBezier",{get:function(){return this.left},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"RightBezier",{get:function(){return this.right},enumerable:!0,configurable:!0}),e}(e);t.CurvedSegment=o}(Drawing||(Drawing={}));var Drawing;!function(t){var e=Helpers.SVG,n=Helpers.Vector2,r=Helpers.VideoEvents,o=Helpers.VideoEventType,i=function(){function e(t,e,n){this.curved=t,this.color=e,this.wireframe=n,void 0===this.wireframe&&(this.wireframe=!1),this.segments=[],this.pathPoints=[]}return Object.defineProperty(e.prototype,"Segments",{get:function(){return this.segments},set:function(t){this.segments=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"LastDrawnSegment",{get:function(){return this.lastDrawnSegment},set:function(t){this.lastDrawnSegment=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"LastPoint",{get:function(){return this.pathPoints[this.iterator]},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"LastButOnePoint",{get:function(){return this.pathPoints[Math.max(0,this.iterator-1)]},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"LastButTwoPoint",{get:function(){return this.pathPoints[Math.max(0,this.iterator-2)]},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"Color",{get:function(){return this.color},enumerable:!0,configurable:!0}),e.prototype.StartPath=function(e,r){this.segments=[new t.ZeroLengthSegment(e.clone().add(new n(0,r)),e.clone().add(new n(0,-r)))],this.startPosition=e,this.startRadius=r,this.iterator=-1,this.DrawStartDot(e,r),this.lastDrawnSegment=this.segments[0]},e.prototype.DrawStartDot=function(t,e){throw new Error("Not impelmented")},e.prototype.InitPath=function(e,n){this.segments=[new t.ZeroLengthSegment(n,e)],this.pathPoints.push({Left:n,Right:e}),this.iterator=0},e.prototype.StartDrawingPath=function(t){this.DrawStartDot(t.Left.pointInBetween(t.Right),t.Left.distanceTo(t.Right)/2),this.lastDrawnSegment=t},e.prototype.ExtendPath=function(t,e){var n=this.CalculateSegment(t,e);this.DrawSegment(n),r.trigger(o.DrawSegment,n),this.segments.push(n),this.pathPoints.push({Left:e,Right:t}),this.iterator++},e.prototype.CalculateSegment=function(t,e){return this.curved?this.CalculateCurvedSegment(t,e):this.CalculateQuarilateralSegment(t,e)},e.prototype.CalculateCurvedSegment=function(e,n){var r=Helpers.Spline.catmullRomToBezier(this.LastButTwoPoint.Left,this.LastButOnePoint.Left,this.LastPoint.Left,n),o=Helpers.Spline.catmullRomToBezier(this.LastButTwoPoint.Right,this.LastButOnePoint.Right,this.LastPoint.Right,e),i=new t.CurvedSegment(r,o);return this.DrawCurvedSegment(i),i},e.prototype.DrawCurvedSegment=function(t){throw new Error("Not implemented")},e.prototype.CalculateQuarilateralSegment=function(e,n){return new t.QuadrilateralSegment(n,e)},e.prototype.DrawQuadrilateralSegment=function(t){throw new Error("Not implemented")},e.prototype.Draw=function(){},e.prototype.DrawSegment=function(e){e instanceof t.CurvedSegment?this.DrawCurvedSegment(e):e instanceof t.QuadrilateralSegment&&this.DrawQuadrilateralSegment(e),this.lastDrawnSegment=e},e.angle=function(t){return Math.atan2(-t.X,t.Y)-Math.PI/2},e.prototype.DrawWholePath=function(){if(this.iterator=0,0!==this.segments.length){var t=this.segments[0].Left.clone().add(this.segments[0].Right).scale(.5),e=t.distanceTo(this.segments[0].Left);for(this.DrawStartDot(t,e),this.lastDrawnSegment=this.segments[0];this.iterator<this.segments.length;)this.DrawSegment(this.segments[this.iterator++]);this.Draw()}},e}();t.Path=i;var a=function(t){function r(e,n,r){t.call(this,e,n),this.canvas=r}return __extends(r,t),r.prototype.DrawStartDot=function(t,r){this.path=this.CreatePathElement();var o=new n(t.X-r,t.Y),a=new n(t.X+r,t.Y),s=a.pointInBetween(o),u=o.clone().subtract(s),h=a.clone().subtract(s),c=e.ArcString(a,s.distanceTo(a),i.angle(u));this.right=e.MoveToString(a),this.left=e.LineToString(o)+" "+c,this.cap=e.ArcString(o,s.distanceTo(o),i.angle(h)),e.SetAttributes(this.path,{d:this.right+this.cap+this.left}),this.canvas.appendChild(this.path)},r.prototype.InitPath=function(e,n){t.prototype.InitPath.call(this,e,n),this.StartDrawingPath(this.segments[0])},r.prototype.CreatePathElement=function(){var t;return t=this.wireframe?{stroke:this.color,"stroke-width":1}:{fill:this.color},e.CreateElement("path",t)},r.prototype.DrawCurvedSegment=function(t){this.right+=e.CurveToString(t.RightBezier.StartCP,t.RightBezier.EndCP,t.RightBezier.End),this.left=e.CurveToString(t.LeftBezier.EndCP,t.LeftBezier.StartCP,t.LeftBezier.Start)+" "+this.left;var n=t.Right.pointInBetween(t.Left),r=t.Right.clone().subtract(n);this.cap=e.ArcString(t.Left,n.distanceTo(t.Left),i.angle(r))},r.prototype.DrawQuadrilateralSegment=function(t){this.right+=e.LineToString(t.Right),this.left=e.LineToString(this.lastDrawnSegment.Left)+" "+this.left;var n=t.Right.pointInBetween(t.Left),r=t.Right.clone().subtract(n);this.cap=e.ArcString(t.Left,n.distanceTo(t.Left),i.angle(r))},r.prototype.GetPathString=function(){return this.right+this.cap+this.left},r.prototype.Draw=function(){e.SetAttributes(this.path,{d:this.GetPathString()})},r}(i);t.SvgPath=a;var s=function(t){function e(e,n,r){t.call(this,e,n),this.context=r,this.context.fillStyle=this.color}return __extends(e,t),e.prototype.DrawStartDot=function(t,e){this.context.beginPath(),this.DrawDot(t,e),this.Draw()},e.prototype.DrawDot=function(t,e){this.context.arc(t.X,t.Y,e,0,2*Math.PI,!0)},e.prototype.DrawQuadrilateralSegment=function(t){this.context.moveTo(this.lastDrawnSegment.Right.X,this.lastDrawnSegment.Right.Y),this.context.lineTo(this.lastDrawnSegment.Left.X,this.lastDrawnSegment.Left.Y),this.context.lineTo(t.Left.X,t.Left.Y);var e=t.Left.pointInBetween(t.Right),n=t.Right.clone().subtract(e),r=t.Left.clone().subtract(e);this.context.arc(e.X,e.Y,e.distanceTo(t.Left),i.angle(n),i.angle(r),!1)},e.prototype.DrawCurvedSegment=function(t){this.context.moveTo(t.RightBezier.Start.X,t.RightBezier.Start.Y),this.context.lineTo(t.LeftBezier.Start.X,t.LeftBezier.Start.Y),this.context.bezierCurveTo(t.LeftBezier.StartCP.X,t.LeftBezier.StartCP.Y,t.LeftBezier.EndCP.X,t.LeftBezier.EndCP.Y,t.LeftBezier.End.X,t.LeftBezier.End.Y);var e=t.RightBezier.End.pointInBetween(t.LeftBezier.End),n=t.RightBezier.End.clone().subtract(e),r=t.LeftBezier.End.clone().subtract(e);this.context.arc(e.X,e.Y,e.distanceTo(t.LeftBezier.End),i.angle(n),i.angle(r),!1),this.context.bezierCurveTo(t.RightBezier.EndCP.X,t.RightBezier.EndCP.Y,t.RightBezier.StartCP.X,t.RightBezier.StartCP.Y,t.RightBezier.Start.X,t.RightBezier.Start.Y)},e.prototype.Draw=function(){this.context.closePath(),this.context.fill(),this.context.beginPath()},e}(i);t.CanvasPath=s}(Drawing||(Drawing={}));var Drawing;!function(t){var e=Helpers.SVG,n=function(){function n(t){void 0===t&&(t=!0),this.curved=t}return n.prototype.CreateCanvas=function(){this.svg=e.CreateElement("svg");var t=e.CreateElement("g");return this.bg=e.CreateElement("rect",{id:"background"}),t.appendChild(this.bg),this.svg.appendChild(t),this.canvas=e.CreateElement("g",{id:"canvas"}),this.svg.appendChild(this.canvas),this.svg},n.prototype.Stretch=function(){var t=this.svg.parentElement,e=t.clientWidth,n=t.clientHeight;Helpers.SVG.SetAttributes(this.svg,{width:e,height:n}),Helpers.SVG.SetAttributes(this.bg,{width:e,height:n}),Helpers.VideoEvents.trigger(Helpers.VideoEventType.CanvasSize,e,n)},n.prototype.ClearCanvas=function(t){for(;this.canvas.firstChild;)this.canvas.removeChild(this.canvas.firstChild);e.SetAttributes(this.bg,{fill:t.CssValue})},n.prototype.SetCurrentColor=function(t){this.currentColor=t},n.prototype.CreatePath=function(){return new t.SvgPath(this.curved,this.currentColor.CssValue,this.canvas)},n.prototype.SetupOutputCorrection=function(t,n){var r=this.svg.clientWidth/t,o=this.svg.clientHeight/n,i=Math.min(r,o);return e.SetAttributes(this.svg,{viewBox:"0 0 "+t+" "+n}),i},n}();t.SVGDrawer=n}(Drawing||(Drawing={}));var Drawing;!function(t){var e=Helpers.HTML,n=function(){function n(t){void 0===t&&(t=!0),this.curved=t}return n.prototype.CreateCanvas=function(){return this.canvas=e.CreateElement("canvas"),this.context=this.canvas.getContext("2d"),this.canvas},n.prototype.Stretch=function(){var t=this.canvas.parentElement,e=t.clientWidth,n=t.clientHeight;this.originalHeight=n,this.originalWidth=e,Helpers.HTML.SetAttributes(this.canvas,{width:e,height:n}),Helpers.VideoEvents.trigger(Helpers.VideoEventType.CanvasSize,e,n)},n.prototype.SetupOutputCorrection=function(t,e){var n=this.canvas.width/t,r=this.canvas.height/e,o=Math.min(n,r);return this.canvas.width=o*t,this.canvas.height=o*e,this.context.scale(o,o),this.originalHeight=e,this.originalWidth=t,o},n.prototype.ClearCanvas=function(t){this.context.fillStyle=t.CssValue,this.context.fillRect(0,0,this.originalWidth,this.originalHeight)},n.prototype.SetCurrentColor=function(t){this.currentColor=t},n.prototype.CreatePath=function(){return new t.CanvasPath(this.curved,this.currentColor.CssValue,this.context)},n}();t.CanvasDrawer=n}(Drawing||(Drawing={}));var UI;!function(t){var e=Helpers.VideoEvents,n=Helpers.VideoEventType,r=function(t){function r(e,n){var r=this;t.call(this,""),this.SetColor(e),this.GetHTML().onclick=function(t){return n?n():r.ChangeColor(t)}}return __extends(r,t),r.prototype.ChangeColor=function(t){r.active&&r.active.GetHTML().classList.remove("active"),this.GetHTML().classList.add("active"),r.active=this,e.trigger(n.ChangeColor,this.color)},r.prototype.SetColor=function(t){this.color=t,Helpers.HTML.SetAttributes(this.GetHTML(),{"class":"option","data-color":t.CssValue,title:t.Name,style:"background-color: "+t.CssValue})},r}(t.Button);t.ChangeColorButton=r;var o=function(t){function r(e){var n=this;t.call(this,""),this.size=e;var r=Helpers.HTML.CreateElement("span",{style:"width: "+e.CssValue+";	\n						height: "+e.CssValue+";\n						border-radius: "+e.Size/2+e.Unit+"; \n						display: inline-block;\n						background: black;\n						margin-top: "+-e.Size/2+e.Unit+";","class":"dot","data-size":e.Size});this.GetHTML().appendChild(r),Helpers.HTML.SetAttributes(this.GetHTML(),{"class":"option","data-size":e.Size,title:e.Name}),this.GetHTML().onclick=function(t){return n.ChangeColor(t)}}return __extends(r,t),r.prototype.ChangeColor=function(t){t.preventDefault(),r.active&&r.active.GetHTML().classList.remove("active"),this.GetHTML().classList.add("active"),r.active=this,e.trigger(n.ChangeBrushSize,this.size)},r}(t.Button);t.ChangeBrushSizeButton=o}(UI||(UI={}));var UI;!function(t){var e=Helpers.Vector2,n=function(n){function r(){n.call(this,"div"),this.radius=20,this.stroke=3,this.position=new e(0,0),this.CreateHTML(),this.scalingFactor=1,this.size=null}return __extends(r,n),r.prototype.CreateHTML=function(){var e=this;this.svg=Helpers.SVG.CreateElement("svg",{width:2*this.radius,height:2*this.radius}),this.GetHTML().appendChild(this.svg),this.bgColor=t.Color.BackgroundColor,this.color=t.Color.ForegroundColor,this.dot=Helpers.SVG.CreateDot(new Helpers.Vector2(this.radius,this.radius),this.radius-this.stroke,this.bgColor.CssValue),Helpers.SVG.SetAttributes(this.dot,{stroke:this.color.CssValue,"stroke-width":this.stroke}),this.svg.appendChild(this.dot),this.GetHTML().style.position="absolute",this.GetHTML().style.background="transparent",this.GetHTML().style.lineHeight="0",Helpers.VideoEvents.on(Helpers.VideoEventType.ClearCanvas,function(t){e.bgColor=t,Helpers.SVG.SetAttributes(e.dot,{fill:e.bgColor.CssValue}),e.ChangeColor(e.color)})},r.prototype.MoveTo=function(t,e){this.GetHTML().style.left=t*this.scalingFactor-this.radius-this.stroke+"px",this.GetHTML().style.top=e*this.scalingFactor-this.radius-this.stroke+"px",this.position=new Helpers.Vector2(t,e)},r.prototype.ChangeColor=function(e){e.CssValue===this.bgColor.CssValue&&(e=e.CssValue===t.Color.ForegroundColor.CssValue?t.Color.BackgroundColor:t.Color.ForegroundColor),Helpers.SVG.SetAttributes(this.dot,{stroke:e.CssValue}),this.color=e},r.prototype.ChangeSize=function(t){this.size=t;var e=this.radius;this.radius=t.Size*this.scalingFactor/2-2;var n=2*(this.radius+this.stroke);Helpers.SVG.SetAttributes(this.svg,{width:n,height:n});var r=e-this.radius;this.MoveTo(this.position.X+r,this.position.Y+r),Helpers.SVG.SetAttributes(this.dot,{cx:n/2,cy:n/2,r:Math.max(1,this.radius-this.stroke)})},r.prototype.SetScalingFactor=function(t){this.scalingFactor=t,this.size&&this.ChangeSize(this.size)},r}(t.SimpleElement);t.Cursor=n}(UI||(UI={}));var UI;!function(t){var e=Helpers.HTML,n=Helpers.VideoEvents,r=Helpers.VideoEventType,o=function(o){function i(i){var a=this;o.call(this,"div",i),e.SetAttributes(this.GetHTML(),{"class":"vector-video-board"}),this.cursor=new t.Cursor,this.AddChild(this.cursor),e.SetAttributes(this.GetHTML(),{position:"relative"}),n.on(r.CursorState,function(t){return a.UpdateCursorPosition(t)}),n.on(r.CursorState,function(t){return a.UpdateCursorPosition(t)}),n.on(r.ChangeBrushSize,function(t){return a.UpdateCursorSize(t)}),n.on(r.ChangeColor,function(t){return a.UpdateCursorColor(t)}),n.on(r.ChangeColor,function(t){return a.UpdateCursorColor(t)}),n.on(r.CanvasScalingFactor,function(t){return a.UpdateCursorScale(t)})}return __extends(i,o),Object.defineProperty(i.prototype,"Width",{get:function(){return this.GetHTML().clientWidth},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"Height",{get:function(){return this.GetHTML().clientHeight},set:function(t){this.GetHTML().clientHeight=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"IsRecording",{set:function(t){t?this.GetHTML().classList.add("recording"):this.GetHTML().classList.remove("recording")},enumerable:!0,configurable:!0}),i.prototype.UpdateCursorPosition=function(t){this.cursor.MoveTo(t.X,t.Y)},i.prototype.UpdateCursorSize=function(t){this.cursor.ChangeSize(t)},i.prototype.UpdateCursorColor=function(t){this.cursor.ChangeColor(t)},i.prototype.UpdateCursorScale=function(t){this.cursor.SetScalingFactor(t)},i}(t.Panel);t.Board=o}(UI||(UI={}));var UI;!function(t){var e=Helpers.VideoEvents,n=Helpers.VideoEventType,r=function(r){function o(e){var n=this;r.call(this,"div",e),this.length=0,this.GetHTML().classList.add("ui-progressbar");var o=new t.SimpleElement("div");o.GetHTML().classList.add("ui-progress"),this.progresbar=o,this.AddChild(o),o=new t.SimpleElement("div"),o.GetHTML().classList.add("ui-buffer"),this.bufferbar=o,this.AddChild(o),this.arrow=new t.SimpleElement("div","0:00"),this.arrow.GetHTML().classList.add("ui-arrow"),this.AddChild(this.arrow),this.Sync(0),this.GetHTML().onclick=function(t){return n.OnClick(t)},this.GetHTML().onmousemove=function(t){return n.OnMouseMove(t)}}return __extends(o,r),Object.defineProperty(o.prototype,"Length",{set:function(t){this.length=t},enumerable:!0,configurable:!0}),o.prototype.OnClick=function(t){var e=(t.clientX-this.GetHTML().clientLeft)/this.GetHTML().clientWidth*this.length;this.SkipTo(e)},o.prototype.OnMouseMove=function(t){var e=(t.clientX-this.GetHTML().clientLeft)/this.GetHTML().clientWidth,n=Helpers.millisecondsToString(e*this.length);this.arrow.GetHTML().textContent=n,this.arrow.GetHTML().style.left=100*e+"%";var r=this.arrow.GetHTML().getBoundingClientRect();r.left<0?this.arrow.GetHTML().style.left=r.width/2+"px":r.right>this.GetHTML().getBoundingClientRect().right&&(this.arrow.GetHTML().style.left=this.GetHTML().getBoundingClientRect().right-r.width/2+"px")},o.prototype.Sync=function(t){this.progresbar.GetHTML().style.width=this.length>0?t/this.length*100+"%":"O%"},o.prototype.SetBuffer=function(t){this.bufferbar.GetHTML().style.width=this.length>0?t/this.length*100+"%":"O%"},o.prototype.SkipTo=function(t){e.trigger(n.JumpTo,t/this.length),this.Sync(t)},o}(t.Panel);t.TimeLine=r}(UI||(UI={}));var UI;!function(t){var e=Helpers.VideoEvents,n=Helpers.VideoEventType,r=function(r){function o(t){var o=this;r.call(this,"div",t+"-player"),this.id=t,this.isBusy=!1,this.tickingInterval=200,this.isMuted=!1,this.AddClass("vector-video-wrapper"),this.board=this.CreateBoard(),this.AddChild(this.board),e.on(n.Start,function(){return o.StartPlaying()}),e.on(n.Pause,function(){return o.PausePlaying()}),e.on(n.ReachEnd,function(){return o.ReachedEnd()}),e.on(n.JumpTo,function(){return o.JumpTo()}),e.on(n.ClearCanvas,function(t){return o.GetHTML().style.backgroundColor=t.CssValue}),this.isPlaying=!1,this.reachedEnd=!1}return __extends(o,r),o.prototype.CreateControls=function(r){
var o=this;this.timeline=this.CreateTimeLine(),this.hidingButton=new t.IconOnlyButton(r?"icon-show":"icon-hide","",function(t){return o.ToggleAutohiding()}).AddClasses("autohiding-toggle"),this.controls=new t.Panel("div",this.id+"-controls").AddClasses("ui-controls","ui-control").AddChildren(this.CreateButtonsPanel(),this.timeline,this.CreateTimeStatus(),this.CreateAudioControls()),!!r&&this.controls.AddClass("autohide"),this.AddChildren(new t.Panel("div").AddClass("ui-controls-wrapper").AddChildren(this.controls,this.hidingButton)),e.on(n.VideoInfoLoaded,function(t){o.videoDuration=t.Length,o.totalTime.GetHTML().textContent=Helpers.millisecondsToString(t.Length),o.timeline.Length=t.Length}),e.on(n.BufferStatus,function(t){return o.timeline.SetBuffer(1e3*t)}),this.BindKeyboardShortcuts()},o.prototype.SetBusyText=function(t){Helpers.HTML.SetAttributes(this.GetHTML(),{"data-busy-string":t})},o.prototype.BindKeyboardShortcuts=function(){var t=this,e=32,n=37,r=39,o=5e3;window.onkeyup=function(i){switch(i.keyCode){case e:t.PlayPause();break;case n:t.timeline.SkipTo(t.Timer.CurrentTime()-o);break;case r:t.timeline.SkipTo(t.Timer.CurrentTime()+o)}}},o.prototype.AcceptCanvas=function(t){this.board.GetHTML().appendChild(t)},o.prototype.CreateBoard=function(){var e=this,n=new t.Board(this.id+"-board");return n.GetHTML().onclick=function(){return e.PlayPause()},n},o.prototype.CreateButtonsPanel=function(){var e=this;return this.playPauseButton=new t.IconOnlyButton("icon-play",this.Localization.Play,function(t){return e.PlayPause()}),new t.Panel("div").AddChildren(new t.H2(this.Localization.ControlPlayback),this.playPauseButton).AddClass("ui-controls-panel")},o.prototype.PlayPause=function(){return!this.isBusy&&this.controls?this.reachedEnd?(this.reachedEnd=!1,this.timeline.SkipTo(0),void e.trigger(n.Start)):void(this.isPlaying===!0?(this.PausePlaying(),e.trigger(n.Pause)):(this.StartPlaying(),e.trigger(n.Start))):void 0},o.prototype.JumpTo=function(){this.controls&&this.reachedEnd===!0&&(this.reachedEnd=!1,this.playPauseButton.ChangeIcon("icon-play"))},o.prototype.StartPlaying=function(){var t=this;this.controls&&this.isPlaying===!1&&(this.isPlaying=!0,this.playPauseButton.ChangeIcon("icon-pause"),this.playPauseButton.ChangeContent(this.Localization.Pause),this.AddClass("playing"),this.ticking=setInterval(function(){return t.UpdateCurrentTime()},this.tickingInterval))},o.prototype.PausePlaying=function(){this.controls&&(this.isPlaying=!1,this.playPauseButton.ChangeIcon("icon-play"),this.playPauseButton.ChangeContent(this.Localization.Play),this.RemoveClass("playing"),clearInterval(this.ticking))},o.prototype.CreateTimeLine=function(){return new t.TimeLine(this.id+"-timeline")},o.prototype.CreateTimeStatus=function(){return this.currentTime=new t.SimpleElement("span","0:00"),this.totalTime=new t.SimpleElement("span","0:00"),new t.Panel("div").AddChildren(new t.H2(this.Localization.TimeStatus),new t.Panel("div").AddChildren(this.currentTime,new t.SimpleElement("span"," / "),this.totalTime).AddClass("ui-time")).AddClass("ui-controls-panel")},o.prototype.UpdateCurrentTime=function(){this.currentTime.GetHTML().textContent=Helpers.millisecondsToString(this.Timer.CurrentTime()),this.timeline.Sync(this.Timer.CurrentTime())},o.prototype.ReachedEnd=function(){this.controls&&(this.PausePlaying(),this.playPauseButton.ChangeIcon("icon-replay").ChangeContent(this.Localization.Replay),this.reachedEnd=!0)},o.prototype.Busy=function(){this.AddClass("busy"),this.isBusy=!0},o.prototype.Ready=function(){this.RemoveClass("busy"),this.isBusy=!1},o.prototype.CreateAudioControls=function(){var e=this;return new t.Panel("div",this.id+"-audio").AddChildren(new t.H2(this.Localization.VolumeControl),new t.Panel("div",this.id+"-audio-controls").AddChildren(this.volumeDownBtn=new t.IconOnlyButton("icon-volume-down",this.Localization.VolumeDown,function(t){return e.VolumeDown()}),this.volumeUpBtn=new t.IconOnlyButton("icon-volume-up",this.Localization.VolumeUp,function(t){return e.VolumeUp()}),this.volumeOffBtn=new t.IconOnlyButton("icon-volume-off",this.Localization.Mute,function(t){return e.Mute()})).AddClass("btn-group")).AddClasses("ui-controls-panel","vector-video-audio-controls")},o.prototype.VolumeUp=function(){e.trigger(n.VolumeUp)},o.prototype.VolumeDown=function(){e.trigger(n.VolumeDown)},o.prototype.Mute=function(){this.isMuted?(this.volumeDownBtn.GetHTML().removeAttribute("disabled"),this.volumeUpBtn.GetHTML().removeAttribute("disabled"),this.volumeOffBtn.RemoveClass("active")):(Helpers.HTML.SetAttributes(this.volumeDownBtn.GetHTML(),{disabled:"disabled"}),Helpers.HTML.SetAttributes(this.volumeUpBtn.GetHTML(),{disabled:"disabled"}),this.volumeOffBtn.AddClass("active")),this.isMuted=!this.isMuted,e.trigger(n.Mute)},o.prototype.ToggleAutohiding=function(){this.controls.HasClass("autohide")?(this.controls.RemoveClass("autohide"),this.hidingButton.ChangeIcon("icon-hide")):(this.controls.AddClass("autohide"),this.hidingButton.ChangeIcon("icon-show"))},o}(t.Panel);t.PlayerUI=r}(UI||(UI={}));var AudioData;!function(t){var e=Helpers.VideoEvents,n=Helpers.VideoEventType,r=Helpers.Errors,o=Helpers.ErrorType;!function(t){t[t.MP3=0]="MP3",t[t.OGG=1]="OGG",t[t.WAV=2]="WAV"}(t.AudioSourceType||(t.AudioSourceType={}));var i=t.AudioSourceType,a=function(){function t(t,e){this.url=t,this.type=e}return Object.defineProperty(t.prototype,"Url",{get:function(){return this.url},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"Type",{get:function(){return this.type},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"MimeType",{get:function(){switch(this.type){case i.MP3:return"audio/mp3";case i.OGG:return"audio/ogg";case i.WAV:return"audio/wav";default:return null}},enumerable:!0,configurable:!0}),t.StringToType=function(t){switch(t){case"audio/mp3":return i.MP3;case"audio/wav":return i.WAV;case"audio/ogg":return i.OGG;default:throw new Error("Unknown audio type "+t)}},t}();t.AudioSource=a;var s=function(){function t(t){this.audio=this.CreateAudio(t),null===this.audio?this.isReady=!1:(this.playing=!1,this.reachedEnd=!1,this.InitAudio(),this.isReady=!0,document.documentElement.appendChild(this.audio),console.log("Audio is available."))}return Object.defineProperty(t.prototype,"IsReady",{get:function(){return this.isReady},enumerable:!0,configurable:!0}),t.prototype.CreateAudio=function(t){try{var e=new Audio;if(!e.canPlayType)return r.Report(o.Warning,"AudioPlayer: browser does not support HTML5 audio"),null;for(var n=!1,i=0;i<t.length;i++){var a=t[i];if("probably"===e.canPlayType(a.MimeType)){var s=Helpers.HTML.CreateElement("source",{src:a.Url,type:a.MimeType});e.appendChild(s),n=!0}}return n===!1?(r.Report(o.Warning,"Browser can't play any of available audio sources.",t),null):e}catch(u){return r.Report(o.Warning,"AudioPlayer: can't create audio element",u),null}},t.prototype.InitAudio=function(){var t=this;this.audio.onended=function(){return e.trigger(n.ReachEnd)},this.audio.onwaiting=function(){return t.Busy()},this.audio.oncanplay=function(){return t.Ready()},e.on(n.Mute,function(){return t.Mute()}),e.on(n.VolumeUp,function(){return t.VolumeUp()}),e.on(n.VolumeDown,function(){return t.VolumeDown()}),this.MonitorBufferingAsync()},t.prototype.Busy=function(){this.playing&&(this.triggeredBusyState=!0,e.trigger(n.Pause))},t.prototype.Ready=function(){this.triggeredBusyState&&(e.trigger(n.Ready),this.triggeredBusyState=!1)},t.prototype.Play=function(){this.isReady&&(1==this.reachedEnd&&this.Rewind(),this.audio.play())},t.prototype.InitiatePlay=function(){e.trigger(n.Start)},t.prototype.Pause=function(){this.isReady&&this.audio.pause()},t.prototype.ReachedEnd=function(){this.reachedEnd=!0,this.Pause()},t.prototype.Replay=function(){this.Rewind(),this.Play()},t.prototype.Rewind=function(){this.isReady&&(this.audio.pause(),this.audio.currentTime=0,this.reachedEnd=!1)},t.prototype.MonitorBufferingAsync=function(){var t=this,r=0;this.checkPreloaded=setInterval(function(){var o=t.audio.buffered.end(t.audio.buffered.length-1);o!==r&&(e.trigger(n.BufferStatus,o),r=o),o===t.audio.duration&&clearInterval(t.checkPreloaded)},300)},t.prototype.JumpTo=function(t){if(this.isReady){this.reachedEnd=!1;var e=this.audio.duration*t;this.ChangePosition(e),clearInterval(this.checkPreloaded),this.MonitorBufferingAsync()}},t.prototype.ChangePosition=function(t){this.audio.currentTime=t},t.prototype.Mute=function(){this.audio.muted=!this.audio.muted},t.prototype.VolumeUp=function(){this.audio.volume=Math.min(1,this.audio.volume+.1)},t.prototype.VolumeDown=function(){this.audio.volume=Math.max(0,this.audio.volume-.1)},t}();t.AudioPlayer=s}(AudioData||(AudioData={}));var VideoData;!function(t){var e=function(){function t(){}return t}();t.Metadata=e}(VideoData||(VideoData={}));var VideoData;!function(t){var e=Helpers.VideoEvents,n=Helpers.VideoEventType,r=function(){function t(t){this.time=t}return Object.defineProperty(t.prototype,"Time",{get:function(){return this.time},enumerable:!0,configurable:!0}),t.prototype.Execute=function(){throw new Error("Not implemented")},t}();t.Command=r;var o=function(t){function r(e,n,r,o){t.call(this,o),this.x=e,this.y=n,this.p=r}return __extends(r,t),Object.defineProperty(r.prototype,"X",{get:function(){return this.x},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"Y",{get:function(){return this.y},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"P",{get:function(){return this.p},enumerable:!0,configurable:!0}),r.prototype.Execute=function(){e.trigger(n.CursorState,new Helpers.CursorState(this.Time,this.x,this.y,this.p))},r}(r);t.MoveCursor=o;var i=function(t){function r(){t.apply(this,arguments)}return __extends(r,t),r.prototype.Execute=function(){e.trigger(n.DrawSegment)},r}(r);t.DrawNextSegment=i;var a=function(t){function r(e,n){t.call(this,n),this.color=e}return __extends(r,t),Object.defineProperty(r.prototype,"Color",{get:function(){return this.color},enumerable:!0,configurable:!0}),r.prototype.Execute=function(){e.trigger(n.ChangeColor,this.color)},r}(r);t.ChangeBrushColor=a;var s=function(t){function r(e,n){t.call(this,n),this.size=e}return __extends(r,t),Object.defineProperty(r.prototype,"Size",{get:function(){return this.size},enumerable:!0,configurable:!0}),r.prototype.Execute=function(){e.trigger(n.ChangeBrushSize,this.size)},r}(r);t.ChangeBrushSize=s;var u=function(t){function r(e,n){t.call(this,e),this.color=n}return __extends(r,t),Object.defineProperty(r.prototype,"Color",{get:function(){return this.color},enumerable:!0,configurable:!0}),r.prototype.Execute=function(){e.trigger(n.ClearCanvas,this.color)},r}(r);t.ClearCanvas=u}(VideoData||(VideoData={}));var Helpers;!function(t){var e=function(){function t(t){this.pauseTime=0,this.clock=window.performance?window.performance:Date,this.paused=!t,this.Reset()}return Object.defineProperty(t.prototype,"StartTime",{get:function(){return this.startTime},enumerable:!0,configurable:!0}),t.prototype.CurrentTime=function(){return this.paused?this.pauseTime:this.clock.now()-this.startTime},t.prototype.SetTime=function(t){this.paused?this.pauseTime=t:this.startTime=this.clock.now()-t},t.prototype.Pause=function(){this.pauseTime=this.CurrentTime(),this.paused=!0},t.prototype.Resume=function(){this.paused=!1,this.Reset(),this.SetTime(this.pauseTime)},t.prototype.Reset=function(){this.startTime=this.clock.now()},t}();t.VideoTimer=e}(Helpers||(Helpers={}));var VideoData;!function(t){var e=Helpers.VideoEvents,n=Helpers.VideoEventType,r=function(){function t(t,e){this.time=t,this.lastErase=e,this.initCommands=[],this.commands=[],this.cmdIterator=0,this.pathIterator=0}return Object.defineProperty(t.prototype,"StartTime",{get:function(){return this.time},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"LastErase",{get:function(){return this.lastErase},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"CurrentCommand",{get:function(){return this.commands[this.cmdIterator]},enumerable:!0,configurable:!0}),t.prototype.PeekNextCommand=function(){return this.commands[this.cmdIterator+1]},t.prototype.MoveNextCommand=function(){this.cmdIterator++},t.prototype.Rewind=function(){this.cmdIterator=0},t.prototype.ExecuteInitCommands=function(){for(var t=0;t<this.initCommands.length;t++)this.initCommands[t].Execute()},t.prototype.GetCommand=function(t){return t<this.commands.length?this.commands[t]:null},t.prototype.PushCommand=function(t){this.commands.push(t)},Object.defineProperty(t.prototype,"Commands",{get:function(){return this.commands},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"InitCommands",{get:function(){return this.initCommands},set:function(t){this.initCommands=t},enumerable:!0,configurable:!0}),t.prototype.Render=function(){throw new Error("Not implemented")},t}();t.Chunk=r;var o=function(t){function e(){t.apply(this,arguments)}return __extends(e,t),Object.defineProperty(e,"NodeName",{get:function(){return"void"},enumerable:!0,configurable:!0}),e.prototype.Render=function(){},e}(r);t.VoidChunk=o;var i=function(t){function r(e,n,r){t.call(this,n,r),this.path=e}return __extends(r,t),Object.defineProperty(r,"NodeName",{get:function(){return"path"},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"Path",{get:function(){return this.path},enumerable:!0,configurable:!0}),r.prototype.Render=function(){e.trigger(n.DrawPath)},r}(r);t.PathChunk=i;var a=function(t){function r(e,n,r){t.call(this,n,r),this.color=e}return __extends(r,t),Object.defineProperty(r,"NodeName",{get:function(){return"erase"},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"Color",{get:function(){return this.color},enumerable:!0,configurable:!0}),r.prototype.Render=function(){e.trigger(n.ClearCanvas,this.color)},r}(r);t.EraseChunk=a}(VideoData||(VideoData={}));var Helpers;!function(t){var e=function(){function e(){}return e.Check=function(t,e){return 200===t.status&&e?t.getResponseHeader("ContentType")===e:!0},e.Exists=function(t,e){var n=new XMLHttpRequest;return n.open("HEAD",t,!1),n.send(),this.Check(n,e)},e.ExistsAsync=function(t,e,n,r){var o=this,i=new XMLHttpRequest;i.open("HEAD",t,!0),i.onerror=n,i.ontimeout=n,i.onload=function(t){o.Check(i,r)?e(t):n(t)},i.send()},e.ReadFileAsync=function(t,e,n){var r=new XMLHttpRequest;r.open("GET",t,!0),r.onerror=function(t){return n(r.status)},r.ontimeout=function(t){return n(r.status)},r.onload=function(t){200===r.status?e(r.responseXML?r.responseXML:r.response):n(r.status)},r.send()},e.ReadXmlAsync=function(t,e,n){var r=new XMLHttpRequest;r.open("GET",t,!0),r.onerror=function(t){return n(r.status)},r.ontimeout=function(t){return n(r.status)},r.onload=function(t){200===r.status?e(r.responseXML):n(r.status)},r.send()},e.Download=function(e,n){var r=t.HTML.CreateElement("a",{css:"display: none"});document.documentElement.appendChild(r);var o=URL.createObjectURL(e);t.HTML.SetAttributes(r,{href:o,download:n}),r.click(),URL.revokeObjectURL(o)},e.CurrentDateTime=function(){new Date;return"$(date.getMonth())-$(date.getDay())-$(date.getFullYear())_$(date.getHour())-$(date.getMinute())"},e.StartDownloadingWav=function(t){e.Download(t,"recording-"+e.CurrentDateTime()+".wav")},e.StartDownloadingXml=function(t){var n=new Blob([t],{type:"text/xml"});e.Download(n,"data-"+e.CurrentDateTime()+".xml")},e}();t.File=e}(Helpers||(Helpers={}));var VideoData;!function(t){var e=function(){function t(){this.chunks=[]}return Object.defineProperty(t.prototype,"Metadata",{get:function(){return this.metadata},set:function(t){this.metadata=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"CurrentChunk",{get:function(){return this.chunks[this.currentChunk]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"CurrentChunkNumber",{get:function(){return this.currentChunk},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"SetCurrentChunkNumber",{set:function(t){this.currentChunk=t},enumerable:!0,configurable:!0}),t.prototype.PeekNextChunk=function(){return this.chunks[this.currentChunk+1]},t.prototype.MoveNextChunk=function(){this.currentChunk++,this.CurrentChunk&&this.CurrentChunk.Rewind()},t.prototype.PushChunk=function(t){return this.currentChunk=this.chunks.push(t)-1,this.currentChunk},t.prototype.Rewind=function(){this.currentChunk=0},t.prototype.RewindMinusOne=function(){this.currentChunk=-1},t.prototype.FastforwardErasedChunksUntil=function(t){var e=this.FindChunk(t,1);return Math.max(this.currentChunk,this.chunks[e].LastErase)},t.prototype.RewindToLastEraseBefore=function(t){var e=this.FindChunk(t,-1);return this.chunks[e].LastErase},t.prototype.FindChunk=function(t,e){for(var n=Math.min(this.currentChunk,this.chunks.length-2);this.chunks[n]&&this.chunks[n+1]&&(this.chunks[n].StartTime<=t&&this.chunks[n+1].StartTime>=t)==!1;)n+=e;return 0>n?0:n},t}();t.Video=e}(VideoData||(VideoData={}));var VideoFormat;!function(t){var e;!function(t){var e=VideoData.MoveCursor,n=VideoData.ChangeBrushColor,r=VideoData.ChangeBrushSize,o=VideoData.ClearCanvas,i=VideoData.DrawNextSegment,a=Helpers.SVGA,s=Helpers.precise,u=2,h=4,c=function(){function t(t){this.next=t}return t.prototype.FromSVG=function(t){if(this.next)return this.next.FromSVG(t);throw new Error("Command loading failed: Unsupported node "+t.nodeName+".")},t.prototype.ToSVG=function(t){if(this.next)return this.next.ToSVG(t);throw new Error("Command export failed: Unsupported command "+typeof t+".")},t}();t.CommandFactory=c;var l=function(t){function n(){t.apply(this,arguments)}return __extends(n,t),n.prototype.FromSVG=function(r){return r.localName===n.NodeName?new e(a.numAttr(r,"x"),a.numAttr(r,"y"),a.numAttr(r,"p",0),a.numAttr(r,"t")):t.prototype.FromSVG.call(this,r)},n.prototype.ToSVG=function(r){if(r instanceof e){var o={x:s(r.X),y:s(r.Y),t:s(r.Time,u)};return r.P>0&&(o.p=s(r.P,h)),a.CreateElement(n.NodeName,o)}return t.prototype.ToSVG.call(this,r)},n.NodeName="m",n}(c);t.MoveCursorFactory=l;var p=function(t){function e(){t.apply(this,arguments)}return __extends(e,t),e.prototype.FromSVG=function(n){return n.localName===e.NodeName?new i(a.numAttr(n,"t")):t.prototype.FromSVG.call(this,n)},e.prototype.ToSVG=function(n){return n instanceof i?a.CreateElement(e.NodeName,{t:s(n.Time,u)}):t.prototype.ToSVG.call(this,n)},e.NodeName="ds",e}(c);t.DrawSegmentFactory=p;var d=function(t){function e(){t.apply(this,arguments)}return __extends(e,t),e.prototype.FromSVG=function(r){return r.localName===e.NodeName?new n(new UI.Color("",a.attr(r,"d")),a.numAttr(r,"t")):t.prototype.FromSVG.call(this,r)},e.prototype.ToSVG=function(r){return r instanceof n?a.CreateElement(e.NodeName,{d:r.Color.CssValue,t:s(r.Time,u)}):t.prototype.ToSVG.call(this,r)},e.NodeName="c",e}(c);t.ChangeBrushColorFactory=d;var f=function(t){function e(){t.apply(this,arguments)}return __extends(e,t),e.prototype.FromSVG=function(n){return n.localName===e.NodeName?new r(new UI.BrushSize("",a.numAttr(n,"d"),a.attr(n,"u")),a.numAttr(n,"t")):t.prototype.FromSVG.call(this,n)},e.prototype.ToSVG=function(n){return n instanceof r?a.CreateElement(e.NodeName,{d:n.Size.Size,u:n.Size.Unit,t:s(n.Time,u)}):t.prototype.ToSVG.call(this,n)},e.NodeName="s",e}(c);t.ChangeBrushSizeFactory=f;var m=function(t){function e(){t.apply(this,arguments)}return __extends(e,t),e.prototype.FromSVG=function(n){return n.localName===e.NodeName?new o(a.numAttr(n,"t"),new UI.Color("",a.attr(n,"color"))):t.prototype.FromSVG.call(this,n)},e.prototype.ToSVG=function(n){return n instanceof o?a.CreateElement(e.NodeName,{t:s(n.Time,u),color:n.Color.CssValue}):t.prototype.ToSVG.call(this,n)},e.NodeName="e",e}(c);t.ClearCanvasFactory=m}(e=t.SVGAnimation||(t.SVGAnimation={}))}(VideoFormat||(VideoFormat={}));var VideoFormat;!function(t){var e;!function(t){var e=Helpers.SVG,n=Helpers.SVGA,r=VideoData.VoidChunk,o=VideoData.PathChunk,i=VideoData.EraseChunk,a=2,s=function(){function t(t){this.next=t}return t.prototype.FromSVG=function(t,e){if(this.next)return this.next.FromSVG(t,e);throw new Error("Chunk loading failed: Unsupported node "+t.nodeName+".")},t.prototype.ToSVG=function(t,e){if(this.next)return this.next.ToSVG(t,e);throw new Error("Chunk export failed: Unsupported command "+typeof t+".")},Object.defineProperty(t.prototype,"InitCommandsNodeName",{get:function(){return"init"},enumerable:!0,configurable:!0}),t.prototype.InitCommandsFromSVG=function(t,e){if(t.localName===this.InitCommandsNodeName){for(var n=[],r=t.firstElementChild;r;)n.push(e.FromSVG(r)),r=r.nextElementSibling;return n}throw new Error("Can't read init commands from "+t.nodeName)},t.prototype.InitCommandsToSVG=function(t,e){var r=n.CreateElement(this.InitCommandsNodeName);return this.CommandsToSVG(r,t,e)},t.prototype.CommandsToSVG=function(t,e,n){for(var r=0;r<e.length;r++)t.appendChild(n.ToSVG(e[r]));return t},t}();t.ChunkFactory=s;var u=function(t){function o(){t.apply(this,arguments)}return __extends(o,t),o.prototype.FromSVG=function(e,i){if(n.attr(e,"type")===o.NodeName){var a=new r(n.numAttr(e,"t"),0),s=e.firstElementChild;a.InitCommands=this.InitCommandsFromSVG(s,i);for(var u=s.nextElementSibling;u;)a.PushCommand(i.FromSVG(u)),u=u.nextElementSibling;return a}return t.prototype.FromSVG.call(this,e,i)},o.prototype.ToSVG=function(i,s){if(i instanceof r){var u=e.CreateElement("g");return n.SetAttributes(u,{type:o.NodeName,t:i.StartTime.toFixed(a)}),u.appendChild(this.InitCommandsToSVG(i.InitCommands,s)),this.CommandsToSVG(u,i.Commands,s),u}return t.prototype.ToSVG.call(this,i,s)},o.NodeName="void",o}(s);t.VoidChunkFactory=u;var h;!function(t){t[t.Move=0]="Move",t[t.Line=1]="Line",t[t.Curve=2]="Curve",t[t.Arc=3]="Arc",t[t.Close=4]="Close"}(h||(h={}));var c=function(){function t(t,e,n,r){this.letter=t,this.type=e,this.coordsCount=n,this.next=r}return t.prototype.Create=function(t){var e=t.shift();if(e===this.letter){for(var n=[],r=0;r<this.coordsCount;r++)n.push(this.CreateVector2(t.shift()));return{type:this.type,coords:n}}if(this.next)return t.unshift(e),this.next.Create(t);throw new Error("Unsupported instruction letter '"+e+"'")},t.prototype.CreateVector2=function(t){var e=t.split(",");if(2!==e.length)throw new Error("Coordinates pair '"+t+"' is not valid");return new Helpers.Vector2(Number(e[0]),Number(e[1]))},t}(),l=function(t){function e(e){t.call(this,"A",h.Arc,3,e)}return __extends(e,t),e.prototype.Create=function(t){var e=t.shift();if(e===this.letter){var n=[];return n.push(this.CreateVector2(t.shift())),t.shift(),n.push(this.CreateVector2(t.shift())),n.push(this.CreateVector2(t.shift())),{type:this.type,coords:n}}if(this.next)return t.unshift(e),this.next.Create(t);throw new Error("Unsupported instruction letter '"+e+"'")},e}(c),p=function(t){function r(e){t.call(this,e),this.next=e,this.instructionFactory=new c("C",h.Curve,3,new c("L",h.Line,1,new c("M",h.Move,1,new l)))}return __extends(r,t),r.prototype.FromSVG=function(e,i){if(n.attr(e,"type")===r.NodeName){if(e.childElementCount<2)throw new Error("Path chunk has only "+e.childElementCount+" nodes.");var a=e.firstElementChild;if("path"!==a.localName)throw new Error("Path chunk must begin with a <path> element, but "+a.localName+" found instead");var s=a.nextElementSibling;if(s.localName!==this.InitCommandsNodeName)throw new Error("Second child of chunk must be an <init> element, but "+s.localName+" found instead");var u=this.InitCommandsFromSVG(s,i),h=new o(this.SVGNodeToPath(a),n.numAttr(e,"t"),n.numAttr(e,"lastErase"));h.InitCommands=u;for(var c=s.nextElementSibling;c;)h.PushCommand(i.FromSVG(c)),c=c.nextElementSibling;return h}return t.prototype.FromSVG.call(this,e,i)},r.prototype.ToSVG=function(i,s){if(i instanceof o){var u=e.CreateElement("g");return n.SetAttributes(u,{type:r.NodeName,t:i.StartTime.toFixed(a),lastErase:i.LastErase}),u.appendChild(this.PathToSVGNode(i.Path)),u.appendChild(this.InitCommandsToSVG(i.InitCommands,s)),this.CommandsToSVG(u,i.Commands,s),u}return t.prototype.ToSVG.call(this,i,s)},r.prototype.SVGNodeToPath=function(t){var n=e.attr(t,"fill"),r=new Drawing.Path(!0,n),o=e.attr(t,"d");t=null;for(var i=o.split(" "),a=[];i.length>0;)a.push(this.instructionFactory.Create(i));i=null,o=null;var s=a.length-1;if(!(a.length>=2&&a[0].type===h.Move&&a[s].type===h.Arc))throw new Error("Only "+a.length+" valid instructions recognized in a path string");if(r.Segments.push(new Drawing.ZeroLengthSegment(a[s].coords[2],a[0].coords[0])),a.pop(),a.pop(),a.shift(),1===a.length){var u=r.Segments[0].Right,c=a[0].coords[2];return r.Segments=[new Drawing.ZeroLengthSegment(u,c)],r}s=a.length-1;for(var l=null,p=0;p<Math.floor(a.length/2);p++)if(a[p].type===h.Line){var d=new Drawing.QuadrilateralSegment(a[p].coords[0],a[s-p].coords[0]);r.Segments.push(d),l instanceof Drawing.CurvedSegment&&(l.Left=a[s-p].coords[0].clone()),l=d}else{if(a[p].type!==h.Curve)throw new Error("Unsupported path segment type "+a[p].type+" ");var f=new Helpers.BezierCurveSegment(null,a[p].coords[0],a[p].coords[2],a[p].coords[1]),m=new Helpers.BezierCurveSegment(a[s-p].coords[2],a[s-p].coords[1],null,a[s-p].coords[0]),g=new Drawing.CurvedSegment(m,f);l&&l instanceof Drawing.CurvedSegment?(l.Left=g.LeftBezier.Start.clone(),g.RightBezier.Start=l.RightBezier.End.clone()):l&&l instanceof Drawing.QuadrilateralSegment&&(g.RightBezier.Start=l.Right.clone()),r.Segments.push(g),l=g}return l&&l instanceof Drawing.CurvedSegment&&(l.Left=a[Math.floor(a.length/2)].coords[2].clone()),r},r.prototype.PathToSVGNode=function(t){for(var n=t.Segments,r=n[0],o=r.Right.pointInBetween(r.Left),i=r.Left.clone().subtract(o),a=r.Right.clone().subtract(o),s=e.ArcString(r.Right,o.distanceTo(r.Right),Drawing.Path.angle(i)),u=e.MoveToString(n[0].Right)+" ",h=e.LineToString(n[0].Left)+" "+s,c=0;c<n.length-1;c++){var r=n[c];if(r instanceof Drawing.CurvedSegment)u+=e.CurveToString(r.RightBezier.StartCP,r.RightBezier.EndCP,r.RightBezier.End)+" ",h=e.CurveToString(r.LeftBezier.EndCP,r.LeftBezier.StartCP,r.LeftBezier.Start)+" "+h;else{if(!(r instanceof Drawing.QuadrilateralSegment))throw new Error("Unsupported segment type "+typeof r);u+=e.LineToString(r.Right)+" ",h=e.LineToString(r.Left)+" "+h}}r=n[n.length-1],o=r.Right.pointInBetween(r.Left),i=r.Right.clone().subtract(o),a=r.Left.clone().subtract(o);var l=e.ArcString(r.Left,o.distanceTo(r.Left),Drawing.Path.angle(i))+" ";return e.CreateElement("path",{fill:t.Color,d:u+l+h})},r.NodeName="path",r}(s);t.PathChunkFactory=p;var d=function(t){function r(){t.apply(this,arguments)}return __extends(r,t),r.prototype.FromSVG=function(o,a){if(n.attr(o,"type")===r.NodeName){if(o.childElementCount<2)throw new Error("Erase chunk has only "+o.childNodes.length+" nodes.");var s=o.firstElementChild;if("rect"!==s.localName)throw new Error("Erase chunk must begin with a <rect> element, but "+s.localName+" found instead");var u=s.nextElementSibling;if(u.localName!==this.InitCommandsNodeName)throw new Error("Second child of chunk must be an <init> element, but "+u.localName+" found instead");var h=this.InitCommandsFromSVG(u,a),c=new i(new UI.Color("",e.attr(s,"fill")),n.numAttr(o,"t"),n.numAttr(o,"lastErase"));c.InitCommands=h;for(var l=u.nextElementSibling;l;)c.PushCommand(a.FromSVG(l)),l=l.nextElementSibling;return c}return t.prototype.FromSVG.call(this,o,a)},r.prototype.ToSVG=function(o,s){if(o instanceof i){var u=e.CreateElement("g");return n.SetAttributes(u,{type:r.NodeName,t:o.StartTime.toFixed(a),lastErase:o.LastErase}),u.appendChild(e.CreateElement("rect",{fill:o.Color.CssValue,width:"100%",height:"100%"})),u.appendChild(this.InitCommandsToSVG(o.InitCommands,s)),this.CommandsToSVG(u,o.Commands,s),u}return t.prototype.ToSVG.call(this,o,s)},r.NodeName="erase",r}(s);t.EraseChunkFactory=d}(e=t.SVGAnimation||(t.SVGAnimation={}))}(VideoFormat||(VideoFormat={}));var VideoFormat;!function(t){var e;!function(t){var e=VideoData.Metadata,n=Helpers.SVGA,r=function(){function t(){}return t.prototype.FromSVG=function(t){var r=new e;if("metadata"!==t.localName)throw new Error("MetadataFactory error parsing SVG: Wrong metadata element "+t.localName);var o=t.firstElementChild;if("length"!==o.localName)throw new Error("MetadataFactory error parsing SVG: Expected 'length', found '"+o.nodeName+"'");r.Length=Number(o.textContent);var i=o.nextElementSibling;if(o=null,"width"!==i.localName)throw new Error("MetadataFactory error parsing SVG: Expected 'length', found '"+i.nodeName+"'");r.Width=Number(i.textContent);var a=i.nextElementSibling;if(i=null,"height"!==a.localName)throw new Error("MetadataFactory error parsing SVG: Expected 'length', found '"+a.nodeName+"'");r.Height=Number(a.textContent),r.AudioTracks=[];for(var s=a.nextElementSibling,u=s.firstElementChild;u;){var h=AudioData.AudioSource.StringToType(n.attr(u,"type"));r.AudioTracks.push(new AudioData.AudioSource(n.attr(u,"src"),h)),u=u.nextElementSibling}return r},t.prototype.ToSVG=function(t){var e=n.CreateElement("metadata"),r=n.CreateElement("length");r.textContent=t.Length.toFixed(3),e.appendChild(r),r=null;var o=n.CreateElement("width");o.textContent=t.Width.toFixed(0),e.appendChild(o),o=null;var i=n.CreateElement("height");i.textContent=t.Height.toFixed(0),e.appendChild(i),i=null;for(var a=n.CreateElement("audio"),s=0;s<t.AudioTracks.length;s++){var u=t.AudioTracks[s],h=n.CreateElement("source",{type:u.MimeType,src:u.Url});a.appendChild(h),h=null}return e.appendChild(a),e},t}();t.MetadataFactory=r}(e=t.SVGAnimation||(t.SVGAnimation={}))}(VideoFormat||(VideoFormat={}));var VideoFormat;!function(t){var e;!function(t){var e=VideoData.Video,n=Helpers.SVG,r=Helpers.SVGA,o=function(){function o(){this.VideoChunksLayerType="video-chunks",this.commandFactory=new t.MoveCursorFactory(new t.DrawSegmentFactory(new t.ChangeBrushColorFactory(new t.ChangeBrushSizeFactory(new t.ClearCanvasFactory)))),this.chunkFactory=new t.VoidChunkFactory(new t.PathChunkFactory(new t.EraseChunkFactory)),this.metadataFactory=new t.MetadataFactory}return o.prototype.SaveVideo=function(t){var e=document.implementation.createDocumentType("svg:svg","-//W3C//DTD SVG 1.1//EN","http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd"),o=document.implementation.createDocument("http://www.w3.org/2000/svg","svg",e);o.documentElement.setAttributeNS("http://www.w3.org/2000/xmlns/","xmlns:a",r.Namespace),n.SetAttributes(o.rootElement,{width:t.Metadata.Width,height:t.Metadata.Height,viewBox:"0 0 "+t.Metadata.Width+" "+t.Metadata.Height}),o.rootElement.appendChild(this.metadataFactory.ToSVG(t.Metadata));var i=n.CreateElement("g");for(r.SetAttributes(i,{type:this.VideoChunksLayerType}),t.Rewind();t.CurrentChunk;)i.appendChild(this.chunkFactory.ToSVG(t.CurrentChunk,this.commandFactory)),t.MoveNextChunk();o.rootElement.appendChild(i);var a=new XMLSerializer;return new Blob([a.serializeToString(o)],{type:"application/svg+xml"})},o.prototype.LoadVideo=function(t){if(t instanceof Document==!1)throw new Error("SVGAnimation IO parsing error: Document must be an XML document");var n=t;if(2!==n.documentElement.childElementCount)throw new Error("SVGAnimation document root element must have exactely two children nodes, but has "+n.documentElement.childNodes.length+" instead");var o=new e,i=n.documentElement.firstElementChild;o.Metadata=this.metadataFactory.FromSVG(i);var a=i.nextElementSibling;if("g"!==a.localName||r.attr(a,"type")!==this.VideoChunksLayerType)throw new Error("SVGAnimation IO parsing error: chunks layer must be a SVGÂ <g> node with a:type='"+this.VideoChunksLayerType+"',"+(" got <"+a.localName+"> with a:type='"+r.attr(a,"type")+"'"));for(var s=0,u=0,h=a.firstElementChild;h;){var c=this.chunkFactory.FromSVG(h,this.commandFactory);c.LastErase=s,o.PushChunk(c),c instanceof VideoData.EraseChunk&&(s=u),h=h.nextElementSibling,u++}return o.Rewind(),o},o.prototype.GetExtension=function(){return"svg"},o.prototype.GetMimeType=function(){return"application/svg+xml"},o}();t.IO=o}(e=t.SVGAnimation||(t.SVGAnimation={}))}(VideoFormat||(VideoFormat={}));var VideoFormat;!function(t){var e;!function(t){var e=VideoData.MoveCursor,n=VideoData.ChangeBrushColor,r=VideoData.ChangeBrushSize,o=VideoData.ClearCanvas,i=VideoData.DrawNextSegment,a=Helpers.maxDecPlaces,s=2,u=4,h=function(){
function t(t){this.next=t}return t.prototype.FromJSON=function(t){if(this.next)return this.next.FromJSON(t);throw new Error("Command loading failed: Unsupported node "+t.nodeName+".")},t.prototype.ToJSON=function(t){if(this.next)return this.next.ToJSON(t);throw new Error("Command export failed: Unsupported command "+typeof t+".")},t}();t.CommandFactory=h;var c=function(t){function n(){t.apply(this,arguments)}return __extends(n,t),n.prototype.FromJSON=function(r){return r.hasOwnProperty("n")===!0&&r.hasOwnProperty("t")===!0&&r.hasOwnProperty("x")===!0&&r.hasOwnProperty("y")===!0&&r.n===n.TypeName?new e(r.x,r.y,r.p||0,r.t):t.prototype.FromJSON.call(this,r)},n.prototype.ToJSON=function(r){if(r instanceof e){var o={n:n.TypeName,x:a(r.X),y:a(r.Y),t:a(r.Time,s)};return r.P>0&&(o.p=a(r.P,u)),o}return t.prototype.ToJSON.call(this,r)},n.TypeName="m",n}(h);t.MoveCursorFactory=c;var l=function(t){function e(){t.apply(this,arguments)}return __extends(e,t),e.prototype.FromJSON=function(n){return n.hasOwnProperty("n")===!0&&n.hasOwnProperty("t")===!0&&n.n===e.TypeName?new i(n.t):t.prototype.FromJSON.call(this,n)},e.prototype.ToJSON=function(n){if(n instanceof i){var r={n:e.TypeName,t:a(n.Time,s)};return r}return t.prototype.ToJSON.call(this,n)},e.TypeName="d",e}(h);t.DrawSegmentFactory=l;var p=function(t){function e(){t.apply(this,arguments)}return __extends(e,t),e.prototype.FromJSON=function(r){return r.hasOwnProperty("n")===!0&&r.hasOwnProperty("t")===!0&&r.hasOwnProperty("c")===!0&&r.n===e.TypeName?new n(new UI.Color("",r.c),r.t):t.prototype.FromJSON.call(this,r)},e.prototype.ToJSON=function(r){if(r instanceof n){var o={n:e.TypeName,t:a(r.Time,s),c:r.Color.CssValue};return o}return t.prototype.ToJSON.call(this,r)},e.TypeName="c",e}(h);t.ChangeBrushColorFactory=p;var d=function(t){function e(){t.apply(this,arguments)}return __extends(e,t),e.prototype.FromJSON=function(n){return n.hasOwnProperty("n")===!0&&n.hasOwnProperty("t")===!0&&n.hasOwnProperty("d")===!0&&n.hasOwnProperty("u")===!0&&n.n===e.TypeName?new r(new UI.BrushSize("",n.d,n.u),n.t):t.prototype.FromJSON.call(this,n)},e.prototype.ToJSON=function(n){if(n instanceof r){var o={n:e.TypeName,t:a(n.Time,s),d:a(n.Size.Size,2),u:n.Size.Unit};return o}return t.prototype.ToJSON.call(this,n)},e.TypeName="s",e}(h);t.ChangeBrushSizeFactory=d;var f=function(t){function e(){t.apply(this,arguments)}return __extends(e,t),e.prototype.FromJSON=function(n){return n.hasOwnProperty("n")===!0&&n.hasOwnProperty("t")===!0&&n.hasOwnProperty("c")===!0&&n.n===e.TypeName?new o(n.t,new UI.Color("",n.c)):t.prototype.FromJSON.call(this,n)},e.prototype.ToJSON=function(n){if(n instanceof o){var r={n:e.TypeName,t:a(n.Time,s),c:n.Color.CssValue};return r}return t.prototype.ToJSON.call(this,n)},e.TypeName="e",e}(h);t.ClearCanvasFactory=f}(e=t.JSONAnimation||(t.JSONAnimation={}))}(VideoFormat||(VideoFormat={}));var VideoFormat;!function(t){var e;!function(t){var e=VideoData.VoidChunk,n=VideoData.PathChunk,r=VideoData.EraseChunk,o=Helpers.maxDecPlaces,i=Helpers.Vector2,a=function(){function t(t){this.next=t}return t.prototype.FromJSON=function(t,e){if(this.next)return this.next.FromJSON(t,e);throw new Error("Chunk loading failed: Unsupported node "+t+".")},t.prototype.ToJSON=function(t,e){if(this.next)return this.next.ToJSON(t,e);throw new Error("Chunk export failed: Unsupported command "+typeof t+".")},t.prototype.CommandsFromJSON=function(t,e){for(var n=[],r=0;r<t.length;r++)n.push(e.FromJSON(t[r]));return n},t.prototype.CommandsToJSON=function(t,e){for(var n=[],r=0;r<t.length;r++)n.push(e.ToJSON(t[r]));return n},t}();t.ChunkFactory=a;var s=function(t){function n(){t.apply(this,arguments)}return __extends(n,t),n.prototype.FromJSON=function(r,o){if(r.hasOwnProperty("type")&&r.type===n.TypeName&&r.hasOwnProperty("t")&&r.hasOwnProperty("lastErase")){var i=new e(r.t,r.lastErase);if(r.hasOwnProperty("init")===!1||Array.isArray(r.init)===!1)throw new Error("Node "+r+" has no 'init' attr or it is not an array");if(r.hasOwnProperty("cmds")===!1&&Array.isArray(r.cmds)===!1)throw new Error("Node "+r+" has no 'cmds' attr or it is not an array");i.InitCommands=this.CommandsFromJSON(r.init,o);for(var a=this.CommandsFromJSON(r.cmds,o),s=0;s<a.length;s++)i.PushCommand(a[s]);return i}return t.prototype.FromJSON.call(this,r,o)},n.prototype.ToJSON=function(r,i){return r instanceof e?{type:n.TypeName,t:o(r.StartTime),lastErase:r.LastErase,init:this.CommandsToJSON(r.Commands,i),cmds:this.CommandsToJSON(r.Commands,i)}:t.prototype.ToJSON.call(this,r,i)},n.TypeName="void",n}(a);t.VoidChunkFactory=s;var u=function(){function t(t){this.next=t}return t.prototype.FromJSON=function(t){if(this.next)return this.next.FromJSON(t);throw new Error("Unsupported segment "+t)},t.prototype.ToJSON=function(t){if(this.next)return this.next.ToJSON(t);throw new Error("Unsupported segment "+typeof t)},t}(),h=function(t){function e(){t.apply(this,arguments)}return __extends(e,t),e.prototype.ToJSON=function(e){return e instanceof Drawing.CurvedSegment?{t:"curved",l:{s:[o(e.LeftBezier.Start.X),o(e.LeftBezier.Start.Y)],sc:[o(e.LeftBezier.StartCP.X),o(e.LeftBezier.StartCP.Y)],e:[o(e.LeftBezier.End.X),o(e.LeftBezier.End.Y)],ec:[o(e.LeftBezier.EndCP.X),o(e.LeftBezier.EndCP.Y)]},r:{s:[o(e.RightBezier.Start.X),o(e.RightBezier.Start.Y)],sc:[o(e.RightBezier.StartCP.X),o(e.RightBezier.StartCP.Y)],e:[o(e.RightBezier.End.X),o(e.RightBezier.End.Y)],ec:[o(e.RightBezier.EndCP.X),o(e.RightBezier.EndCP.Y)]}}:t.prototype.ToJSON.call(this,e)},e.prototype.FromJSON=function(e){if(e.hasOwnProperty("t")&&"curved"===e.t){if(e.hasOwnProperty("l")&&e.hasOwnProperty("r")&&e.l.hasOwnProperty("s")&&e.l.hasOwnProperty("sc")&&e.l.hasOwnProperty("e")&&e.l.hasOwnProperty("ec")&&e.r.hasOwnProperty("s")&&e.r.hasOwnProperty("sc")&&e.r.hasOwnProperty("e")&&e.r.hasOwnProperty("ec")&&Array.isArray(e.l.s)&&Array.isArray(e.l.sc)&&Array.isArray(e.l.e)&&Array.isArray(e.l.ec)&&Array.isArray(e.r.s)&&Array.isArray(e.r.sc)&&Array.isArray(e.r.e)&&Array.isArray(e.r.ec)&&2===e.l.s.length&&2===e.l.sc.length&&2===e.l.e.length&&2===e.l.ec.length&&2===e.r.s.length&&2===e.r.sc.length&&2===e.r.e.length&&2===e.r.ec.length){var n=new Helpers.BezierCurveSegment(new i(e.l.s[0],e.l.s[1]),new i(e.l.sc[0],e.l.sc[1]),new i(e.l.e[0],e.l.e[1]),new i(e.l.ec[0],e.l.ec[1])),r=new Helpers.BezierCurveSegment(new i(e.r.s[0],e.r.s[1]),new i(e.r.sc[0],e.r.sc[1]),new i(e.r.e[0],e.r.e[1]),new i(e.r.ec[0],e.r.ec[1]));return new Drawing.CurvedSegment(n,r)}throw new Error("Error parsing 'curved' segment JSON")}return t.prototype.FromJSON.call(this,e)},e}(u),c=function(t){function e(){t.apply(this,arguments)}return __extends(e,t),e.prototype.ToJSON=function(e){return e instanceof Drawing.QuadrilateralSegment?{t:"quad",l:[o(e.Left.X),o(e.Left.Y)],r:[o(e.Right.X),o(e.Right.Y)]}:t.prototype.ToJSON.call(this,e)},e.prototype.FromJSON=function(e){if(e.hasOwnProperty("t")&&"quad"===e.t){if(e.hasOwnProperty("l")&&e.hasOwnProperty("r")&&Array.isArray(e.l)&&Array.isArray(e.r)&&2===e.l.length&&2===e.r.length)return new Drawing.QuadrilateralSegment(new i(e.l[0],e.l[1]),new i(e.r[0],e.r[1]));throw new Error("Error parsing 'quadrilateral' segment JSON")}return t.prototype.FromJSON.call(this,e)},e}(u),l=function(t){function e(){t.apply(this,arguments)}return __extends(e,t),e.prototype.ToJSON=function(e){return e instanceof Drawing.QuadrilateralSegment?{t:"zero",l:[o(e.Left.X),o(e.Left.Y)],r:[o(e.Right.X),o(e.Right.Y)]}:t.prototype.ToJSON.call(this,e)},e.prototype.FromJSON=function(e){if(e.hasOwnProperty("t")&&"zero"===e.t){if(e.hasOwnProperty("l")&&e.hasOwnProperty("r")&&Array.isArray(e.l)&&Array.isArray(e.r)&&2===e.l.length&&2===e.r.length)return new Drawing.ZeroLengthSegment(new i(e.l[0],e.l[1]),new i(e.r[0],e.r[1]));throw new Error("Error parsing 'zerolength' segment JSON")}return t.prototype.FromJSON.call(this,e)},e}(u),p=function(t){function e(e){t.call(this,e),this.segmentFactory=new h(new c(new l))}return __extends(e,t),e.prototype.FromJSON=function(r,o){if(r.hasOwnProperty("type")&&r.type===e.TypeName&&r.hasOwnProperty("t")&&r.hasOwnProperty("lastErase")){if(r.hasOwnProperty("path")===!1&&r.path.hasOwnProperty("color")&&r.path.hasOwnProperty("segments")&&Array.isArray(r.path.segments))throw new Error("Path chunk must have a valid 'path' attr");if(r.hasOwnProperty("init")===!1||Array.isArray(r.init)===!1)throw new Error("Node "+r+" has no 'init' attr or it is not an array");if(r.hasOwnProperty("cmds")===!1&&Array.isArray(r.cmds)===!1)throw new Error("Node "+r+" has no 'cmds' attr or it is not an array");var i=new Drawing.Path(!0,r.path.color);i.Segments=[];for(var a=0;a<r.path.segments.length;a++)i.Segments.push(this.segmentFactory.FromJSON(r.path.segments[a]));var s=new n(i,r.t,r.lastErase);s.InitCommands=this.CommandsFromJSON(r.init,o);for(var u=this.CommandsFromJSON(r.cmds,o),a=0;a<u.length;a++)s.PushCommand(u[a]);return s}return t.prototype.FromJSON.call(this,r,o)},e.prototype.ToJSON=function(e,r){if(e instanceof n){for(var i=[],a=0;a<e.Path.Segments.length;a++)i.push(this.segmentFactory.ToJSON(e.Path.Segments[a]));return{type:"path",t:o(e.StartTime),lastErase:e.LastErase,path:{color:e.Path.Color,segments:i},init:this.CommandsToJSON(e.InitCommands,r),cmds:this.CommandsToJSON(e.Commands,r)}}return t.prototype.ToJSON.call(this,e,r)},e.TypeName="path",e}(a);t.PathChunkFactory=p;var d=function(t){function e(){t.apply(this,arguments)}return __extends(e,t),e.prototype.FromJSON=function(n,o){if(n.hasOwnProperty("type")&&n.type===e.TypeName&&n.hasOwnProperty("t")&&n.hasOwnProperty("lastErase")){if(n.hasOwnProperty("color")===!1)throw new Error("Erase chunk must have a valid 'color' attr");if(n.hasOwnProperty("init")===!1||Array.isArray(n.init)===!1)throw new Error("Node "+n+" has no 'init' attr or it is not an array");if(n.hasOwnProperty("cmds")===!1&&Array.isArray(n.cmds)===!1)throw new Error("Node "+n+" has no 'cmds' attr or it is not an array");var i=new r(new UI.Color("",n.color),n.t,n.lastErase);i.InitCommands=this.CommandsFromJSON(n.init,o);for(var a=this.CommandsFromJSON(n.cmds,o),s=0;s<a.length;s++)i.PushCommand(a[s]);return i}return t.prototype.FromJSON.call(this,n,o)},e.prototype.ToJSON=function(n,i){return n instanceof r?{type:e.TypeName,t:o(n.StartTime),lastErase:n.LastErase,color:n.Color.CssValue,init:this.CommandsToJSON(n.Commands,i),cmds:this.CommandsToJSON(n.Commands,i)}:t.prototype.ToJSON.call(this,n,i)},e.TypeName="erase",e}(a);t.EraseChunkFactory=d}(e=t.JSONAnimation||(t.JSONAnimation={}))}(VideoFormat||(VideoFormat={}));var VideoFormat;!function(t){var e;!function(t){var e=VideoData.Metadata,n=function(){function t(){}return t.prototype.FromJSON=function(t){var n=new e;if(t.hasOwnProperty("length")===!1)throw new Error("MetadataFactory error parsing JSON: 'length' is missing");if(n.Length=Number(t.length),t.hasOwnProperty("width")===!1)throw new Error("MetadataFactory error parsing JSON: 'width' is missing");if(n.Width=Number(t.width),t.hasOwnProperty("height")===!1)throw new Error("MetadataFactory error parsing JSON: 'height' is missing");if(n.Height=Number(t.height),n.AudioTracks=[],t.hasOwnProperty("audio")===!1||Array.isArray(t.audio)===!1)throw new Error("MetadataFactory error parsing JSON: 'audio' is either missing, or is not an array");for(var r=0;r<t.audio.length;r++){var o=t.audio[r];if(o.hasOwnProperty("src")===!1)throw new Error("MetadataFactory error parsing JSON: 'audio["+r+"]' doesn't have 'src' attr");if(o.hasOwnProperty("type")===!1)throw new Error("MetadataFactory error parsing JSON: 'audio["+r+"]' doesn't have 'type' attr");var i=AudioData.AudioSource.StringToType(o.type);n.AudioTracks.push(new AudioData.AudioSource(o.src,i))}return n},t.prototype.ToJSON=function(t){for(var e=[],n=0;n<t.AudioTracks.length;n++)e.push({src:t.AudioTracks[n].Url,type:t.AudioTracks[n].MimeType});return{length:t.Length,width:t.Width,height:t.Height,audio:e}},t}();t.MetadataFactory=n}(e=t.JSONAnimation||(t.JSONAnimation={}))}(VideoFormat||(VideoFormat={}));var VideoFormat;!function(t){var e;!function(t){var e=VideoData.Video,n=function(){function n(){this.commandFactory=new t.MoveCursorFactory(new t.DrawSegmentFactory(new t.ChangeBrushColorFactory(new t.ChangeBrushSizeFactory(new t.ClearCanvasFactory)))),this.chunkFactory=new t.VoidChunkFactory(new t.PathChunkFactory(new t.EraseChunkFactory)),this.metadataFactory=new t.MetadataFactory}return n.prototype.SaveVideo=function(t){var e={meta:this.metadataFactory.ToJSON(t.Metadata),chunks:[]};for(t.Rewind();t.CurrentChunk;)e.chunks.push(this.chunkFactory.ToJSON(t.CurrentChunk,this.commandFactory)),t.MoveNextChunk();return new Blob([JSON.stringify(e)],{type:"application/json"})},n.prototype.LoadVideo=function(t){var n=JSON.parse(t);if(n.hasOwnProperty("meta")===!1||n.hasOwnProperty("chunks")===!1||Array.isArray(n.chunks)===!1)throw new Error("Given JSON is not a valid JSONAnimation");var r=new e;r.Metadata=this.metadataFactory.FromJSON(n.meta);for(var o=0,i=0;i<n.chunks.length;++i){var a=this.chunkFactory.FromJSON(n.chunks[i],this.commandFactory);a.LastErase=o,r.PushChunk(a),a instanceof VideoData.EraseChunk&&(o=i)}return r.Rewind(),r},n.prototype.GetExtension=function(){return"json"},n.prototype.GetMimeType=function(){return"application/json"},n}();t.IO=n}(e=t.JSONAnimation||(t.JSONAnimation={}))}(VideoFormat||(VideoFormat={}));var VectorScreencast;!function(t){var e=AudioData.AudioPlayer,n=Helpers.VideoEvents,r=Helpers.VideoEventType,o=Helpers.Errors,i=Helpers.ErrorType,a=function(){function t(t,e){var a=this;this.settings=e,this.lastMouseMoveState=null;var s=document.getElementById(t);if(s||Helpers.Errors.Report(Helpers.ErrorType.Fatal,"Container #"+t+" doesn't exist. Video Player couldn't be initialised."),window.onresize=function(){return a.MonitorResize(s)},!e.Localization){var u={NoJS:"Your browser does not support JavaScript or it is turned off. Video can't be recorded without enabled JavaScript in your browser.",DataLoadingFailed:"Unfortunatelly, downloading data failed.",DataIsCorrupted:"This video can't be played, the data is corrupted.",ControlPlayback:"Play/Pause video",Play:"Play",Pause:"Pause",Replay:"Replay",TimeStatus:"Video progress",VolumeControl:"Volume controls",VolumeUp:"Volume up",VolumeDown:"Volume down",Mute:"Mute",Busy:"Loading..."};e.Localization=u}this.timer=new Helpers.VideoTimer(!1),this.ui=e.UI?e.UI:new UI.PlayerUI(t),this.ui.Timer=this.timer,this.ui.Localization=e.Localization,e.ShowControls&&this.ui.CreateControls(!!e.Autohide),this.drawer=e.DrawingStrategy?e.DrawingStrategy:new Drawing.CanvasDrawer(!0),this.ui.AcceptCanvas(this.drawer.CreateCanvas()),s.appendChild(this.ui.GetHTML()),n.on(r.Start,function(){return a.Play()}),n.on(r.Pause,function(){return a.Pause()}),n.on(r.ReachEnd,function(){return a.Pause()}),n.on(r.ClearCanvas,function(t){return a.ClearCavnas(t)}),n.on(r.ChangeColor,function(t){return a.drawer.SetCurrentColor(t)}),n.on(r.JumpTo,function(t){return a.JumpTo(t)}),n.on(r.DrawSegment,function(){return a.DrawSegment()}),n.on(r.DrawPath,function(t){a.drawnPath.DrawWholePath(),a.drawnPath=null}),this.busyLevel=0,n.on(r.Busy,function(){return a.Busy()}),n.on(r.Ready,function(){return a.Ready()}),this.ui.SetBusyText(e.Localization.Busy),n.trigger(r.Busy),this.MonitorResize(s),Helpers.File.ReadFileAsync(e.Source,function(t){return a.ProcessVideoData(t)},function(t){o.Report(i.Warning,a.settings.Localization.DataLoadingFailed),a.ui.SetBusyText(e.Localization.DataLoadingFailed)})}return t.prototype.MonitorResize=function(t){var e=t.getBoundingClientRect();(e.width!==this.oldWidth||e.height!==this.oldHeight)&&(this.drawer.Stretch(),this.video&&this.RedrawCurrentScreen(),this.oldWidth=e.width,this.oldHeight=e.width)},t.prototype.ProcessVideoData=function(t){try{var o=this.settings.VideoFormat?this.settings.VideoFormat:new VideoFormat.SVGAnimation.IO;this.video=o.LoadVideo(t),o=null,this.audio=new e(this.video.Metadata.AudioTracks)}catch(i){return o=null,this.video=null,this.audio=null,void this.ui.SetBusyText(this.settings.Localization.DataIsCorrupted)}n.trigger(r.VideoInfoLoaded,this.video.Metadata);var a=this.drawer.SetupOutputCorrection(this.video.Metadata.Width,this.video.Metadata.Height);n.trigger(r.CanvasScalingFactor,a),this.video.RewindMinusOne(),this.MoveToNextChunk(),n.trigger(r.Ready),this.settings.Autoplay&&n.trigger(r.Start)},t.prototype.Play=function(){var t=this;this.isPlaying=!0,this.timer.Resume(),!!this.audio&&this.audio.Play(),this.ticking=requestAnimationFrame(function(){return t.Tick()})},t.prototype.Pause=function(){this.timer.Pause(),this.isPlaying=!1,!!this.audio&&this.audio.Pause(),cancelAnimationFrame(this.ticking)},t.prototype.Tick=function(){var t=this;this.Sync(),this.ticking=requestAnimationFrame(function(){return t.Tick()})},t.prototype.Sync=function(){for(;this.video.CurrentChunk;){if(void 0===this.video.CurrentChunk.CurrentCommand&&(this.MoveToNextChunk(),!this.video.CurrentChunk))return void this.ReachedEnd();if(this.video.CurrentChunk.CurrentCommand.Time>this.timer.CurrentTime())break;this.video.CurrentChunk.CurrentCommand instanceof VideoData.MoveCursor?this.lastMouseMoveState=this.video.CurrentChunk.CurrentCommand:this.video.CurrentChunk.CurrentCommand.Execute(),this.video.CurrentChunk.MoveNextCommand()}null!==this.lastMouseMoveState&&(this.lastMouseMoveState.Execute(),this.lastMouseMoveState=null),null!==this.drawnPath&&this.drawnPath.Draw()},t.prototype.MoveToNextChunk=function(){for(;;){if(this.video.MoveNextChunk(),!this.video.CurrentChunk){this.ReachedEnd();break}if(this.video.CurrentChunk.ExecuteInitCommands(),this.video.CurrentChunk instanceof VideoData.PathChunk){this.drawnPath=this.drawer.CreatePath();var t=this.video.CurrentChunk.Path;this.drawnPath.Segments=t.Segments,this.drawnPath.Color=t.Color,this.drawnSegment=0,t=this.drawnPath}else this.drawnPath=null;if(!(this.video.PeekNextChunk()&&this.video.PeekNextChunk().StartTime<=this.timer.CurrentTime()))break;this.video.CurrentChunk.Render()}},t.prototype.JumpTo=function(t){var e=this.isPlaying,o=t*this.video.Metadata.Length,i=this.timer.CurrentTime();this.timer.SetTime(o),this.audio.JumpTo(t),this.isPlaying&&n.trigger(r.Pause);var a=0;a=o>=i?this.video.FastforwardErasedChunksUntil(o):this.video.RewindToLastEraseBefore(o),a!==this.video.CurrentChunkNumber&&(this.video.SetCurrentChunkNumber=a-1,this.MoveToNextChunk()),this.Sync(),this.ui.UpdateCurrentTime(),e===!0&&n.trigger(r.Start)},t.prototype.RedrawCurrentScreen=function(){var t=this.isPlaying;this.isPlaying&&n.trigger(r.Pause);var e=0;e=this.video.RewindToLastEraseBefore(this.timer.CurrentTime()),this.video.SetCurrentChunkNumber=e-1,this.MoveToNextChunk(),this.Sync(),t===!0&&n.trigger(r.Start)},t.prototype.ReachedEnd=function(){n.trigger(r.ReachEnd)},t.prototype.ClearCavnas=function(t){this.drawer.ClearCanvas(t)},t.prototype.DrawSegment=function(){0===this.drawnSegment?(this.drawnPath.StartDrawingPath(this.drawnPath.Segments[0]),this.drawnSegment++):this.drawnPath.DrawSegment(this.drawnPath.Segments[this.drawnSegment++])},t.prototype.Busy=function(){this.busyLevel++,this.wasPlayingWhenBusy=this.wasPlayingWhenBusy||this.isPlaying,n.trigger(r.Pause),this.ui.Busy()},t.prototype.Ready=function(){0===--this.busyLevel&&(this.wasPlayingWhenBusy===!0&&(n.trigger(r.Start),this.wasPlayingWhenBusy=!1),this.ui.Ready())},t}();t.Player=a}(VectorScreencast||(VectorScreencast={}));