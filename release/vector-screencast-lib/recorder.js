var UI;!function(t){var e=function(){function t(t,e){this.name=t,this.cssValue=e}return Object.defineProperty(t.prototype,"Name",{get:function(){return this.name},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"CssValue",{get:function(){return this.cssValue},enumerable:!0,configurable:!0}),Object.defineProperty(t,"BackgroundColor",{get:function(){return new t(this.backgroundPrototype.Name,this.backgroundPrototype.CssValue)},set:function(t){this.backgroundPrototype=t},enumerable:!0,configurable:!0}),Object.defineProperty(t,"ForegroundColor",{get:function(){return new t(this.foregroundPrototype.Name,this.foregroundPrototype.CssValue)},set:function(t){this.foregroundPrototype=t},enumerable:!0,configurable:!0}),t.backgroundPrototype=new t("Dark gray","#111"),t.foregroundPrototype=new t("White","#fff"),t}();t.Color=e}(UI||(UI={}));var UI;!function(t){var e=function(){function t(t,e,r){this.name=t,this.size=e,this.unit=r}return Object.defineProperty(t.prototype,"Name",{get:function(){return this.name},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"Size",{get:function(){return this.size},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"Unit",{get:function(){return this.unit},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"CssValue",{get:function(){return""+this.size+this.unit},enumerable:!0,configurable:!0}),t}();t.BrushSize=e}(UI||(UI={}));var Helpers;!function(t){var e=function(){function t(){}return t.CreateElement=function(e,r,n){var o=document.createElement(e);if(r&&t.SetAttributes(o,r),n&&Array.isArray(n))for(var i in n)o.appendChild(n[i]);return o},t.SetAttributes=function(t,e){for(var r in e)t.setAttribute(r,e[r])},t}();t.HTML=e}(Helpers||(Helpers={}));var Helpers;!function(t){!function(t){t[t.Start=0]="Start",t[t.Pause=1]="Pause",t[t.Continue=2]="Continue",t[t.Stop=3]="Stop",t[t.ReachEnd=4]="ReachEnd",t[t.Replay=5]="Replay",t[t.JumpTo=6]="JumpTo",t[t.VideoInfoLoaded=7]="VideoInfoLoaded",t[t.BufferStatus=8]="BufferStatus",t[t.CursorState=9]="CursorState",t[t.ChangeColor=10]="ChangeColor",t[t.ChangeBrushSize=11]="ChangeBrushSize",t[t.StartPath=12]="StartPath",t[t.DrawSegment=13]="DrawSegment",t[t.DrawPath=14]="DrawPath",t[t.CurrentTime=15]="CurrentTime",t[t.Render=16]="Render",t[t.ClearCanvas=17]="ClearCanvas",t[t.RedrawCanvas=18]="RedrawCanvas",t[t.CanvasSize=19]="CanvasSize",t[t.CanvasScalingFactor=20]="CanvasScalingFactor",t[t.RegisterRecordingTool=21]="RegisterRecordingTool",t[t.RecordingToolFinished=22]="RecordingToolFinished",t[t.RecordingFinished=23]="RecordingFinished",t[t.StartUpload=24]="StartUpload",t[t.DownloadData=25]="DownloadData",t[t.VolumeUp=26]="VolumeUp",t[t.VolumeDown=27]="VolumeDown",t[t.Mute=28]="Mute",t[t.Busy=29]="Busy",t[t.Ready=30]="Ready",t[t.length=31]="length"}(t.VideoEventType||(t.VideoEventType={}));var e=t.VideoEventType,r=function(){function t(t){this.type=t,this.listeners=new Array(0)}return Object.defineProperty(t.prototype,"Type",{get:function(){return this.type},enumerable:!0,configurable:!0}),t.prototype.on=function(t){this.listeners.push(t)},t.prototype.off=function(t){var e=this.listeners.indexOf(t);e>=0&&this.listeners.splice(e,1)},t.prototype.trigger=function(t){for(var e=0;e<this.listeners.length;e++){var r=this.listeners[e];r.apply(this,t)}},t.prototype.triggerAsync=function(t,e){setTimeout(function(){t.apply(this,e)},0)},t}(),n=function(){function t(){}return t.on=function(e,n){t.events[e]||(t.events[e]=new r(e)),t.events[e].on(n)},t.off=function(e,r){t.events[e]&&t.events[e].off(r)},t.trigger=function(e){for(var r=[],n=1;n<arguments.length;n++)r[n-1]=arguments[n];var o=t.events[e];o&&o.trigger(r)},t.events=new Array(e.length),t}();t.VideoEvents=n}(Helpers||(Helpers={}));var AudioData;!function(t){var e=Helpers.VideoEvents,r=Helpers.VideoEventType,n=Helpers.Errors,o=Helpers.ErrorType;!function(t){t[t.MP3=0]="MP3",t[t.OGG=1]="OGG",t[t.WAV=2]="WAV"}(t.AudioSourceType||(t.AudioSourceType={}));var i=t.AudioSourceType,a=function(){function t(t,e){this.url=t,this.type=e}return Object.defineProperty(t.prototype,"Url",{get:function(){return this.url},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"Type",{get:function(){return this.type},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"MimeType",{get:function(){switch(this.type){case i.MP3:return"audio/mp3";case i.OGG:return"audio/ogg";case i.WAV:return"audio/wav";default:return null}},enumerable:!0,configurable:!0}),t.StringToType=function(t){switch(t){case"audio/mp3":return i.MP3;case"audio/wav":return i.WAV;case"audio/ogg":return i.OGG;default:throw new Error("Unknown audio type "+t)}},t}();t.AudioSource=a;var s=function(){function t(t){this.audio=this.CreateAudio(t),null===this.audio?this.isReady=!1:(this.playing=!1,this.reachedEnd=!1,this.InitAudio(),this.isReady=!0,document.documentElement.appendChild(this.audio),console.log("Audio is available."))}return Object.defineProperty(t.prototype,"IsReady",{get:function(){return this.isReady},enumerable:!0,configurable:!0}),t.prototype.CreateAudio=function(t){try{var e=new Audio;if(!e.canPlayType)return n.Report(o.Warning,"AudioPlayer: browser does not support HTML5 audio"),null;for(var r=!1,i=0;i<t.length;i++){var a=t[i];if("probably"===e.canPlayType(a.MimeType)){var s=Helpers.HTML.CreateElement("source",{src:a.Url,type:a.MimeType});e.appendChild(s),r=!0}}return r===!1?(n.Report(o.Warning,"Browser can't play any of available audio sources.",t),null):e}catch(u){return n.Report(o.Warning,"AudioPlayer: can't create audio element",u),null}},t.prototype.InitAudio=function(){var t=this;this.audio.onended=function(){return e.trigger(r.ReachEnd)},this.audio.onwaiting=function(){return t.Busy()},this.audio.oncanplay=function(){return t.Ready()},e.on(r.Mute,function(){return t.Mute()}),e.on(r.VolumeUp,function(){return t.VolumeUp()}),e.on(r.VolumeDown,function(){return t.VolumeDown()}),this.MonitorBufferingAsync()},t.prototype.Busy=function(){this.playing&&(this.triggeredBusyState=!0,e.trigger(r.Pause))},t.prototype.Ready=function(){this.triggeredBusyState&&(e.trigger(r.Ready),this.triggeredBusyState=!1)},t.prototype.Play=function(){this.isReady&&(1==this.reachedEnd&&this.Rewind(),this.audio.play())},t.prototype.InitiatePlay=function(){e.trigger(r.Start)},t.prototype.Pause=function(){this.isReady&&this.audio.pause()},t.prototype.ReachedEnd=function(){this.reachedEnd=!0,this.Pause()},t.prototype.Replay=function(){this.Rewind(),this.Play()},t.prototype.Rewind=function(){this.isReady&&(this.audio.pause(),this.audio.currentTime=0,this.reachedEnd=!1)},t.prototype.MonitorBufferingAsync=function(){var t=this,n=0;this.checkPreloaded=setInterval(function(){var o=t.audio.buffered.end(t.audio.buffered.length-1);o!==n&&(e.trigger(r.BufferStatus,o),n=o),o===t.audio.duration&&clearInterval(t.checkPreloaded)},300)},t.prototype.JumpTo=function(t){if(this.isReady){this.reachedEnd=!1;var e=this.audio.duration*t;this.ChangePosition(e),clearInterval(this.checkPreloaded),this.MonitorBufferingAsync()}},t.prototype.ChangePosition=function(t){this.audio.currentTime=t},t.prototype.Mute=function(){this.audio.muted=!this.audio.muted},t.prototype.VolumeUp=function(){this.audio.volume=Math.min(1,this.audio.volume+.1)},t.prototype.VolumeDown=function(){this.audio.volume=Math.max(0,this.audio.volume-.1)},t}();t.AudioPlayer=s}(AudioData||(AudioData={}));var Helpers;!function(t){!function(t){t[t.Silent=0]="Silent",t[t.Normal=1]="Normal",t[t.Verbose=2]="Verbose",t[t.Annoying=3]="Annoying"}(t.LogLevel||(t.LogLevel={}));var e=t.LogLevel,r=function(){function t(){}return t.SetLevel=function(t){this.level=t},t.Log=function(t){for(var e=[],r=1;r<arguments.length;r++)e[r-1]=arguments[r];t<=this.level&&console.log(e)},t.level=e.Normal,t}();t.Debug=r}(Helpers||(Helpers={}));var Helpers;!function(t){!function(t){t[t.Warning=0]="Warning",t[t.Fatal=1]="Fatal"}(t.ErrorType||(t.ErrorType={}));var e=t.ErrorType,r=function(){function r(){}return r.TurnOn=function(){this.doLog=!0},r.TurnOff=function(){this.doLog=!1},r.SetLogFunction=function(t){this.LogFunction=t},r.Report=function(t){for(var e=[],r=1;r<arguments.length;r++)e[r-1]=arguments[r];this.doLog&&this.LogFunction(t,e)},r.ErrorTypeName=function(t){switch(t){case e.Warning:return"Warning";case e.Fatal:return"Fatal error";default:return"Unknown error type"}},r.doLog=!0,r.LogFunction=function(n,o){if(n===e.Fatal)throw new Error("Fatal Error: "+o.join(";Â "));t.Debug.Log(t.LogLevel.Normal,r.ErrorTypeName(n),o)},r}();t.Errors=r}(Helpers||(Helpers={}));var AudioData;!function(t){var e=Helpers.Errors,r=Helpers.ErrorType,n=Helpers.VideoEvents,o=Helpers.VideoEventType,i=function(){function i(t){this.recording=!1,this.initSuccessful=!1,this.doNotStartRecording=!1,this.settings={host:"http://localhost",port:4e3,path:"/upload/audio",recordingWorkerPath:"/js/workers/RecordingWorker.js"},t.host&&(this.settings.host=t.host),t.port&&(this.settings.port=t.port),t.path&&(this.settings.path=t.path),this.recording=!1}return i.prototype.Init=function(t){var i=this;if(navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia,navigator.getUserMedia&&window.hasOwnProperty("AudioContext")){var a=new AudioContext||null;n.trigger(o.Busy),navigator.getUserMedia({video:!1,audio:!0},function(e){if(i.doNotStartRecording===!1){i.input=a.createMediaStreamSource(e);var r=2048,s=a.createScriptProcessor(r,1,1);s.onaudioprocess=function(t){return i.processData(t)},i.input.connect(s),s.connect(a.destination),i.initSuccessful=!0,i.CreateAudioProcessor("web-socket",i.settings,function(){return console.log("Audio recording is ready.")}),t&&t(),n.trigger(o.RegisterRecordingTool,"audio-recorder"),n.trigger(o.Ready)}},function(t){"PermissionDeniedError"===t.name&&e.Report(r.Warning,"User didn't allow microphone recording."),e.Report(r.Warning,"Can't record audio",t),n.trigger(o.Ready)})}else console.log("getUserMedia not supported by the browser"),e.Report(r.Warning,"getUserMedia not supported by the browser")},i.prototype.CreateAudioProcessor=function(t,n,o,i){Worker?(this.recordingWorker=new Worker(n.recordingWorkerPath),this.recordingWorker.postMessage({cmd:"init",AudioProcessorType:t||"web-sockets",port:n.port,host:n.host,path:n.path}),o&&o()):(e.Report(r.Fatal,"No web workers support - this feature is not supported by the browser."),i&&i())},i.prototype.Start=function(){return this.initSuccessful===!0?this.recordingWorker?(this.recording=!0,!0):(e.Report(r.Fatal,"No audio processor was set."),!1):(this.doNotStartRecording=!0,!1)},i.prototype.Continue=function(){return this.initSuccessful?this.recordingWorker?(this.recording=!0,!0):(e.Report(r.Fatal,"No audio processor was set."),!1):!1},i.prototype.Pause=function(){return this.initSuccessful?(this.recording=!1,!0):!1},i.prototype.Stop=function(i,a){var s=this;this.initSuccessful===!0?this.Pause()&&this.recordingWorker&&(this.recordingWorker.onmessage=function(u){var h=u.data;if(s.recordingWorker.terminate(),s.recordingWorker=null,!h.hasOwnProperty("error"))return console.log("Worker response is invalid (missing property 'error')",u.data),void a();if(h.error===!0)return e.Report(r.Fatal,h.message),void a();n.trigger(o.RecordingToolFinished,"audio-recorder");for(var c=[],l=0;l<h.files.length;l++){var p=h.files[l],d=new t.AudioSource(p.url,t.AudioSource.StringToType(p.type));c.push(d)}i(c)},this.recordingWorker.postMessage({cmd:"finish"})):(e.Report(r.Warning,"Can't stop AudioRecorder - it wasn't ever initialised."),a())},i.prototype.isRecording=function(){return this.initSuccessful},i.prototype.processData=function(t){if(this.recording!==!1){var e=t.inputBuffer.getChannelData(0);this.recordingWorker&&this.recordingWorker.postMessage({cmd:"pushData",data:e})}},i}();t.AudioRecorder=i}(AudioData||(AudioData={}));var Helpers;!function(t){var e=function(){function t(t,e){this.x=t,this.y=e}return Object.defineProperty(t.prototype,"X",{get:function(){return this.x},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"Y",{get:function(){return this.y},enumerable:!0,configurable:!0}),t.prototype.isEqualTo=function(t){return this.X===t.X&&this.Y===t.Y},t.prototype.getSize=function(){return Math.sqrt(this.getSizeSq())},t.prototype.getSizeSq=function(){return this.x*this.x+this.y*this.y},t.prototype.distanceTo=function(t){var e=this.x-t.X,r=this.y-t.Y;return Math.sqrt(e*e+r*r)},t.prototype.normalize=function(){var t=this.getSize();if(0===t)throw new Error("Can't normalize zero vector.");return this.scale(1/t),this},t.prototype.getNormal=function(){return new t(-this.y,this.x).normalize()},t.prototype.add=function(t){return this.x+=t.X,this.y+=t.Y,this},t.prototype.subtract=function(t){return this.x-=t.X,this.y-=t.Y,this},t.prototype.scale=function(t){return this.x*=t,this.y*=t,this},t.prototype.pointInBetween=function(e){return new t((this.x+e.X)/2,(this.y+e.Y)/2)},t.prototype.clone=function(){return new t(this.x,this.y)},t}();t.Vector2=e}(Helpers||(Helpers={}));var __extends=this.__extends||function(t,e){function r(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);r.prototype=e.prototype,t.prototype=new r},Helpers;!function(t){!function(t){t[t.ChangeBrushSize=0]="ChangeBrushSize",t[t.ChangeColor=1]="ChangeColor",t[t.Cursor=2]="Cursor"}(t.StateType||(t.StateType={}));var e=t.StateType,r=function(){function t(t,e){this.type=t,this.time=e}return t.prototype.GetType=function(){return this.type},t.prototype.GetTime=function(){return this.time},t}();t.State=r;var n=function(r){function n(t,n,o,i){r.call(this,e.Cursor,t),this.x=n,this.y=o,this.pressure=i}return __extends(n,r),Object.defineProperty(n.prototype,"X",{get:function(){return this.x},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"Y",{get:function(){return this.y},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"Pressure",{get:function(){return this.pressure},enumerable:!0,configurable:!0}),n.prototype.getPosition=function(){return new t.Vector2(this.x,this.y)},n}(r);t.CursorState=n;var o=function(t){function r(r,n){t.call(this,e.ChangeColor,r),this.color=n}return __extends(r,t),Object.defineProperty(r.prototype,"Color",{get:function(){return this.color},enumerable:!0,configurable:!0}),r}(r);t.ColorState=o;var i=function(t){function r(r,n){t.call(this,e.ChangeBrushSize,r),this.size=n}return __extends(r,t),Object.defineProperty(r.prototype,"Size",{get:function(){return this.size},enumerable:!0,configurable:!0}),r}(r);t.SizeState=i}(Helpers||(Helpers={}));var Helpers;!function(t){var e=function(){function t(t){this.pauseTime=0,this.clock=window.performance?window.performance:Date,this.paused=!t,this.Reset()}return Object.defineProperty(t.prototype,"StartTime",{get:function(){return this.startTime},enumerable:!0,configurable:!0}),t.prototype.CurrentTime=function(){return this.paused?this.pauseTime:this.clock.now()-this.startTime},t.prototype.SetTime=function(t){this.paused?this.pauseTime=t:this.startTime=this.clock.now()-t},t.prototype.Pause=function(){this.pauseTime=this.CurrentTime(),this.paused=!0},t.prototype.Resume=function(){this.paused=!1,this.Reset(),this.SetTime(this.pauseTime)},t.prototype.Reset=function(){this.startTime=this.clock.now()},t}();t.VideoTimer=e}(Helpers||(Helpers={}));var VideoData;!function(t){var e=Helpers.VideoEvents,r=Helpers.VideoEventType,n=Helpers.CursorState,o=Helpers.VideoTimer,i=function(){function t(t){var n=this;this.board=t,e.on(r.Start,function(){return n.Start()}),e.on(r.Start,function(){return n.Start()}),e.on(r.Pause,function(){return n.Pause()}),e.on(r.Stop,function(){return n.Pause()}),this.timer=new o,this.timer.Pause(),this.isHoveringOverUIControl=!1}return t.prototype.getCursor=function(){return this.cursor},t.prototype.InitControlsAvoiding=function(){for(var t=this,e=document.getElementsByClassName("ui-control"),r=0;r<e.length;r++){var n=e[r];n.onmouseover=function(e){return t.isHoveringOverUIControl=!0},n.onmouseout=function(e){return t.isHoveringOverUIControl=!1}}},t.prototype.Start=function(){this.isRunning=!0,this.timer.Resume()},t.prototype.Pause=function(){this.isRunning=!1,this.timer.Pause()},t.prototype.GetPressure=function(){return this.isDown===!0&&this.isInside===!0?1:0},t.prototype.onMove=function(t){this.cursor=this.getCursorPosition(t),this.ReportAction()},t.prototype.onDown=function(t){this.isHoveringOverUIControl===!1&&(this.isDown=!0,this.cursor=this.getCursorPosition(t),this.ReportAction())},t.prototype.onUp=function(t){this.isDown=!1,this.cursor=this.getCursorPosition(t),this.ReportAction()},t.prototype.onLeave=function(t){this.GetPressure()>0&&(this.onMove(t),this.isDown=!1,this.onMove(t),this.isDown=!0),this.isInside=!1},t.prototype.onOver=function(t){this.isInside=!0},t.prototype.onLooseFocus=function(t){this.isInside=!1,this.isDown=!1},t.prototype.getCursorPosition=function(t){return(void 0==t.clientX||void 0==t.clientY)&&console.log("Wrong 'getCursorPosition' parameter. Event data required."),{x:t.clientX,y:t.clientY}},t.prototype.ReportAction=function(){var t=new n(this.timer.CurrentTime(),this.cursor.x,this.cursor.y,this.GetPressure());e.trigger(r.CursorState,t)},t}();t.PointingDevice=i}(VideoData||(VideoData={}));var VideoData;!function(t){var e=function(t){function e(e){var r=this;t.call(this,e),this.board.onmousemove=function(t){return r.onMouseMove(t)},this.board.onmousedown=function(t){return r.onMouseDown(t)},this.board.onmouseup=function(t){return r.onMouseUp(t)},this.board.onmouseleave=function(t){return r.onMouseLeave(t)},this.board.onmouseenter=function(t){return r.onMouseEnter(t)},this.board.onmouseover=function(t){return r.onMouseOver(t)}}return __extends(e,t),e.prototype.InitControlsAvoiding=function(){for(var t=this,e=document.getElementsByClassName("ui-control"),r=0;r<e.length;r++){var n=e[r];n.onmouseover=function(e){return t.isHoveringOverUIControl=!0},n.onmouseout=function(e){return t.isHoveringOverUIControl=!1}}},e.prototype.onMouseMove=function(t){this.onMove(t)},e.prototype.onMouseDown=function(t){this.onDown(t)},e.prototype.onMouseUp=function(t){this.onUp(t)},e.prototype.onMouseLeave=function(t){this.onLeave(t)},e.prototype.onMouseEnter=function(t){0===t.buttons&&(this.isDown=!1)},e.prototype.onMouseOver=function(t){this.isInside=!0},e}(t.PointingDevice);t.Mouse=e}(VideoData||(VideoData={}));var VideoData;!function(t){var e=function(t){function e(e){var r=this;t.call(this,e),e.addEventListener("touchstart",function(t){return r.TouchStart(t)}),e.addEventListener("touchend",function(t){return r.TouchEnd(t)}),e.addEventListener("touchcancel",function(t){return r.TouchEnd(t)}),e.addEventListener("touchleave",function(t){return r.TouchLeave(t)}),e.addEventListener("touchmove",function(t){return r.TouchMove(t)})}return __extends(e,t),e.prototype.TouchStart=function(t){t.preventDefault();var e=t.changedTouches,r=e[0];this.currentTouch=r.identifier,this.onDown(r)},e.prototype.TouchLeave=function(t){t.preventDefault();var e=this.filterTouch(t.changedTouches);null!==e&&this.onLeave(e)},e.prototype.TouchEnd=function(t){t.preventDefault();var e=this.filterTouch(t.changedTouches);null!==e&&(this.onUp(e),this.currentTouch=null)},e.prototype.TouchMove=function(t){t.preventDefault();var e=this.filterTouch(t.changedTouches);null!==e&&this.onMove(e)},e.prototype.filterTouch=function(t){for(var e=0;e<t.length;e++){var r=t[e];if(r.identifier===this.currentTouch)return r}return null},e}(t.PointingDevice);t.TouchEventsAPI=e}(VideoData||(VideoData={}));var VideoData;!function(t){var e=function(t){function e(e){var r=this;t.call(this,e),this.board.addEventListener("pointermove",function(t){return r.onPointerMove(t)}),this.board.addEventListener("pointerdown",function(t){return r.onPointerDown(t)}),this.board.addEventListener("pointerup",function(t){return r.onPointerUp(t)}),this.board.addEventListener("pointerleave",function(t){return r.onPointerLeave(t)}),this.board.addEventListener("pointerenter",function(t){return r.onPointerLeave(t)}),this.board.addEventListener("pointerover",function(t){return r.onPointerOver(t)}),this.currentEvent=null,this.isDown=!1}return __extends(e,t),e.prototype.GetPressure=function(){return this.isDown===!1||null===this.currentEvent?0:this.currentEvent.pressure},e.prototype.InitControlsAvoiding=function(){for(var t=this,e=document.getElementsByClassName("ui-control"),r=0;r<e.length;r++){var n=e[r];n.onpointerover=function(e){return t.isHoveringOverUIControl=!0},n.onpointerout=function(e){return t.isHoveringOverUIControl=!1}}},e.prototype.onPointerMove=function(t){this.onMove(t),this.currentEvent=t},e.prototype.onPointerDown=function(t){this.onDown(t),this.currentEvent=t},e.prototype.onPointerUp=function(t){this.onUp(t),this.currentEvent=t},e.prototype.onPointerLeave=function(t){this.onLeave(t),this.currentEvent=t},e.prototype.onPointerEnter=function(t){0===t.buttons&&(this.isDown=!1),this.currentEvent=t},e.prototype.onPointerOver=function(t){this.isInside=!0,this.currentEvent=t},e}(t.PointingDevice);t.PointerEventsAPI=e}(VideoData||(VideoData={}));var VideoData;!function(t){var e;!function(t){t[t.OutOfProximity=0]="OutOfProximity",t[t.Pen=1]="Pen",t[t.Mouse=2]="Mouse",t[t.Eraseer=3]="Eraseer"}(e||(e={}));var r=function(t){function r(e,r){t.call(this,e),this.penApi=r}return __extends(r,t),r.prototype.GetPressure=function(){return this.penApi&&this.penApi.pointerType==e.Pen?this.isInside===!0?this.penApi.pressure:0:void 0},r.IsAvailable=function(){var t=Helpers.HTML.CreateElement("object",{type:"application/x-wacomtabletplugin"});return t.style.display="none",document.body.appendChild(t),!!t.version==!0?(console.log("Wacom tablet is connected and plugin installed. Plugin version is "+t.version+"."),t.penAPI):null},r}(t.Mouse);t.WacomTablet=r}(VideoData||(VideoData={}));var Helpers;!function(t){function e(t,e){return void 0===e&&(e=i),Number(t.toFixed(e))}function r(t,r){return void 0===r&&(r=i),e(t,r).toString()}function n(t){var e,r=Math.floor(t/60);e=r+":";var n=Math.floor(t%60);return e+=9>=n?"0"+n.toString(10):n.toString(10)}function o(t){return n(Math.floor(t/1e3))}var i=3;t.maxDecPlaces=e,t.precise=r,t.secondsToString=n,t.millisecondsToString=o}(Helpers||(Helpers={}));var Helpers;!function(t){var e=t.precise,r=function(){function t(){}return Object.defineProperty(t,"Namespace",{get:function(){return this.namespace},enumerable:!0,configurable:!0}),t.CreateDot=function(t,r,n){return this.CreateElement("circle",{cx:e(t.X),cy:e(t.Y),r:e(r),fill:n,stroke:"transparent"})},t.CreateCircle=function(t,r,n){return r>0?this.CreateElement("circle",{cx:e(t.X),cy:e(t.Y),r:e(r),stroke:n,fill:"transparent","stroke-width":1}):null},t.CreateLine=function(t,r,n,o){return n>0?this.CreateElement("path",{fill:"transparent",stroke:o,"stroke-width":e(n),d:this.MoveToString(t)+" "+this.LineToString(r)}):null},t.CreateElement=function(t,e){var r=document.createElementNS(this.namespace,t);return e&&this.SetAttributes(r,e),r},t.SetAttributes=function(t,e){t||console.log(e);for(var r in e)t.setAttributeNS(null,r,e[r])},t.MoveToString=function(t){return"M "+e(t.X)+","+e(t.Y)},t.LineToString=function(t){return"L "+e(t.X)+","+e(t.Y)},t.CurveToString=function(t,r,n){return"C "+e(t.X)+","+e(t.Y)+" "+e(r.X)+","+e(r.Y)+" "+e(n.X)+","+e(n.Y)},t.ArcString=function(t,r,n){return"A "+e(r)+","+e(r)+" "+n+" 0,0 "+e(t.X)+","+e(t.Y)},t.attr=function(t,e){var r=t.attributes.getNamedItemNS(null,e);if(r)return r.textContent;throw new Error("Attribute "+e+" is missing in "+t.localName)},t.numAttr=function(t,e){return Number(t.attributes.getNamedItemNS(null,e).textContent)},t.namespace="http://www.w3.org/2000/svg",t}();t.SVG=r;var n=function(){function t(){}return Object.defineProperty(t,"Namespace",{get:function(){return this.namespace},enumerable:!0,configurable:!0}),t.CreateElement=function(t,e){var r=document.createElementNS(this.namespace,"a:"+t);return e&&this.SetAttributes(r,e),r},t.SetAttributes=function(t,e){t||console.log(e);for(var r in e){var n=document.createAttributeNS(this.namespace,"a:"+r);n.textContent=e[r],t.attributes.setNamedItemNS(n)}},t.attr=function(t,e,r){var n=t.attributes.getNamedItemNS(this.Namespace,e);if(n)return n.textContent;if(r)return r;throw new Error("Attribute "+e+" is missing in "+t.localName)},t.numAttr=function(e,r,n){return Number(t.attr(e,r,void 0!==n?n.toString():void 0))},t.namespace="http://www.rozsival.com/2015/vector-video",t}();t.SVGA=n}(Helpers||(Helpers={}));var Helpers;!function(t){var e=function(){function e(){}return e.catmullRomToBezier=function(e,n,o,i){return new r(n,new t.Vector2(-1/6*e.X+n.X+1/6*o.X,-1/6*e.Y+n.Y+1/6*o.Y),o,new t.Vector2(1/6*n.X+o.X+-1/6*i.X,1/6*n.Y+o.Y+-1/6*i.Y))},e}();t.Spline=e;var r=function(){function t(t,e,r,n){this.start=t,this.startCP=e,this.end=r,this.endCP=n}return Object.defineProperty(t.prototype,"Start",{get:function(){return this.start},set:function(t){this.start=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"StartCP",{get:function(){return this.startCP},set:function(t){this.startCP=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"End",{get:function(){return this.end},set:function(t){this.end=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"EndCP",{get:function(){return this.endCP},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"EndCp",{set:function(t){this.endCP=t},enumerable:!0,configurable:!0}),t}();t.BezierCurveSegment=r}(Helpers||(Helpers={}));var UI;!function(t){var e=Helpers.HTML,r=function(){function t(t,r){this.element=t instanceof HTMLElement?t:e.CreateElement(t),r&&(this.element.textContent=r)}return t.prototype.GetHTML=function(){return this.element},t.prototype.HasClass=function(t){return this.GetHTML().classList.contains(t)},t.prototype.AddClass=function(t){return this.AddClasses(t)},t.prototype.AddClasses=function(){for(var t=[],e=0;e<arguments.length;e++)t[e-0]=arguments[e];for(var r=0;r<t.length;r++)this.GetHTML().classList.add(t[r]);return this},t.prototype.RemoveClass=function(t){return this.RemoveClasses(t)},t.prototype.RemoveClasses=function(){for(var t=[],e=0;e<arguments.length;e++)t[e-0]=arguments[e];for(var r=0;r<t.length;r++)this.GetHTML().classList.remove(t[r]);return this},t}();t.SimpleElement=r;var n=function(t){function e(e,n){t.call(this,"button"),this.AddClass("ui-button"),this.content=new r("span",e),this.GetHTML().appendChild(this.content.GetHTML()),n&&(this.GetHTML().onclick=n)}return __extends(e,t),e.prototype.ChangeContent=function(t){return this.content.GetHTML().innerHTML=t,this},e}(r);t.Button=n;var o=function(t){function e(e,n,o){t.call(this,n,o),this.iconClass=e,this.icon=new r("span","").AddClasses("icon",e),this.AddClass("has-icon"),this.GetHTML().appendChild(this.icon.GetHTML())}return __extends(e,t),e.prototype.ChangeIcon=function(t){return this.icon.RemoveClass(this.iconClass).AddClass(t),this.iconClass=t,this},e}(n);t.IconButton=o;var i=function(t){function r(e,r,n){t.call(this,e,"",n),this.ChangeContent(r),this.AddClass("icon-only-button")}return __extends(r,t),r.prototype.ChangeContent=function(t){return e.SetAttributes(this.GetHTML(),{title:t}),this},r}(o);t.IconOnlyButton=i;var a=function(t){function e(e){t.call(this,"p",e)}return __extends(e,t),e}(r);t.Paragraph=a;var s=function(t){function e(e,r){t.call(this,"h"+e,r)}return __extends(e,t),e}(r);t.Heading=s;var u=function(t){function e(e){t.call(this,2,e)}return __extends(e,t),e}(s);t.H2=u;var h=function(){function t(t,r){this.element=e.CreateElement(t),r&&e.SetAttributes(this.element,{id:r}),this.elements=[]}return Object.defineProperty(t.prototype,"Children",{get:function(){return this.elements},enumerable:!0,configurable:!0}),t.prototype.AddChild=function(t){return this.AddChildren(t)},t.prototype.AddChildren=function(){for(var t=[],e=0;e<arguments.length;e++)t[e-0]=arguments[e];for(var r=0;r<t.length;r++)this.elements.push(t[r]),this.GetHTML().appendChild(t[r].GetHTML());return this},t.prototype.GetHTML=function(){return this.element},t.prototype.HasClass=function(t){return this.GetHTML().classList.contains(t)},t.prototype.AddClass=function(t){return this.AddClasses(t)},t.prototype.AddClasses=function(){for(var t=[],e=0;e<arguments.length;e++)t[e-0]=arguments[e];for(var r=0;r<t.length;r++)this.GetHTML().classList.add(t[r]);return this},t.prototype.RemoveClass=function(t){return this.RemoveClasses(t)},t.prototype.RemoveClasses=function(){for(var t=[],e=0;e<arguments.length;e++)t[e-0]=arguments[e];for(var r=0;r<t.length;r++)this.GetHTML().classList.remove(t[r]);return this},t}();t.Panel=h}(UI||(UI={}));var Drawing;!function(t){var e=function(){function t(){}return Object.defineProperty(t.prototype,"Left",{get:function(){throw new Error("Not implemented")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"Right",{get:function(){throw new Error("Not implemented")},enumerable:!0,configurable:!0}),t}();t.Segment=e;var r=function(t){function e(e,r){t.call(this),this.left=e,this.right=r}return __extends(e,t),Object.defineProperty(e.prototype,"Left",{get:function(){return this.left},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"Right",{get:function(){return this.right},enumerable:!0,configurable:!0}),e}(e);t.QuadrilateralSegment=r;var n=function(t){function e(e,r){t.call(this,e,r)}return __extends(e,t),e}(r);t.ZeroLengthSegment=n;var o=function(t){function e(e,r){t.call(this),this.left=e,this.right=r}return __extends(e,t),Object.defineProperty(e.prototype,"Left",{get:function(){return this.left.End},set:function(t){this.left.End=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"Right",{get:function(){return this.right.End},set:function(t){this.right.End=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"LeftBezier",{get:function(){return this.left},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"RightBezier",{get:function(){return this.right},enumerable:!0,configurable:!0}),e}(e);t.CurvedSegment=o}(Drawing||(Drawing={}));var Drawing;!function(t){var e=Helpers.SVG,r=Helpers.Vector2,n=Helpers.VideoEvents,o=Helpers.VideoEventType,i=function(){function e(t,e,r){this.curved=t,this.color=e,this.wireframe=r,void 0===this.wireframe&&(this.wireframe=!1),this.segments=[],this.pathPoints=[]}return Object.defineProperty(e.prototype,"Segments",{get:function(){return this.segments},set:function(t){this.segments=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"LastDrawnSegment",{get:function(){return this.lastDrawnSegment},set:function(t){this.lastDrawnSegment=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"LastPoint",{get:function(){return this.pathPoints[this.iterator]},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"LastButOnePoint",{get:function(){return this.pathPoints[Math.max(0,this.iterator-1)]},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"LastButTwoPoint",{get:function(){return this.pathPoints[Math.max(0,this.iterator-2)]},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"Color",{get:function(){return this.color},enumerable:!0,configurable:!0}),e.prototype.StartPath=function(e,n){this.segments=[new t.ZeroLengthSegment(e.clone().add(new r(0,n)),e.clone().add(new r(0,-n)))],this.startPosition=e,this.startRadius=n,this.iterator=-1,this.DrawStartDot(e,n),this.lastDrawnSegment=this.segments[0]},e.prototype.DrawStartDot=function(t,e){throw new Error("Not impelmented")},e.prototype.InitPath=function(e,r){this.segments=[new t.ZeroLengthSegment(r,e)],this.pathPoints.push({Left:r,Right:e}),this.iterator=0},e.prototype.StartDrawingPath=function(t){this.DrawStartDot(t.Left.pointInBetween(t.Right),t.Left.distanceTo(t.Right)/2),this.lastDrawnSegment=t},e.prototype.ExtendPath=function(t,e){var r=this.CalculateSegment(t,e);this.DrawSegment(r),n.trigger(o.DrawSegment,r),this.segments.push(r),this.pathPoints.push({Left:e,Right:t}),this.iterator++},e.prototype.CalculateSegment=function(t,e){
return this.curved?this.CalculateCurvedSegment(t,e):this.CalculateQuarilateralSegment(t,e)},e.prototype.CalculateCurvedSegment=function(e,r){var n=Helpers.Spline.catmullRomToBezier(this.LastButTwoPoint.Left,this.LastButOnePoint.Left,this.LastPoint.Left,r),o=Helpers.Spline.catmullRomToBezier(this.LastButTwoPoint.Right,this.LastButOnePoint.Right,this.LastPoint.Right,e),i=new t.CurvedSegment(n,o);return this.DrawCurvedSegment(i),i},e.prototype.DrawCurvedSegment=function(t){throw new Error("Not implemented")},e.prototype.CalculateQuarilateralSegment=function(e,r){return new t.QuadrilateralSegment(r,e)},e.prototype.DrawQuadrilateralSegment=function(t){throw new Error("Not implemented")},e.prototype.Draw=function(){},e.prototype.DrawSegment=function(e){e instanceof t.CurvedSegment?this.DrawCurvedSegment(e):e instanceof t.QuadrilateralSegment&&this.DrawQuadrilateralSegment(e),this.lastDrawnSegment=e},e.angle=function(t){return Math.atan2(-t.X,t.Y)-Math.PI/2},e.prototype.DrawWholePath=function(){if(this.iterator=0,0!==this.segments.length){var t=this.segments[0].Left.clone().add(this.segments[0].Right).scale(.5),e=t.distanceTo(this.segments[0].Left);for(this.DrawStartDot(t,e),this.lastDrawnSegment=this.segments[0];this.iterator<this.segments.length;)this.DrawSegment(this.segments[this.iterator++]);this.Draw()}},e}();t.Path=i;var a=function(t){function n(e,r,n){t.call(this,e,r),this.canvas=n}return __extends(n,t),n.prototype.DrawStartDot=function(t,n){this.path=this.CreatePathElement();var o=new r(t.X-n,t.Y),a=new r(t.X+n,t.Y),s=a.pointInBetween(o),u=o.clone().subtract(s),h=a.clone().subtract(s),c=e.ArcString(a,s.distanceTo(a),i.angle(u));this.right=e.MoveToString(a),this.left=e.LineToString(o)+" "+c,this.cap=e.ArcString(o,s.distanceTo(o),i.angle(h)),e.SetAttributes(this.path,{d:this.right+this.cap+this.left}),this.canvas.appendChild(this.path)},n.prototype.InitPath=function(e,r){t.prototype.InitPath.call(this,e,r),this.StartDrawingPath(this.segments[0])},n.prototype.CreatePathElement=function(){var t;return t=this.wireframe?{stroke:this.color,"stroke-width":1}:{fill:this.color},e.CreateElement("path",t)},n.prototype.DrawCurvedSegment=function(t){this.right+=e.CurveToString(t.RightBezier.StartCP,t.RightBezier.EndCP,t.RightBezier.End),this.left=e.CurveToString(t.LeftBezier.EndCP,t.LeftBezier.StartCP,t.LeftBezier.Start)+" "+this.left;var r=t.Right.pointInBetween(t.Left),n=t.Right.clone().subtract(r);this.cap=e.ArcString(t.Left,r.distanceTo(t.Left),i.angle(n))},n.prototype.DrawQuadrilateralSegment=function(t){this.right+=e.LineToString(t.Right),this.left=e.LineToString(this.lastDrawnSegment.Left)+" "+this.left;var r=t.Right.pointInBetween(t.Left),n=t.Right.clone().subtract(r);this.cap=e.ArcString(t.Left,r.distanceTo(t.Left),i.angle(n))},n.prototype.GetPathString=function(){return this.right+this.cap+this.left},n.prototype.Draw=function(){e.SetAttributes(this.path,{d:this.GetPathString()})},n}(i);t.SvgPath=a;var s=function(t){function e(e,r,n){t.call(this,e,r),this.context=n,this.context.fillStyle=this.color}return __extends(e,t),e.prototype.DrawStartDot=function(t,e){this.context.beginPath(),this.DrawDot(t,e),this.Draw()},e.prototype.DrawDot=function(t,e){this.context.arc(t.X,t.Y,e,0,2*Math.PI,!0)},e.prototype.DrawQuadrilateralSegment=function(t){this.context.moveTo(this.lastDrawnSegment.Right.X,this.lastDrawnSegment.Right.Y),this.context.lineTo(this.lastDrawnSegment.Left.X,this.lastDrawnSegment.Left.Y),this.context.lineTo(t.Left.X,t.Left.Y);var e=t.Left.pointInBetween(t.Right),r=t.Right.clone().subtract(e),n=t.Left.clone().subtract(e);this.context.arc(e.X,e.Y,e.distanceTo(t.Left),i.angle(r),i.angle(n),!1)},e.prototype.DrawCurvedSegment=function(t){this.context.moveTo(t.RightBezier.Start.X,t.RightBezier.Start.Y),this.context.lineTo(t.LeftBezier.Start.X,t.LeftBezier.Start.Y),this.context.bezierCurveTo(t.LeftBezier.StartCP.X,t.LeftBezier.StartCP.Y,t.LeftBezier.EndCP.X,t.LeftBezier.EndCP.Y,t.LeftBezier.End.X,t.LeftBezier.End.Y);var e=t.RightBezier.End.pointInBetween(t.LeftBezier.End),r=t.RightBezier.End.clone().subtract(e),n=t.LeftBezier.End.clone().subtract(e);this.context.arc(e.X,e.Y,e.distanceTo(t.LeftBezier.End),i.angle(r),i.angle(n),!1),this.context.bezierCurveTo(t.RightBezier.EndCP.X,t.RightBezier.EndCP.Y,t.RightBezier.StartCP.X,t.RightBezier.StartCP.Y,t.RightBezier.Start.X,t.RightBezier.Start.Y)},e.prototype.Draw=function(){this.context.closePath(),this.context.fill(),this.context.beginPath()},e}(i);t.CanvasPath=s}(Drawing||(Drawing={}));var Drawing;!function(t){var e=Helpers.SVG,r=function(){function r(t){void 0===t&&(t=!0),this.curved=t}return r.prototype.CreateCanvas=function(){this.svg=e.CreateElement("svg");var t=e.CreateElement("g");return this.bg=e.CreateElement("rect",{id:"background"}),t.appendChild(this.bg),this.svg.appendChild(t),this.canvas=e.CreateElement("g",{id:"canvas"}),this.svg.appendChild(this.canvas),this.svg},r.prototype.Stretch=function(){var t=this.svg.parentElement,e=t.clientWidth,r=t.clientHeight;Helpers.SVG.SetAttributes(this.svg,{width:e,height:r}),Helpers.SVG.SetAttributes(this.bg,{width:e,height:r}),Helpers.VideoEvents.trigger(Helpers.VideoEventType.CanvasSize,e,r)},r.prototype.ClearCanvas=function(t){for(;this.canvas.firstChild;)this.canvas.removeChild(this.canvas.firstChild);e.SetAttributes(this.bg,{fill:t.CssValue})},r.prototype.SetCurrentColor=function(t){this.currentColor=t},r.prototype.CreatePath=function(){return new t.SvgPath(this.curved,this.currentColor.CssValue,this.canvas)},r.prototype.SetupOutputCorrection=function(t,r){var n=this.svg.clientWidth/t,o=this.svg.clientHeight/r,i=Math.min(n,o);return e.SetAttributes(this.svg,{viewBox:"0 0 "+t+" "+r}),i},r}();t.SVGDrawer=r}(Drawing||(Drawing={}));var Drawing;!function(t){var e=Helpers.HTML,r=function(){function r(t){void 0===t&&(t=!0),this.curved=t}return r.prototype.CreateCanvas=function(){return this.canvas=e.CreateElement("canvas"),this.context=this.canvas.getContext("2d"),this.canvas},r.prototype.Stretch=function(){var t=this.canvas.parentElement,e=t.clientWidth,r=t.clientHeight;this.originalHeight=r,this.originalWidth=e,Helpers.HTML.SetAttributes(this.canvas,{width:e,height:r}),Helpers.VideoEvents.trigger(Helpers.VideoEventType.CanvasSize,e,r)},r.prototype.SetupOutputCorrection=function(t,e){var r=this.canvas.width/t,n=this.canvas.height/e,o=Math.min(r,n);return this.canvas.width=o*t,this.canvas.height=o*e,this.context.scale(o,o),this.originalHeight=e,this.originalWidth=t,o},r.prototype.ClearCanvas=function(t){this.context.fillStyle=t.CssValue,this.context.fillRect(0,0,this.originalWidth,this.originalHeight)},r.prototype.SetCurrentColor=function(t){this.currentColor=t},r.prototype.CreatePath=function(){return new t.CanvasPath(this.curved,this.currentColor.CssValue,this.context)},r}();t.CanvasDrawer=r}(Drawing||(Drawing={}));var Drawing;!function(t){var e=Helpers.Vector2,r=Helpers.VideoEvents,n=Helpers.VideoEventType,o=function(){function t(t,e,r,n,o){var i=this;this.pathFactory=t,this.slowSimulation=e,this.minBrushSize=r,this.maxBrushSize=n,this.minMass=1,this.maxMass=10,this.minFriction=.4,this.maxFriction=.6,this.brushes={},this.oneFrame=1e3/60,this.cursor=new a(!0,o),requestAnimationFrame(e===!0?function(t){i.lastAnimationTime=t,i.Tick(t)}:function(){return i.TickWhile()})}return t.prototype.SetBrushSize=function(t){this.currentBrushSize=t},t.prototype.interpolateMass=function(t){return this.minMass+(this.maxMass-this.minMass)*(t-this.minBrushSize)/(this.maxBrushSize-this.minBrushSize)},t.prototype.interpolateFriction=function(t){return this.maxFriction-(this.maxFriction-this.minFriction)*(t-this.minBrushSize)/(this.maxBrushSize-this.minBrushSize)},t.prototype.GetBrush=function(t){return this.brushes[t]||(this.brushes[t]=new i(this.interpolateMass(t),this.interpolateFriction(t),t)),this.brushes[t]},t.prototype.ObserveCursorMovement=function(t){try{var o=new e(t.X,t.Y);t.Pressure>0?this.lastState&&0!==this.lastState.Pressure?this.NextPoint(o,t.Pressure):(this.path=this.pathFactory(),r.trigger(n.StartPath,this.path),this.StartPath(o,t.Pressure)):this.lastState&&this.lastState.Pressure>0&&this.EndPath(o,this.lastState.Pressure)}catch(i){console.log("ProcessNewState error: ",i)}this.lastState=t},t.prototype.StartPath=function(t,e){this.cursor.Reset(t,this.GetBrush(this.currentBrushSize.Size)),this.position=t,this.pressure=e,this.cursor.StartPath(this.path,t,e)},t.prototype.NextPoint=function(t,e){this.position=t,this.pressure=e},t.prototype.EndPath=function(t,e){this.position=null},t.prototype.TickWhile=function(){var t=this;if(this.position){var e=0,r=0;do e=this.cursor.ApplyForce(this.position,1),r+=e,r>this.currentBrushSize.Size&&(this.cursor.Draw(this.path,this.pressure),r=0);while(e>0);r>0&&this.cursor.Draw(this.path,this.pressure),this.position=null}requestAnimationFrame(function(e){return t.TickWhile()})},t.prototype.Tick=function(t){var e=this;this.path&&(this.cursor.ApplyForce(this.position,(t-this.lastAnimationTime)/this.oneFrame)>0?this.cursor.Draw(this.path,this.pressure):this.position||(this.path=null)),this.lastAnimationTime=t,requestAnimationFrame(function(t){return e.Tick(t)})},t}();t.DynaDraw=o;var i=function(){function t(t,e,r){this.mass=t,this.friction=e,this.size=r}return Object.defineProperty(t.prototype,"Mass",{get:function(){return this.mass},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"Friction",{get:function(){return this.friction},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"Size",{get:function(){return this.size},enumerable:!0,configurable:!0}),t}(),a=function(){function t(t,e){this.calculateSpeed=t,this.timer=e}return t.prototype.Reset=function(t,r){this.brush=r,this.position=t.clone(),this.startPosition=t.clone(),this.previousPosition=t.clone(),this.previousPressure=-1,this.mousePosition=t.clone(),this.acceleration=new e(0,0),this.velocity=new e(0,0),this.firstSegment=!0},t.prototype.ApplyForce=function(t,e){if(null!==t){var r=t.clone().subtract(this.position);this.acceleration=r.clone().scale(1/this.brush.Mass),this.velocity.add(this.acceleration),this.mousePosition=t}return this.velocity.scale((1-this.brush.Friction)*e),this.velocity.getSizeSq()<1?0:(console.log(t,this.velocity.getSizeSq()),t=null,r=null,this.acceleration=null,this.angle=this.velocity.getNormal(),this.position.add(this.velocity),this.velocity.getSizeSq())},t.prototype.Draw=function(t,e){var r=this.calculateSpeed===!0?this.velocity.getSize()/(this.brush.Size*this.brush.Size):0,n=this.getRadius(e,r);this.angle.scale(n),this.firstSegment&&(t.InitPath(this.startPosition.clone().add(this.angle),this.startPosition.clone().subtract(this.angle)),this.firstSegment=!1),t.ExtendPath(this.position.clone().add(this.angle),this.position.clone().subtract(this.angle)),t.Draw()},t.prototype.StartPath=function(t,e,r){t.StartPath(e,this.getRadius(r,0))},t.prototype.getRadius=function(t,e){this.previousPressure<0&&(this.previousPressure=t);var r=this.interpolatePressure(t),n=this.speedFactor(e)*this.brush.Size*r/2;return this.previousPosition=this.position,this.previousPressure=r,n},t.prototype.interpolatePressure=function(t){var e=this.position.distanceTo(this.previousPosition),r=this.position.distanceTo(this.mousePosition);return 0===e&&0===r?t:e/(e+r)*(t-this.previousPressure)+this.previousPressure},t.prototype.speedFactor=function(t){return Math.max(1-t,.4)},t.threshold=.001,t}()}(Drawing||(Drawing={}));var VideoData;!function(t){var e=function(){function t(){}return t}();t.Metadata=e}(VideoData||(VideoData={}));var VideoData;!function(t){var e=Helpers.VideoEvents,r=Helpers.VideoEventType,n=function(){function t(t){this.time=t}return Object.defineProperty(t.prototype,"Time",{get:function(){return this.time},enumerable:!0,configurable:!0}),t.prototype.Execute=function(){throw new Error("Not implemented")},t}();t.Command=n;var o=function(t){function n(e,r,n,o){t.call(this,o),this.x=e,this.y=r,this.p=n}return __extends(n,t),Object.defineProperty(n.prototype,"X",{get:function(){return this.x},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"Y",{get:function(){return this.y},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"P",{get:function(){return this.p},enumerable:!0,configurable:!0}),n.prototype.Execute=function(){e.trigger(r.CursorState,new Helpers.CursorState(this.Time,this.x,this.y,this.p))},n}(n);t.MoveCursor=o;var i=function(t){function n(){t.apply(this,arguments)}return __extends(n,t),n.prototype.Execute=function(){e.trigger(r.DrawSegment)},n}(n);t.DrawNextSegment=i;var a=function(t){function n(e,r){t.call(this,r),this.color=e}return __extends(n,t),Object.defineProperty(n.prototype,"Color",{get:function(){return this.color},enumerable:!0,configurable:!0}),n.prototype.Execute=function(){e.trigger(r.ChangeColor,this.color)},n}(n);t.ChangeBrushColor=a;var s=function(t){function n(e,r){t.call(this,r),this.size=e}return __extends(n,t),Object.defineProperty(n.prototype,"Size",{get:function(){return this.size},enumerable:!0,configurable:!0}),n.prototype.Execute=function(){e.trigger(r.ChangeBrushSize,this.size)},n}(n);t.ChangeBrushSize=s;var u=function(t){function n(e,r){t.call(this,e),this.color=r}return __extends(n,t),Object.defineProperty(n.prototype,"Color",{get:function(){return this.color},enumerable:!0,configurable:!0}),n.prototype.Execute=function(){e.trigger(r.ClearCanvas,this.color)},n}(n);t.ClearCanvas=u}(VideoData||(VideoData={}));var VideoData;!function(t){var e=Helpers.VideoEvents,r=Helpers.VideoEventType,n=function(){function t(t,e){this.time=t,this.lastErase=e,this.initCommands=[],this.commands=[],this.cmdIterator=0,this.pathIterator=0}return Object.defineProperty(t.prototype,"StartTime",{get:function(){return this.time},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"LastErase",{get:function(){return this.lastErase},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"CurrentCommand",{get:function(){return this.commands[this.cmdIterator]},enumerable:!0,configurable:!0}),t.prototype.PeekNextCommand=function(){return this.commands[this.cmdIterator+1]},t.prototype.MoveNextCommand=function(){this.cmdIterator++},t.prototype.Rewind=function(){this.cmdIterator=0},t.prototype.ExecuteInitCommands=function(){for(var t=0;t<this.initCommands.length;t++)this.initCommands[t].Execute()},t.prototype.GetCommand=function(t){return t<this.commands.length?this.commands[t]:null},t.prototype.PushCommand=function(t){this.commands.push(t)},Object.defineProperty(t.prototype,"Commands",{get:function(){return this.commands},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"InitCommands",{get:function(){return this.initCommands},set:function(t){this.initCommands=t},enumerable:!0,configurable:!0}),t.prototype.Render=function(){throw new Error("Not implemented")},t}();t.Chunk=n;var o=function(t){function e(){t.apply(this,arguments)}return __extends(e,t),Object.defineProperty(e,"NodeName",{get:function(){return"void"},enumerable:!0,configurable:!0}),e.prototype.Render=function(){},e}(n);t.VoidChunk=o;var i=function(t){function n(e,r,n){t.call(this,r,n),this.path=e}return __extends(n,t),Object.defineProperty(n,"NodeName",{get:function(){return"path"},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"Path",{get:function(){return this.path},enumerable:!0,configurable:!0}),n.prototype.Render=function(){e.trigger(r.DrawPath)},n}(n);t.PathChunk=i;var a=function(t){function n(e,r,n){t.call(this,r,n),this.color=e}return __extends(n,t),Object.defineProperty(n,"NodeName",{get:function(){return"erase"},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"Color",{get:function(){return this.color},enumerable:!0,configurable:!0}),n.prototype.Render=function(){e.trigger(r.ClearCanvas,this.color)},n}(n);t.EraseChunk=a}(VideoData||(VideoData={}));var Helpers;!function(t){var e=function(){function e(){}return e.Check=function(t,e){return 200===t.status&&e?t.getResponseHeader("ContentType")===e:!0},e.Exists=function(t,e){var r=new XMLHttpRequest;return r.open("HEAD",t,!1),r.send(),this.Check(r,e)},e.ExistsAsync=function(t,e,r,n){var o=this,i=new XMLHttpRequest;i.open("HEAD",t,!0),i.onerror=r,i.ontimeout=r,i.onload=function(t){o.Check(i,n)?e(t):r(t)},i.send()},e.ReadFileAsync=function(t,e,r){var n=new XMLHttpRequest;n.open("GET",t,!0),n.onerror=function(t){return r(n.status)},n.ontimeout=function(t){return r(n.status)},n.onload=function(t){200===n.status?e(n.responseXML?n.responseXML:n.response):r(n.status)},n.send()},e.ReadXmlAsync=function(t,e,r){var n=new XMLHttpRequest;n.open("GET",t,!0),n.onerror=function(t){return r(n.status)},n.ontimeout=function(t){return r(n.status)},n.onload=function(t){200===n.status?e(n.responseXML):r(n.status)},n.send()},e.Download=function(e,r){var n=t.HTML.CreateElement("a",{css:"display: none"});document.documentElement.appendChild(n);var o=URL.createObjectURL(e);t.HTML.SetAttributes(n,{href:o,download:r}),n.click(),URL.revokeObjectURL(o)},e.CurrentDateTime=function(){new Date;return"$(date.getMonth())-$(date.getDay())-$(date.getFullYear())_$(date.getHour())-$(date.getMinute())"},e.StartDownloadingWav=function(t){e.Download(t,"recording-"+e.CurrentDateTime()+".wav")},e.StartDownloadingXml=function(t){var r=new Blob([t],{type:"text/xml"});e.Download(r,"data-"+e.CurrentDateTime()+".xml")},e}();t.File=e}(Helpers||(Helpers={}));var VideoData;!function(t){var e=function(){function t(){this.chunks=[]}return Object.defineProperty(t.prototype,"Metadata",{get:function(){return this.metadata},set:function(t){this.metadata=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"CurrentChunk",{get:function(){return this.chunks[this.currentChunk]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"CurrentChunkNumber",{get:function(){return this.currentChunk},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"SetCurrentChunkNumber",{set:function(t){this.currentChunk=t},enumerable:!0,configurable:!0}),t.prototype.PeekNextChunk=function(){return this.chunks[this.currentChunk+1]},t.prototype.MoveNextChunk=function(){this.currentChunk++,this.CurrentChunk&&this.CurrentChunk.Rewind()},t.prototype.PushChunk=function(t){return this.currentChunk=this.chunks.push(t)-1,this.currentChunk},t.prototype.Rewind=function(){this.currentChunk=0},t.prototype.RewindMinusOne=function(){this.currentChunk=-1},t.prototype.FastforwardErasedChunksUntil=function(t){var e=this.FindChunk(t,1);return Math.max(this.currentChunk,this.chunks[e].LastErase)},t.prototype.RewindToLastEraseBefore=function(t){var e=this.FindChunk(t,-1);return this.chunks[e].LastErase},t.prototype.FindChunk=function(t,e){for(var r=Math.min(this.currentChunk,this.chunks.length-2);this.chunks[r]&&this.chunks[r+1]&&(this.chunks[r].StartTime<=t&&this.chunks[r+1].StartTime>=t)==!1;)r+=e;return 0>r?0:r},t}();t.Video=e}(VideoData||(VideoData={}));var UI;!function(t){var e=Helpers.VideoEvents,r=Helpers.VideoEventType,n=function(t){function n(e,r){var n=this;t.call(this,""),this.SetColor(e),this.GetHTML().onclick=function(t){return r?r():n.ChangeColor(t)}}return __extends(n,t),n.prototype.ChangeColor=function(t){n.active&&n.active.GetHTML().classList.remove("active"),this.GetHTML().classList.add("active"),n.active=this,e.trigger(r.ChangeColor,this.color)},n.prototype.SetColor=function(t){this.color=t,Helpers.HTML.SetAttributes(this.GetHTML(),{"class":"option","data-color":t.CssValue,title:t.Name,style:"background-color: "+t.CssValue})},n}(t.Button);t.ChangeColorButton=n;var o=function(t){function n(e){var r=this;t.call(this,""),this.size=e;var n=Helpers.HTML.CreateElement("span",{style:"width: "+e.CssValue+";	\n						height: "+e.CssValue+";\n						border-radius: "+e.Size/2+e.Unit+"; \n						display: inline-block;\n						background: black;\n						margin-top: "+-e.Size/2+e.Unit+";","class":"dot","data-size":e.Size});this.GetHTML().appendChild(n),Helpers.HTML.SetAttributes(this.GetHTML(),{"class":"option","data-size":e.Size,title:e.Name}),this.GetHTML().onclick=function(t){return r.ChangeColor(t)}}return __extends(n,t),n.prototype.ChangeColor=function(t){t.preventDefault(),n.active&&n.active.GetHTML().classList.remove("active"),this.GetHTML().classList.add("active"),n.active=this,e.trigger(r.ChangeBrushSize,this.size)},n}(t.Button);t.ChangeBrushSizeButton=o}(UI||(UI={}));var UI;!function(t){var e=Helpers.Vector2,r=function(r){function n(){r.call(this,"div"),this.radius=20,this.stroke=3,this.position=new e(0,0),this.CreateHTML(),this.scalingFactor=1,this.size=null}return __extends(n,r),n.prototype.CreateHTML=function(){var e=this;this.svg=Helpers.SVG.CreateElement("svg",{width:2*this.radius,height:2*this.radius}),this.GetHTML().appendChild(this.svg),this.bgColor=t.Color.BackgroundColor,this.color=t.Color.ForegroundColor,this.dot=Helpers.SVG.CreateDot(new Helpers.Vector2(this.radius,this.radius),this.radius-this.stroke,this.bgColor.CssValue),Helpers.SVG.SetAttributes(this.dot,{stroke:this.color.CssValue,"stroke-width":this.stroke}),this.svg.appendChild(this.dot),this.GetHTML().style.position="absolute",this.GetHTML().style.background="transparent",this.GetHTML().style.lineHeight="0",Helpers.VideoEvents.on(Helpers.VideoEventType.ClearCanvas,function(t){e.bgColor=t,Helpers.SVG.SetAttributes(e.dot,{fill:e.bgColor.CssValue}),e.ChangeColor(e.color)})},n.prototype.MoveTo=function(t,e){this.GetHTML().style.left=t*this.scalingFactor-this.radius-this.stroke+"px",this.GetHTML().style.top=e*this.scalingFactor-this.radius-this.stroke+"px",this.position=new Helpers.Vector2(t,e)},n.prototype.ChangeColor=function(e){e.CssValue===this.bgColor.CssValue&&(e=e.CssValue===t.Color.ForegroundColor.CssValue?t.Color.BackgroundColor:t.Color.ForegroundColor),Helpers.SVG.SetAttributes(this.dot,{stroke:e.CssValue}),this.color=e},n.prototype.ChangeSize=function(t){this.size=t;var e=this.radius;this.radius=t.Size*this.scalingFactor/2-2;var r=2*(this.radius+this.stroke);Helpers.SVG.SetAttributes(this.svg,{width:r,height:r});var n=e-this.radius;this.MoveTo(this.position.X+n,this.position.Y+n),Helpers.SVG.SetAttributes(this.dot,{cx:r/2,cy:r/2,r:Math.max(1,this.radius-this.stroke)})},n.prototype.SetScalingFactor=function(t){this.scalingFactor=t,this.size&&this.ChangeSize(this.size)},n}(t.SimpleElement);t.Cursor=r}(UI||(UI={}));var UI;!function(t){var e=Helpers.HTML,r=Helpers.VideoEvents,n=Helpers.VideoEventType,o=function(o){function i(i){var a=this;o.call(this,"div",i),e.SetAttributes(this.GetHTML(),{"class":"vector-video-board"}),this.cursor=new t.Cursor,this.AddChild(this.cursor),e.SetAttributes(this.GetHTML(),{position:"relative"}),r.on(n.CursorState,function(t){return a.UpdateCursorPosition(t)}),r.on(n.CursorState,function(t){return a.UpdateCursorPosition(t)}),r.on(n.ChangeBrushSize,function(t){return a.UpdateCursorSize(t)}),r.on(n.ChangeColor,function(t){return a.UpdateCursorColor(t)}),r.on(n.ChangeColor,function(t){return a.UpdateCursorColor(t)}),r.on(n.CanvasScalingFactor,function(t){return a.UpdateCursorScale(t)})}return __extends(i,o),Object.defineProperty(i.prototype,"Width",{get:function(){return this.GetHTML().clientWidth},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"Height",{get:function(){return this.GetHTML().clientHeight},set:function(t){this.GetHTML().clientHeight=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"IsRecording",{set:function(t){t?this.GetHTML().classList.add("recording"):this.GetHTML().classList.remove("recording")},enumerable:!0,configurable:!0}),i.prototype.UpdateCursorPosition=function(t){this.cursor.MoveTo(t.X,t.Y)},i.prototype.UpdateCursorSize=function(t){this.cursor.ChangeSize(t)},i.prototype.UpdateCursorColor=function(t){this.cursor.ChangeColor(t)},i.prototype.UpdateCursorScale=function(t){this.cursor.SetScalingFactor(t)},i}(t.Panel);t.Board=o}(UI||(UI={}));var UI;!function(t){var e=function(e){function r(t){e.call(this,"div",t+"-recorder"),this.id=t,this.tickingInterval=100,this.AddClass("vector-video-wrapper"),this.isRecording=!1,this.isBusy=!1}return __extends(r,e),Object.defineProperty(r.prototype,"Width",{get:function(){return this.board.Width},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"Height",{get:function(){return this.board.Height},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"BackgroundColor",{get:function(){return t.Color.BackgroundColor.CssValue},enumerable:!0,configurable:!0}),r.prototype.CreateHTML=function(e,r,n){this.board=this.CreateBoard(),this.controls=new t.Panel("div",this.id+"-controls").AddChildren(this.CreateButtonsPanel().AddClass("ui-controls-panel"),this.CreateColorsPanel(r).AddClass("ui-controls-panel"),this.CreateBrushSizesPanel(n).AddClass("ui-controls-panel"),this.CreateEraserPanel().AddClass("ui-controls-panel"),this.CreateEraseAllPanel().AddClass("ui-controls-panel")).AddClasses("ui-controls","ui-control"),!!e&&this.controls.AddClass("autohide"),this.AddChildren(this.board,new t.Panel("div").AddClass("ui-controls-wrapper").AddChild(this.controls))},r.prototype.Busy=function(){this.AddClass("busy"),this.isBusy=!0},r.prototype.Ready=function(){this.RemoveClass("busy"),this.isBusy=!1},r.prototype.SetBusyText=function(t){Helpers.HTML.SetAttributes(this.GetHTML(),{"data-busy-string":t})},r.prototype.AcceptCanvas=function(t){this.board.GetHTML().appendChild(t)},r.prototype.CreateBoard=function(){var e=new t.Board(this.id+"-board");return e},r.prototype.CreateButtonsPanel=function(){var e=this,r=new t.Panel("div",this.id+"-panels");return this.recPauseButton=new t.IconButton("icon-rec",this.Localization.Record,function(t){return e.RecordPause()}),this.uploadButton=new t.IconButton("icon-upload",this.Localization.Upload,function(t){return e.InitializeUpload()}),Helpers.HTML.SetAttributes(this.uploadButton.GetHTML(),{disabled:"disabled"}),r.AddChildren(new t.H2(this.Localization.RecPause),new t.Panel("div").AddClass("btn-group").AddChildren(this.recPauseButton,this.uploadButton)),r},r.prototype.RecordPause=function(){this.isRecording===!0?(this.PauseRecording(),this.uploadButton.GetHTML().removeAttribute("disabled"),this.RemoveClass("recording")):(this.StartRecording(),Helpers.HTML.SetAttributes(this.uploadButton.GetHTML(),{disabled:"disabled"}),this.AddClass("recording"))},r.prototype.StartRecording=function(){var t=this;this.isRecording===!1&&(this.isRecording=!0,this.recPauseButton.ChangeIcon("icon-pause"),this.board.IsRecording=!0,this.ticking=setInterval(function(){return t.Tick()},this.tickingInterval),Helpers.VideoEvents.trigger(Helpers.VideoEventType.Start))},r.prototype.PauseRecording=function(){this.isRecording===!0&&(this.isRecording=!1,this.recPauseButton.ChangeIcon("icon-rec"),this.board.IsRecording=!1,clearInterval(this.ticking),Helpers.VideoEvents.trigger(Helpers.VideoEventType.Pause))},r.prototype.Tick=function(){this.recPauseButton.ChangeContent(Helpers.millisecondsToString(this.Timer.CurrentTime()))},r.prototype.InitializeUpload=function(){Helpers.HTML.SetAttributes(this.recPauseButton.GetHTML(),{disabled:"disabled"}),Helpers.HTML.SetAttributes(this.uploadButton.GetHTML(),{disabled:"disabled"}),Helpers.VideoEvents.trigger(Helpers.VideoEventType.StartUpload)},r.prototype.CreateColorsPanel=function(e){for(var r=new t.Panel("div").AddClass("btn-group"),n=0;n<e.length;n++){var o=new t.ChangeColorButton(e[n]);r.AddChild(o)}return new t.Panel("div").AddClass("color-pallete").AddChildren(new t.H2(this.Localization.ChangeColor),r)},r.prototype.CreateBrushSizesPanel=function(e){for(var r=new t.Panel("div").AddClass("btn-group"),n=0;n<e.length;n++)r.AddChild(new t.ChangeBrushSizeButton(e[n]));return new t.Panel("div").AddClass("brush-sizes").AddChildren(new t.H2(this.Localization.ChangeSize),r)},r.prototype.CreateEraserPanel=function(){return this.switchToEraserButton=new t.ChangeColorButton(t.Color.BackgroundColor),new t.Panel("div",this.id+"-erase").AddChildren(new t.H2(this.Localization.Erase),this.switchToEraserButton)},r.prototype.CreateEraseAllPanel=function(){var e=this,r=new t.Panel("div",this.id+"-erase"),n=new t.H2(this.Localization.EraseAll);return r.AddChild(n),this.eraseAllButton=new t.ChangeColorButton(t.Color.BackgroundColor,function(){return e.EraseAll()}),Helpers.VideoEvents.on(Helpers.VideoEventType.ChangeColor,function(t){e.currentColor=t,e.eraseAllButton.SetColor(t)}),r.AddChild(this.eraseAllButton),r},r.prototype.EraseAll=function(){Helpers.VideoEvents.trigger(Helpers.VideoEventType.ClearCanvas,this.currentColor),this.switchToEraserButton.SetColor(this.currentColor)},r}(t.Panel);t.RecorderUI=e}(UI||(UI={}));var VideoFormat;!function(t){var e;!function(t){var e=VideoData.MoveCursor,r=VideoData.ChangeBrushColor,n=VideoData.ChangeBrushSize,o=VideoData.ClearCanvas,i=VideoData.DrawNextSegment,a=Helpers.SVGA,s=Helpers.precise,u=2,h=4,c=function(){function t(t){this.next=t}return t.prototype.FromSVG=function(t){if(this.next)return this.next.FromSVG(t);throw new Error("Command loading failed: Unsupported node "+t.nodeName+".")},t.prototype.ToSVG=function(t){if(this.next)return this.next.ToSVG(t);throw new Error("Command export failed: Unsupported command "+typeof t+".")},t}();t.CommandFactory=c;var l=function(t){function r(){t.apply(this,arguments)}return __extends(r,t),r.prototype.FromSVG=function(n){return n.localName===r.NodeName?new e(a.numAttr(n,"x"),a.numAttr(n,"y"),a.numAttr(n,"p",0),a.numAttr(n,"t")):t.prototype.FromSVG.call(this,n)},r.prototype.ToSVG=function(n){if(n instanceof e){var o={x:s(n.X),y:s(n.Y),t:s(n.Time,u)};return n.P>0&&(o.p=s(n.P,h)),a.CreateElement(r.NodeName,o)}return t.prototype.ToSVG.call(this,n)},r.NodeName="m",r}(c);t.MoveCursorFactory=l;var p=function(t){function e(){t.apply(this,arguments)}return __extends(e,t),e.prototype.FromSVG=function(r){return r.localName===e.NodeName?new i(a.numAttr(r,"t")):t.prototype.FromSVG.call(this,r)},e.prototype.ToSVG=function(r){return r instanceof i?a.CreateElement(e.NodeName,{t:s(r.Time,u)}):t.prototype.ToSVG.call(this,r)},e.NodeName="ds",e}(c);t.DrawSegmentFactory=p;var d=function(t){function e(){t.apply(this,arguments)}return __extends(e,t),e.prototype.FromSVG=function(n){return n.localName===e.NodeName?new r(new UI.Color("",a.attr(n,"d")),a.numAttr(n,"t")):t.prototype.FromSVG.call(this,n)},e.prototype.ToSVG=function(n){return n instanceof r?a.CreateElement(e.NodeName,{d:n.Color.CssValue,t:s(n.Time,u)}):t.prototype.ToSVG.call(this,n)},e.NodeName="c",e}(c);t.ChangeBrushColorFactory=d;var f=function(t){function e(){t.apply(this,arguments)}return __extends(e,t),e.prototype.FromSVG=function(r){return r.localName===e.NodeName?new n(new UI.BrushSize("",a.numAttr(r,"d"),a.attr(r,"u")),a.numAttr(r,"t")):t.prototype.FromSVG.call(this,r)},e.prototype.ToSVG=function(r){return r instanceof n?a.CreateElement(e.NodeName,{d:r.Size.Size,u:r.Size.Unit,t:s(r.Time,u)}):t.prototype.ToSVG.call(this,r)},e.NodeName="s",e}(c);t.ChangeBrushSizeFactory=f;var m=function(t){function e(){t.apply(this,arguments)}return __extends(e,t),e.prototype.FromSVG=function(r){return r.localName===e.NodeName?new o(a.numAttr(r,"t"),new UI.Color("",a.attr(r,"color"))):t.prototype.FromSVG.call(this,r)},e.prototype.ToSVG=function(r){return r instanceof o?a.CreateElement(e.NodeName,{t:s(r.Time,u),color:r.Color.CssValue}):t.prototype.ToSVG.call(this,r)},e.NodeName="e",e}(c);t.ClearCanvasFactory=m}(e=t.SVGAnimation||(t.SVGAnimation={}))}(VideoFormat||(VideoFormat={}));var VideoFormat;!function(t){var e;!function(t){var e=Helpers.SVG,r=Helpers.SVGA,n=VideoData.VoidChunk,o=VideoData.PathChunk,i=VideoData.EraseChunk,a=2,s=function(){function t(t){this.next=t}return t.prototype.FromSVG=function(t,e){if(this.next)return this.next.FromSVG(t,e);throw new Error("Chunk loading failed: Unsupported node "+t.nodeName+".")},t.prototype.ToSVG=function(t,e){if(this.next)return this.next.ToSVG(t,e);throw new Error("Chunk export failed: Unsupported command "+typeof t+".")},Object.defineProperty(t.prototype,"InitCommandsNodeName",{get:function(){return"init"},enumerable:!0,
configurable:!0}),t.prototype.InitCommandsFromSVG=function(t,e){if(t.localName===this.InitCommandsNodeName){for(var r=[],n=t.firstElementChild;n;)r.push(e.FromSVG(n)),n=n.nextElementSibling;return r}throw new Error("Can't read init commands from "+t.nodeName)},t.prototype.InitCommandsToSVG=function(t,e){var n=r.CreateElement(this.InitCommandsNodeName);return this.CommandsToSVG(n,t,e)},t.prototype.CommandsToSVG=function(t,e,r){for(var n=0;n<e.length;n++)t.appendChild(r.ToSVG(e[n]));return t},t}();t.ChunkFactory=s;var u=function(t){function o(){t.apply(this,arguments)}return __extends(o,t),o.prototype.FromSVG=function(e,i){if(r.attr(e,"type")===o.NodeName){var a=new n(r.numAttr(e,"t"),0),s=e.firstElementChild;a.InitCommands=this.InitCommandsFromSVG(s,i);for(var u=s.nextElementSibling;u;)a.PushCommand(i.FromSVG(u)),u=u.nextElementSibling;return a}return t.prototype.FromSVG.call(this,e,i)},o.prototype.ToSVG=function(i,s){if(i instanceof n){var u=e.CreateElement("g");return r.SetAttributes(u,{type:o.NodeName,t:i.StartTime.toFixed(a)}),u.appendChild(this.InitCommandsToSVG(i.InitCommands,s)),this.CommandsToSVG(u,i.Commands,s),u}return t.prototype.ToSVG.call(this,i,s)},o.NodeName="void",o}(s);t.VoidChunkFactory=u;var h;!function(t){t[t.Move=0]="Move",t[t.Line=1]="Line",t[t.Curve=2]="Curve",t[t.Arc=3]="Arc",t[t.Close=4]="Close"}(h||(h={}));var c=function(){function t(t,e,r,n){this.letter=t,this.type=e,this.coordsCount=r,this.next=n}return t.prototype.Create=function(t){var e=t.shift();if(e===this.letter){for(var r=[],n=0;n<this.coordsCount;n++)r.push(this.CreateVector2(t.shift()));return{type:this.type,coords:r}}if(this.next)return t.unshift(e),this.next.Create(t);throw new Error("Unsupported instruction letter '"+e+"'")},t.prototype.CreateVector2=function(t){var e=t.split(",");if(2!==e.length)throw new Error("Coordinates pair '"+t+"' is not valid");return new Helpers.Vector2(Number(e[0]),Number(e[1]))},t}(),l=function(t){function e(e){t.call(this,"A",h.Arc,3,e)}return __extends(e,t),e.prototype.Create=function(t){var e=t.shift();if(e===this.letter){var r=[];return r.push(this.CreateVector2(t.shift())),t.shift(),r.push(this.CreateVector2(t.shift())),r.push(this.CreateVector2(t.shift())),{type:this.type,coords:r}}if(this.next)return t.unshift(e),this.next.Create(t);throw new Error("Unsupported instruction letter '"+e+"'")},e}(c),p=function(t){function n(e){t.call(this,e),this.next=e,this.instructionFactory=new c("C",h.Curve,3,new c("L",h.Line,1,new c("M",h.Move,1,new l)))}return __extends(n,t),n.prototype.FromSVG=function(e,i){if(r.attr(e,"type")===n.NodeName){if(e.childElementCount<2)throw new Error("Path chunk has only "+e.childElementCount+" nodes.");var a=e.firstElementChild;if("path"!==a.localName)throw new Error("Path chunk must begin with a <path> element, but "+a.localName+" found instead");var s=a.nextElementSibling;if(s.localName!==this.InitCommandsNodeName)throw new Error("Second child of chunk must be an <init> element, but "+s.localName+" found instead");var u=this.InitCommandsFromSVG(s,i),h=new o(this.SVGNodeToPath(a),r.numAttr(e,"t"),0);h.InitCommands=u;for(var c=s.nextElementSibling;c;)h.PushCommand(i.FromSVG(c)),c=c.nextElementSibling;return h}return t.prototype.FromSVG.call(this,e,i)},n.prototype.ToSVG=function(i,s){if(i instanceof o){var u=e.CreateElement("g");return r.SetAttributes(u,{type:n.NodeName,t:i.StartTime.toFixed(a)}),u.appendChild(this.PathToSVGNode(i.Path)),u.appendChild(this.InitCommandsToSVG(i.InitCommands,s)),this.CommandsToSVG(u,i.Commands,s),u}return t.prototype.ToSVG.call(this,i,s)},n.prototype.SVGNodeToPath=function(t){var r=e.attr(t,"fill"),n=new Drawing.Path(!0,r),o=e.attr(t,"d");t=null;for(var i=o.split(" "),a=[];i.length>0;)a.push(this.instructionFactory.Create(i));i=null,o=null;var s=a.length-1;if(!(a.length>=2&&a[0].type===h.Move&&a[s].type===h.Arc))throw new Error("Only "+a.length+" valid instructions recognized in a path string");if(n.Segments.push(new Drawing.ZeroLengthSegment(a[s].coords[2],a[0].coords[0])),a.pop(),a.pop(),a.shift(),1===a.length){var u=n.Segments[0].Right,c=a[0].coords[2];return n.Segments=[new Drawing.ZeroLengthSegment(u,c)],n}s=a.length-1;for(var l=null,p=0;p<Math.floor(a.length/2);p++)if(a[p].type===h.Line){var d=new Drawing.QuadrilateralSegment(a[p].coords[0],a[s-p].coords[0]);n.Segments.push(d),l instanceof Drawing.CurvedSegment&&(l.Left=a[s-p].coords[0].clone()),l=d}else{if(a[p].type!==h.Curve)throw new Error("Unsupported path segment type "+a[p].type+" ");var f=new Helpers.BezierCurveSegment(null,a[p].coords[0],a[p].coords[2],a[p].coords[1]),m=new Helpers.BezierCurveSegment(a[s-p].coords[2],a[s-p].coords[1],null,a[s-p].coords[0]),g=new Drawing.CurvedSegment(m,f);l&&l instanceof Drawing.CurvedSegment?(l.Left=g.LeftBezier.Start.clone(),g.RightBezier.Start=l.RightBezier.End.clone()):l&&l instanceof Drawing.QuadrilateralSegment&&(g.RightBezier.Start=l.Right.clone()),n.Segments.push(g),l=g}return l&&l instanceof Drawing.CurvedSegment&&(l.Left=a[Math.floor(a.length/2)].coords[2].clone()),n},n.prototype.PathToSVGNode=function(t){for(var r=t.Segments,n=r[0],o=n.Right.pointInBetween(n.Left),i=n.Left.clone().subtract(o),a=n.Right.clone().subtract(o),s=e.ArcString(n.Right,o.distanceTo(n.Right),Drawing.Path.angle(i)),u=e.MoveToString(r[0].Right)+" ",h=e.LineToString(r[0].Left)+" "+s,c=0;c<r.length;c++){var n=r[c];if(n instanceof Drawing.CurvedSegment)u+=e.CurveToString(n.RightBezier.StartCP,n.RightBezier.EndCP,n.RightBezier.End)+" ",h=e.CurveToString(n.LeftBezier.EndCP,n.LeftBezier.StartCP,n.LeftBezier.Start)+" "+h;else{if(!(n instanceof Drawing.QuadrilateralSegment))throw new Error("Unsupported segment type "+typeof n);u+=e.LineToString(n.Right)+" ",h=e.LineToString(n.Left)+" "+h}}n=r[r.length-1],o=n.Right.pointInBetween(n.Left),i=n.Right.clone().subtract(o),a=n.Left.clone().subtract(o);var l=e.ArcString(n.Left,o.distanceTo(n.Left),Drawing.Path.angle(i))+" ";return e.CreateElement("path",{fill:t.Color,d:u+l+h})},n.NodeName="path",n}(s);t.PathChunkFactory=p;var d=function(t){function n(){t.apply(this,arguments)}return __extends(n,t),n.prototype.FromSVG=function(o,a){if(r.attr(o,"type")===n.NodeName){if(o.childElementCount<2)throw new Error("Erase chunk has only "+o.childNodes.length+" nodes.");var s=o.firstElementChild;if("rect"!==s.localName)throw new Error("Erase chunk must begin with a <rect> element, but "+s.localName+" found instead");var u=s.nextElementSibling;if(u.localName!==this.InitCommandsNodeName)throw new Error("Second child of chunk must be an <init> element, but "+u.localName+" found instead");var h=this.InitCommandsFromSVG(u,a),c=new i(new UI.Color("",e.attr(s,"fill")),r.numAttr(o,"t"),0);c.InitCommands=h;for(var l=u.nextElementSibling;l;)c.PushCommand(a.FromSVG(l)),l=l.nextElementSibling;return c}return t.prototype.FromSVG.call(this,o,a)},n.prototype.ToSVG=function(o,s){if(o instanceof i){var u=e.CreateElement("g");return r.SetAttributes(u,{type:n.NodeName,t:o.StartTime.toFixed(a)}),u.appendChild(e.CreateElement("rect",{fill:o.Color.CssValue,width:"100%",height:"100%"})),u.appendChild(this.InitCommandsToSVG(o.InitCommands,s)),this.CommandsToSVG(u,o.Commands,s),u}return t.prototype.ToSVG.call(this,o,s)},n.NodeName="erase",n}(s);t.EraseChunkFactory=d}(e=t.SVGAnimation||(t.SVGAnimation={}))}(VideoFormat||(VideoFormat={}));var VideoFormat;!function(t){var e;!function(t){var e=VideoData.Metadata,r=Helpers.SVGA,n=function(){function t(){}return t.prototype.FromSVG=function(t){var n=new e;if("metadata"!==t.localName)throw new Error("MetadataFactory error parsing SVG: Wrong metadata element "+t.localName);var o=t.firstElementChild;if("length"!==o.localName)throw new Error("MetadataFactory error parsing SVG: Expected 'length', found '"+o.nodeName+"'");n.Length=Number(o.textContent);var i=o.nextElementSibling;if(o=null,"width"!==i.localName)throw new Error("MetadataFactory error parsing SVG: Expected 'length', found '"+i.nodeName+"'");n.Width=Number(i.textContent);var a=i.nextElementSibling;if(i=null,"height"!==a.localName)throw new Error("MetadataFactory error parsing SVG: Expected 'length', found '"+a.nodeName+"'");n.Height=Number(a.textContent),n.AudioTracks=[];for(var s=a.nextElementSibling,u=s.firstElementChild;u;){var h=AudioData.AudioSource.StringToType(r.attr(u,"type"));n.AudioTracks.push(new AudioData.AudioSource(r.attr(u,"src"),h)),u=u.nextElementSibling}return n},t.prototype.ToSVG=function(t){var e=r.CreateElement("metadata"),n=r.CreateElement("length");n.textContent=t.Length.toFixed(3),e.appendChild(n),n=null;var o=r.CreateElement("width");o.textContent=t.Width.toFixed(0),e.appendChild(o),o=null;var i=r.CreateElement("height");i.textContent=t.Height.toFixed(0),e.appendChild(i),i=null;for(var a=r.CreateElement("audio"),s=0;s<t.AudioTracks.length;s++){var u=t.AudioTracks[s],h=r.CreateElement("source",{type:u.MimeType,src:u.Url});a.appendChild(h),h=null}return e.appendChild(a),e},t}();t.MetadataFactory=n}(e=t.SVGAnimation||(t.SVGAnimation={}))}(VideoFormat||(VideoFormat={}));var VideoFormat;!function(t){var e;!function(t){var e=VideoData.Video,r=Helpers.SVG,n=Helpers.SVGA,o=function(){function o(){this.VideoChunksLayerType="video-chunks",this.commandFactory=new t.MoveCursorFactory(new t.DrawSegmentFactory(new t.ChangeBrushColorFactory(new t.ChangeBrushSizeFactory(new t.ClearCanvasFactory)))),this.chunkFactory=new t.VoidChunkFactory(new t.PathChunkFactory(new t.EraseChunkFactory)),this.metadataFactory=new t.MetadataFactory}return o.prototype.SaveVideo=function(t){var e=document.implementation.createDocumentType("svg:svg","-//W3C//DTD SVG 1.1//EN","http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd"),o=document.implementation.createDocument("http://www.w3.org/2000/svg","svg",e);o.documentElement.setAttributeNS("http://www.w3.org/2000/xmlns/","xmlns:a",n.Namespace),r.SetAttributes(o.rootElement,{width:t.Metadata.Width,height:t.Metadata.Height,viewBox:"0 0 "+t.Metadata.Width+" "+t.Metadata.Height}),o.rootElement.appendChild(this.metadataFactory.ToSVG(t.Metadata));var i=r.CreateElement("g");for(n.SetAttributes(i,{type:this.VideoChunksLayerType}),t.Rewind();t.CurrentChunk;)i.appendChild(this.chunkFactory.ToSVG(t.CurrentChunk,this.commandFactory)),t.MoveNextChunk();o.rootElement.appendChild(i);var a=new XMLSerializer;return new Blob([a.serializeToString(o)],{type:"application/svg+xml"})},o.prototype.LoadVideo=function(t){if(t instanceof Document==!1)throw new Error("SVGAnimation IO parsing error: Document must be an XML document");var r=t;if(2!==r.documentElement.childElementCount)throw new Error("SVGAnimation document root element must have exactely two children nodes, but has "+r.documentElement.childNodes.length+" instead");var o=new e,i=r.documentElement.firstElementChild;o.Metadata=this.metadataFactory.FromSVG(i);var a=i.nextElementSibling;if("g"!==a.localName||n.attr(a,"type")!==this.VideoChunksLayerType)throw new Error("SVGAnimation IO parsing error: chunks layer must be a SVGÂ <g> node with a:type='"+this.VideoChunksLayerType+"',"+(" got <"+a.localName+"> with a:type='"+n.attr(a,"type")+"'"));for(var s=0,u=0,h=a.firstElementChild;h;){var c=this.chunkFactory.FromSVG(h,this.commandFactory);c.LastErase=s,o.PushChunk(c),c instanceof VideoData.EraseChunk&&(s=u),h=h.nextElementSibling,u++}return o.Rewind(),o},o.prototype.GetExtension=function(){return"svg"},o.prototype.GetMimeType=function(){return"application/svg+xml"},o}();t.IO=o}(e=t.SVGAnimation||(t.SVGAnimation={}))}(VideoFormat||(VideoFormat={}));var VideoFormat;!function(t){var e;!function(t){var e=VideoData.MoveCursor,r=VideoData.ChangeBrushColor,n=VideoData.ChangeBrushSize,o=VideoData.ClearCanvas,i=VideoData.DrawNextSegment,a=Helpers.maxDecPlaces,s=2,u=4,h=function(){function t(t){this.next=t}return t.prototype.FromJSON=function(t){if(this.next)return this.next.FromJSON(t);throw new Error("Command loading failed: Unsupported node "+t.nodeName+".")},t.prototype.ToJSON=function(t){if(this.next)return this.next.ToJSON(t);throw new Error("Command export failed: Unsupported command "+typeof t+".")},t}();t.CommandFactory=h;var c=function(t){function r(){t.apply(this,arguments)}return __extends(r,t),r.prototype.FromJSON=function(n){return n.hasOwnProperty("n")===!0&&n.hasOwnProperty("t")===!0&&n.hasOwnProperty("x")===!0&&n.hasOwnProperty("y")===!0&&n.n===r.TypeName?new e(n.x,n.y,n.p||0,n.t):t.prototype.FromJSON.call(this,n)},r.prototype.ToJSON=function(n){if(n instanceof e){var o={n:r.TypeName,x:a(n.X),y:a(n.Y),t:a(n.Time,s)};return n.P>0&&(o.p=a(n.P,u)),o}return t.prototype.ToJSON.call(this,n)},r.TypeName="m",r}(h);t.MoveCursorFactory=c;var l=function(t){function e(){t.apply(this,arguments)}return __extends(e,t),e.prototype.FromJSON=function(r){return r.hasOwnProperty("n")===!0&&r.hasOwnProperty("t")===!0&&r.n===e.TypeName?new i(r.t):t.prototype.FromJSON.call(this,r)},e.prototype.ToJSON=function(r){if(r instanceof i){var n={n:e.TypeName,t:a(r.Time,s)};return n}return t.prototype.ToJSON.call(this,r)},e.TypeName="d",e}(h);t.DrawSegmentFactory=l;var p=function(t){function e(){t.apply(this,arguments)}return __extends(e,t),e.prototype.FromJSON=function(n){return n.hasOwnProperty("n")===!0&&n.hasOwnProperty("t")===!0&&n.hasOwnProperty("c")===!0&&n.n===e.TypeName?new r(new UI.Color("",n.c),n.t):t.prototype.FromJSON.call(this,n)},e.prototype.ToJSON=function(n){if(n instanceof r){var o={n:e.TypeName,t:a(n.Time,s),c:n.Color.CssValue};return o}return t.prototype.ToJSON.call(this,n)},e.TypeName="c",e}(h);t.ChangeBrushColorFactory=p;var d=function(t){function e(){t.apply(this,arguments)}return __extends(e,t),e.prototype.FromJSON=function(r){return r.hasOwnProperty("n")===!0&&r.hasOwnProperty("t")===!0&&r.hasOwnProperty("d")===!0&&r.hasOwnProperty("u")===!0&&r.n===e.TypeName?new n(new UI.BrushSize("",r.d,r.u),r.t):t.prototype.FromJSON.call(this,r)},e.prototype.ToJSON=function(r){if(r instanceof n){var o={n:e.TypeName,t:a(r.Time,s),d:a(r.Size.Size,2),u:r.Size.Unit};return o}return t.prototype.ToJSON.call(this,r)},e.TypeName="s",e}(h);t.ChangeBrushSizeFactory=d;var f=function(t){function e(){t.apply(this,arguments)}return __extends(e,t),e.prototype.FromJSON=function(r){return r.hasOwnProperty("n")===!0&&r.hasOwnProperty("t")===!0&&r.hasOwnProperty("c")===!0&&r.n===e.TypeName?new o(r.t,new UI.Color("",r.c)):t.prototype.FromJSON.call(this,r)},e.prototype.ToJSON=function(r){if(r instanceof o){var n={n:e.TypeName,t:a(r.Time,s),c:r.Color.CssValue};return n}return t.prototype.ToJSON.call(this,r)},e.TypeName="e",e}(h);t.ClearCanvasFactory=f}(e=t.JSONAnimation||(t.JSONAnimation={}))}(VideoFormat||(VideoFormat={}));var VideoFormat;!function(t){var e;!function(t){var e=VideoData.VoidChunk,r=VideoData.PathChunk,n=VideoData.EraseChunk,o=Helpers.maxDecPlaces,i=Helpers.Vector2,a=function(){function t(t){this.next=t}return t.prototype.FromJSON=function(t,e){if(this.next)return this.next.FromJSON(t,e);throw new Error("Chunk loading failed: Unsupported node "+t+".")},t.prototype.ToJSON=function(t,e){if(this.next)return this.next.ToJSON(t,e);throw new Error("Chunk export failed: Unsupported command "+typeof t+".")},t.prototype.CommandsFromJSON=function(t,e){for(var r=[],n=0;n<t.length;n++)r.push(e.FromJSON(t[n]));return r},t.prototype.CommandsToJSON=function(t,e){for(var r=[],n=0;n<t.length;n++)r.push(e.ToJSON(t[n]));return r},t}();t.ChunkFactory=a;var s=function(t){function r(){t.apply(this,arguments)}return __extends(r,t),r.prototype.FromJSON=function(n,o){if(n.hasOwnProperty("type")&&n.type===r.TypeName&&n.hasOwnProperty("t")){var i=new e(n.t,0);if(n.hasOwnProperty("init")===!1||Array.isArray(n.init)===!1)throw new Error("Node "+n+" has no 'init' attr or it is not an array");if(n.hasOwnProperty("cmds")===!1&&Array.isArray(n.cmds)===!1)throw new Error("Node "+n+" has no 'cmds' attr or it is not an array");i.InitCommands=this.CommandsFromJSON(n.init,o);for(var a=this.CommandsFromJSON(n.cmds,o),s=0;s<a.length;s++)i.PushCommand(a[s]);return i}return t.prototype.FromJSON.call(this,n,o)},r.prototype.ToJSON=function(n,i){return n instanceof e?{type:r.TypeName,t:o(n.StartTime),init:this.CommandsToJSON(n.Commands,i),cmds:this.CommandsToJSON(n.Commands,i)}:t.prototype.ToJSON.call(this,n,i)},r.TypeName="void",r}(a);t.VoidChunkFactory=s;var u=function(){function t(t){this.next=t}return t.prototype.FromJSON=function(t){if(this.next)return this.next.FromJSON(t);throw new Error("Unsupported segment "+t)},t.prototype.ToJSON=function(t){if(this.next)return this.next.ToJSON(t);throw new Error("Unsupported segment "+typeof t)},t}(),h=function(t){function e(){t.apply(this,arguments)}return __extends(e,t),e.prototype.ToJSON=function(e){return e instanceof Drawing.CurvedSegment?{t:"curved",l:{s:[o(e.LeftBezier.Start.X),o(e.LeftBezier.Start.Y)],sc:[o(e.LeftBezier.StartCP.X),o(e.LeftBezier.StartCP.Y)],e:[o(e.LeftBezier.End.X),o(e.LeftBezier.End.Y)],ec:[o(e.LeftBezier.EndCP.X),o(e.LeftBezier.EndCP.Y)]},r:{s:[o(e.RightBezier.Start.X),o(e.RightBezier.Start.Y)],sc:[o(e.RightBezier.StartCP.X),o(e.RightBezier.StartCP.Y)],e:[o(e.RightBezier.End.X),o(e.RightBezier.End.Y)],ec:[o(e.RightBezier.EndCP.X),o(e.RightBezier.EndCP.Y)]}}:t.prototype.ToJSON.call(this,e)},e.prototype.FromJSON=function(e){if(e.hasOwnProperty("t")&&"curved"===e.t){if(e.hasOwnProperty("l")&&e.hasOwnProperty("r")&&e.l.hasOwnProperty("s")&&e.l.hasOwnProperty("sc")&&e.l.hasOwnProperty("e")&&e.l.hasOwnProperty("ec")&&e.r.hasOwnProperty("s")&&e.r.hasOwnProperty("sc")&&e.r.hasOwnProperty("e")&&e.r.hasOwnProperty("ec")&&Array.isArray(e.l.s)&&Array.isArray(e.l.sc)&&Array.isArray(e.l.e)&&Array.isArray(e.l.ec)&&Array.isArray(e.r.s)&&Array.isArray(e.r.sc)&&Array.isArray(e.r.e)&&Array.isArray(e.r.ec)&&2===e.l.s.length&&2===e.l.sc.length&&2===e.l.e.length&&2===e.l.ec.length&&2===e.r.s.length&&2===e.r.sc.length&&2===e.r.e.length&&2===e.r.ec.length){var r=new Helpers.BezierCurveSegment(new i(e.l.s[0],e.l.s[1]),new i(e.l.sc[0],e.l.sc[1]),new i(e.l.e[0],e.l.e[1]),new i(e.l.ec[0],e.l.ec[1])),n=new Helpers.BezierCurveSegment(new i(e.r.s[0],e.r.s[1]),new i(e.r.sc[0],e.r.sc[1]),new i(e.r.e[0],e.r.e[1]),new i(e.r.ec[0],e.r.ec[1]));return new Drawing.CurvedSegment(r,n)}throw new Error("Error parsing 'curved' segment JSON")}return t.prototype.FromJSON.call(this,e)},e}(u),c=function(t){function e(){t.apply(this,arguments)}return __extends(e,t),e.prototype.ToJSON=function(e){return e instanceof Drawing.QuadrilateralSegment?{t:"quad",l:[o(e.Left.X),o(e.Left.Y)],r:[o(e.Right.X),o(e.Right.Y)]}:t.prototype.ToJSON.call(this,e)},e.prototype.FromJSON=function(e){if(e.hasOwnProperty("t")&&"quad"===e.t){if(e.hasOwnProperty("l")&&e.hasOwnProperty("r")&&Array.isArray(e.l)&&Array.isArray(e.r)&&2===e.l.length&&2===e.r.length)return new Drawing.QuadrilateralSegment(new i(e.l[0],e.l[1]),new i(e.r[0],e.r[1]));throw new Error("Error parsing 'quadrilateral' segment JSON")}return t.prototype.FromJSON.call(this,e)},e}(u),l=function(t){function e(){t.apply(this,arguments)}return __extends(e,t),e.prototype.ToJSON=function(e){return e instanceof Drawing.QuadrilateralSegment?{t:"zero",l:[o(e.Left.X),o(e.Left.Y)],r:[o(e.Right.X),o(e.Right.Y)]}:t.prototype.ToJSON.call(this,e)},e.prototype.FromJSON=function(e){if(e.hasOwnProperty("t")&&"zero"===e.t){if(e.hasOwnProperty("l")&&e.hasOwnProperty("r")&&Array.isArray(e.l)&&Array.isArray(e.r)&&2===e.l.length&&2===e.r.length)return new Drawing.ZeroLengthSegment(new i(e.l[0],e.l[1]),new i(e.r[0],e.r[1]));throw new Error("Error parsing 'zerolength' segment JSON")}return t.prototype.FromJSON.call(this,e)},e}(u),p=function(t){function e(e){t.call(this,e),this.segmentFactory=new h(new c(new l))}return __extends(e,t),e.prototype.FromJSON=function(n,o){if(n.hasOwnProperty("type")&&n.type===e.TypeName&&n.hasOwnProperty("t")){if(n.hasOwnProperty("path")===!1&&n.path.hasOwnProperty("color")&&n.path.hasOwnProperty("segments")&&Array.isArray(n.path.segments))throw new Error("Path chunk must have a valid 'path' attr");if(n.hasOwnProperty("init")===!1||Array.isArray(n.init)===!1)throw new Error("Node "+n+" has no 'init' attr or it is not an array");if(n.hasOwnProperty("cmds")===!1&&Array.isArray(n.cmds)===!1)throw new Error("Node "+n+" has no 'cmds' attr or it is not an array");var i=new Drawing.Path(!0,n.path.color);i.Segments=[];for(var a=0;a<n.path.segments.length;a++)i.Segments.push(this.segmentFactory.FromJSON(n.path.segments[a]));var s=new r(i,n.t,0);s.InitCommands=this.CommandsFromJSON(n.init,o);for(var u=this.CommandsFromJSON(n.cmds,o),a=0;a<u.length;a++)s.PushCommand(u[a]);return s}return t.prototype.FromJSON.call(this,n,o)},e.prototype.ToJSON=function(e,n){if(e instanceof r){for(var i=[],a=0;a<e.Path.Segments.length;a++)i.push(this.segmentFactory.ToJSON(e.Path.Segments[a]));return{type:"path",t:o(e.StartTime),path:{color:e.Path.Color,segments:i},init:this.CommandsToJSON(e.InitCommands,n),cmds:this.CommandsToJSON(e.Commands,n)}}return t.prototype.ToJSON.call(this,e,n)},e.TypeName="path",e}(a);t.PathChunkFactory=p;var d=function(t){function e(){t.apply(this,arguments)}return __extends(e,t),e.prototype.FromJSON=function(r,o){if(r.hasOwnProperty("type")&&r.type===e.TypeName&&r.hasOwnProperty("t")){if(r.hasOwnProperty("color")===!1)throw new Error("Erase chunk must have a valid 'color' attr");if(r.hasOwnProperty("init")===!1||Array.isArray(r.init)===!1)throw new Error("Node "+r+" has no 'init' attr or it is not an array");if(r.hasOwnProperty("cmds")===!1&&Array.isArray(r.cmds)===!1)throw new Error("Node "+r+" has no 'cmds' attr or it is not an array");var i=new n(new UI.Color("",r.color),r.t,0);i.InitCommands=this.CommandsFromJSON(r.init,o);for(var a=this.CommandsFromJSON(r.cmds,o),s=0;s<a.length;s++)i.PushCommand(a[s]);return i}return t.prototype.FromJSON.call(this,r,o)},e.prototype.ToJSON=function(r,i){return r instanceof n?{type:e.TypeName,t:o(r.StartTime),color:r.Color.CssValue,init:this.CommandsToJSON(r.Commands,i),cmds:this.CommandsToJSON(r.Commands,i)}:t.prototype.ToJSON.call(this,r,i)},e.TypeName="erase",e}(a);t.EraseChunkFactory=d}(e=t.JSONAnimation||(t.JSONAnimation={}))}(VideoFormat||(VideoFormat={}));var VideoFormat;!function(t){var e;!function(t){var e=VideoData.Metadata,r=function(){function t(){}return t.prototype.FromJSON=function(t){var r=new e;if(t.hasOwnProperty("length")===!1)throw new Error("MetadataFactory error parsing JSON: 'length' is missing");if(r.Length=Number(t.length),t.hasOwnProperty("width")===!1)throw new Error("MetadataFactory error parsing JSON: 'width' is missing");if(r.Width=Number(t.width),t.hasOwnProperty("height")===!1)throw new Error("MetadataFactory error parsing JSON: 'height' is missing");if(r.Height=Number(t.height),r.AudioTracks=[],t.hasOwnProperty("audio")===!1||Array.isArray(t.audio)===!1)throw new Error("MetadataFactory error parsing JSON: 'audio' is either missing, or is not an array");for(var n=0;n<t.audio.length;n++){var o=t.audio[n];if(o.hasOwnProperty("src")===!1)throw new Error("MetadataFactory error parsing JSON: 'audio["+n+"]' doesn't have 'src' attr");if(o.hasOwnProperty("type")===!1)throw new Error("MetadataFactory error parsing JSON: 'audio["+n+"]' doesn't have 'type' attr");var i=AudioData.AudioSource.StringToType(o.type);r.AudioTracks.push(new AudioData.AudioSource(o.src,i))}return r},t.prototype.ToJSON=function(t){for(var e=[],r=0;r<t.AudioTracks.length;r++)e.push({src:t.AudioTracks[r].Url,type:t.AudioTracks[r].MimeType});return{length:t.Length,width:t.Width,height:t.Height,audio:e}},t}();t.MetadataFactory=r}(e=t.JSONAnimation||(t.JSONAnimation={}))}(VideoFormat||(VideoFormat={}));var VideoFormat;!function(t){var e;!function(t){var e=VideoData.Video,r=function(){function r(){this.commandFactory=new t.MoveCursorFactory(new t.DrawSegmentFactory(new t.ChangeBrushColorFactory(new t.ChangeBrushSizeFactory(new t.ClearCanvasFactory)))),this.chunkFactory=new t.VoidChunkFactory(new t.PathChunkFactory(new t.EraseChunkFactory)),this.metadataFactory=new t.MetadataFactory}return r.prototype.SaveVideo=function(t){var e={meta:this.metadataFactory.ToJSON(t.Metadata),chunks:[]};for(t.Rewind();t.CurrentChunk;)e.chunks.push(this.chunkFactory.ToJSON(t.CurrentChunk,this.commandFactory)),t.MoveNextChunk();return new Blob([JSON.stringify(e)],{type:"application/json"})},r.prototype.LoadVideo=function(t){var r=JSON.parse(t);if(r.hasOwnProperty("meta")===!1||r.hasOwnProperty("chunks")===!1||Array.isArray(r.chunks)===!1)throw new Error("Given JSON is not a valid JSONAnimation");var n=new e;n.Metadata=this.metadataFactory.FromJSON(r.meta);for(var o=0,i=0;i<r.chunks.length;++i){var a=this.chunkFactory.FromJSON(r.chunks[i],this.commandFactory);a.LastErase=o,n.PushChunk(a),a instanceof VideoData.EraseChunk&&(o=i)}return n.Rewind(),n},r.prototype.GetExtension=function(){return"json"},r.prototype.GetMimeType=function(){return"application/json"},r}();t.IO=r}(e=t.JSONAnimation||(t.JSONAnimation={}))}(VideoFormat||(VideoFormat={}));var VectorScreencast;!function(t){var e=VideoData.Video,r=VideoData.Mouse,n=VideoData.WacomTablet,o=VideoData.TouchEventsAPI,i=VideoData.PointerEventsAPI,a=Drawing.SVGDrawer,s=AudioData.AudioRecorder,u=Helpers.Errors,h=Helpers.ErrorType,c=Helpers.VideoEvents,l=Helpers.VideoEventType,p=VideoData.Metadata,d=Helpers.CursorState,f=function(){function t(t,p){var f=this;this.id=t,this.settings=p,this.isRecording=!1,this.timer=new Helpers.VideoTimer(!1),this.recordingBlocked=!1,this.data=new e,this.lastEraseData=0,this.recordAllRawData=void 0!==p.RecordAllRawData?!!p.RecordAllRawData:!0;var m=document.getElementById(t);if(!m)return void u.Report(h.Fatal,"Container #"+t+" doesn't exist. Video Recorder couldn't be initialised.");if(!p.ColorPallete||0===p.ColorPallete.length){var g=[];g.push(new UI.Color("white","#ffffff")),g.push(new UI.Color("red","#fa5959")),g.push(new UI.Color("green","#8cfa59")),g.push(new UI.Color("blue","#59a0fa")),g.push(new UI.Color("yellow","#fbff06")),g.push(UI.Color.BackgroundColor),p.ColorPallete=g}if(!p.BrushSizes||0===p.BrushSizes.length){var y=[];y.push(new UI.BrushSize("pixel",2,"px")),y.push(new UI.BrushSize("odd",3,"px")),y.push(new UI.BrushSize("tiny",4,"px")),y.push(new UI.BrushSize("ok",6,"px")),y.push(new UI.BrushSize("small",8,"px")),y.push(new UI.BrushSize("medium",10,"px")),y.push(new UI.BrushSize("large",15,"px")),y.push(new UI.BrushSize("extra",80,"px")),p.BrushSizes=y}if(!p.Localization){var C={NoJS:"Your browser does not support JavaScript or it is turned off. Video can't be recorded without enabled JavaScript in your browser.",Busy:"Preparing recording studio...",RecPause:"Control recording",Record:"Start",Pause:"Pause recording",Upload:"Upload",UploadInProgress:"Uploading data...",ChangeColor:"Change brush color",ChangeSize:"Change brush size",Erase:"Eraser",EraseAll:"Erase everything",WaitingText:"Please be patient. Uploading video usually takes some times - up to a few minutes if your video is over ten minutes long. Do not close this tab or browser window.",UploadWasSuccessful:"Upload was successful",RedirectPrompt:"Upload was successful - do you want to view your just recorded video?",UploadFailure:"Upload failed.",FailureApology:"We are sorry, but upload failed. Do you want to download your data to your computer instead?"};p.Localization=C}c.on(l.ChangeBrushSize,function(t){return f.ChangeBrushSize(t)}),c.on(l.ChangeColor,function(t){return f.ChangeColor(t)}),c.on(l.CursorState,function(t){return f.ProcessCursorState(t)}),c.on(l.ClearCanvas,function(t){return f.ClearCanvas(t)}),c.on(l.Start,function(){return f.Start()}),c.on(l.Continue,function(){return f.Continue()}),c.on(l.Pause,function(){return f.Pause()}),c.on(l.StartUpload,function(){return f.StartUpload()}),this.busyLevel=0,c.on(l.Busy,function(){return f.Busy()}),c.on(l.Ready,function(){return f.Ready()}),c.on(l.StartPath,function(t){f.PushChunk(new VideoData.PathChunk(t,f.timer.CurrentTime(),f.lastEraseData)),f.data.CurrentChunk.PushCommand(new VideoData.DrawNextSegment(f.timer.CurrentTime()))}),c.on(l.DrawSegment,function(){return f.data.CurrentChunk.PushCommand(new VideoData.DrawNextSegment(f.timer.CurrentTime()))});var v=y.reduce(function(t,e,r,n){return t.Size<e.Size?t:e}).Size,S=y.reduce(function(t,e,r,n){return t.Size>e.Size?t:e}).Size;this.drawer=p.DrawingStrategy?p.DrawingStrategy:new a(!0),this.dynaDraw=new Drawing.DynaDraw(function(){return f.drawer.CreatePath()},!0,v,S,this.timer),this.ui=p.UI?p.UI:new UI.RecorderUI(t),this.ui.Timer=this.timer,this.ui.Localization=p.Localization,this.ui.SetBusyText(p.Localization.Busy),this.ui.CreateHTML(!!p.Autohide,p.ColorPallete,p.BrushSizes),this.ui.AcceptCanvas(this.drawer.CreateCanvas()),m.appendChild(this.ui.GetHTML()),this.drawer.Stretch();var w=n.IsAvailable();if(window.hasOwnProperty("PointerEvent")){var P=new i(m);P.InitControlsAvoiding(),console.log("Pointer Events API is used")}else if(null!==w){{new n(m,w)}console.log("Wacom WebPAPI is used")}else{var b=new r(m);b.InitControlsAvoiding();{new o(m)}console.log("Mouse and Touch Events API are used.")}p.Audio&&(this.audioRecorder=new s(p.Audio),this.audioRecorder.Init()),this.currColor=UI.Color.ForegroundColor,this.currSize=y.length>0?y[0]:new UI.BrushSize("default",5,"px"),this.lastCurState=new d(0,0,0,0),this.ClearCanvas(UI.Color.BackgroundColor),c.trigger(l.ChangeColor,this.currColor),c.trigger(l.ChangeBrushSize,this.currSize)}return t.prototype.Start=function(){this.isRecording===!1&&(this.isRecording=!0,this.PushChunk(new VideoData.VoidChunk(this.timer.CurrentTime(),this.lastEraseData)),this.timer.Resume(),this.audioRecorder&&this.audioRecorder.Start())},t.prototype.Pause=function(){this.isRecording===!0&&(this.isRecording=!1,this.PushChunk(new VideoData.VoidChunk(this.timer.CurrentTime(),this.lastEraseData)),this.timer.Pause(),this.audioRecorder&&this.audioRecorder.Pause())},t.prototype.Continue=function(){this.isRecording=!0,this.timer.Resume(),this.audioRecorder&&this.audioRecorder.Continue(),this.PushChunk(new VideoData.VoidChunk(this.timer.CurrentTime(),this.lastEraseData))},t.prototype.StartUpload=function(){var t=this;this.recordingBlocked=!0;var e=new p;e.Length=this.timer.CurrentTime(),e.Width=this.ui.Width,e.Height=this.ui.Height,e.AudioTracks=[],this.data.Metadata=e,this.audioRecorder&&this.audioRecorder.isRecording()?this.audioRecorder.Stop(function(e){t.data.Metadata.AudioTracks=e,t.UploadData()},function(){t.FinishRecording(!1)}):this.UploadData()},t.prototype.ChangeBrushSize=function(t){this.currSize=t,!this.recordingBlocked&&this.data.CurrentChunk.PushCommand(new VideoData.ChangeBrushSize(t,this.timer.CurrentTime())),this.dynaDraw.SetBrushSize(t)},t.prototype.ChangeColor=function(t){this.currColor=t,!this.recordingBlocked&&this.data.CurrentChunk.PushCommand(new VideoData.ChangeBrushColor(t,this.timer.CurrentTime())),this.drawer.SetCurrentColor(t)},t.prototype.ProcessCursorState=function(t){this.lastCurState=t,!this.recordingBlocked&&(this.recordAllRawData||this.isRecording)&&this.data.CurrentChunk.PushCommand(new VideoData.MoveCursor(t.X,t.Y,this.recordAllRawData?t.Pressure:0,this.timer.CurrentTime())),this.dynaDraw.ObserveCursorMovement(t)},t.prototype.ClearCanvas=function(t){var e=this.timer.CurrentTime();this.lastEraseData=this.PushChunk(new VideoData.EraseChunk(t,e,this.lastEraseData)),this.data.CurrentChunk.PushCommand(new VideoData.ClearCanvas(e,t)),this.drawer.ClearCanvas(t)},t.prototype.PushChunk=function(t){return t.InitCommands.push(new VideoData.ChangeBrushSize(this.currSize,t.StartTime)),t.InitCommands.push(new VideoData.ChangeBrushColor(this.currColor,t.StartTime)),t.InitCommands.push(new VideoData.MoveCursor(this.lastCurState.X,this.lastCurState.Y,this.lastCurState.Pressure,t.StartTime)),this.data.PushChunk(t)},t.prototype.Busy=function(){this.busyLevel++,this.wasRecordingWhenBusy=this.wasRecordingWhenBusy||this.isRecording,c.trigger(l.Pause),this.ui.Busy()},t.prototype.Ready=function(){0===--this.busyLevel&&(this.wasRecordingWhenBusy===!0&&(c.trigger(l.Start),this.wasRecordingWhenBusy=!1),this.ui.Ready())},t.prototype.UploadData=function(){var t=this,e=this.settings.VideoFormat?this.settings.VideoFormat:new VideoFormat.SVGAnimation.IO,r=e.SaveVideo(this.data);

console.log(r),c.on(l.DownloadData,function(){Helpers.File.Download(r,"recorded-animation."+e.GetExtension())}),this.ui.SetBusyText(this.settings.Localization.UploadInProgress),c.trigger(l.Busy);var n=new FormData;n.append("extension",e.GetExtension()),n.append("file",r);var o=new XMLHttpRequest;o.open("POST",this.settings.UploadURL,!0),o.onerror=function(e){return t.FinishRecording(!1)},o.onload=function(e){var r=JSON.parse(o.response);if(200===o.status&&r.hasOwnProperty("success")&&r.success===!0){var n=r.hasOwnProperty("redirect")?r.redirect:!1;t.FinishRecording(!0,n)}else t.FinishRecording(!1)},o.send(n)},t.prototype.FinishRecording=function(t,e){c.trigger(l.RecordingFinished),t===!0?(this.ui.SetBusyText(this.settings.Localization.UploadWasSuccessful),"string"==typeof e?confirm(this.settings.Localization.RedirectPrompt)&&window.location.replace(e):alert(this.settings.Localization.UploadWasSuccessful)):(this.ui.SetBusyText(this.settings.Localization.UploadFailure),confirm(this.settings.Localization.FailureApology)&&c.trigger(l.DownloadData))},t}();t.Recorder=f}(VectorScreencast||(VectorScreencast={}));