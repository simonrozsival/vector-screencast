<!DOCTYPE html>
<html lang="cs">
	<head>
		<title>TEST - HTML5 audio</title>
		<meta charset="UTF-8">
		<meta name=description content="">
		<meta name=viewport content="width=device-width, initial-scale=1">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<!-- Bootstrap CSS -->
		<!--link href="http://netdna.bootstrapcdn.com/bootstrap/3.1.0/css/bootstrap.min.css" rel="stylesheet" media="screen"-->
		<link href="../../css/bootstrap.min.css" rel="stylesheet" media="screen">
	</head>
	<body>
		<div class="container">
			<div class="row">
				<div class="col-xs-12">
					<h1 class="text-center">HTML5 audio test</h1>

					<button class="btn btn-success" id="play-pause-button">
						play / pause
					</button>
				</div>
			</div>

			<div id="tester-container">
				<!-- tester will be placed here -->				
			</div>
		</div>

		<!-- jQuery -->
		<!--script src="http://code.jquery.com/jquery.js"></script-->
		<script src="../libs/jquery.js"></script>

		<!-- Helper objects -->
		<script src="../helpers/video-events.js"></script>

		<!-- Tester object -->
		<script src="tester.js"></script>

		<!-- Khan Academy - Audio Player -->
		<script src="../data-providers/audio-player.js"></script>
		<script type="text/javascript">
		$(function(){

			var container = $("#tester-container");
			VideoEvents.init(container);

			var tester = new Tester(container);

			// tests:
			var btn = $("#play-pause-button");
			var playPauseButtonClickCounter = 0;


			var player = new AudioPlayer({
				"mpeg": "../../data/demo.mp3"
			}, {
				ended: function() {
					tester.reportSuccess("The whole audio track was played aloud. Audio player works.");
					tester.log("clicking the button again, it should rewind itself and play again");
					btn.trigger("click");
					setTimeout(function(){
						tester.log("clicking the button again, it should pause.");
						btn.trigger("click");
					}, 4000);
				},
				play: function() {
					if(playPauseButtonClickCounter == 1) {
						tester.reportSuccess("The player <b>started</b> playing after the button was clicked.");
					} else if (playPauseButtonClickCounter == 3) {
						tester.reportSuccess("The player <b>resumed</b> playing after the button was clicked.");
					} else if (playPauseButtonClickCounter == 4) {
						tester.reportSuccess("The player starts from the begining after <b>rewinding</b> the track.");
					} 
				},
				pause: function() {
					if(playPauseButtonClickCounter == 2) {
						tester.reportSuccess("The player <b>paused</b> playing after the button was clicked.");
					}
				}
			});

			tester.start(6, 17*1000);

			if(!player.isReady()) {
				tester.reportError("Can't play the audio file. Check console log for more details.");
			} else {
				tester.reportSuccess("Init was successful.");

				var playing = false;
				btn.on("click", function() { 
					playPauseButtonClickCounter++;
					playing = !playing;
					var eventName = playing == false ? "pause" : "play";
					VideoEvents.trigger(eventName);
				});

				tester.log("clicking the play/pause button virtually");
				btn.trigger("click"); // play
				setTimeout(function() {
					tester.log("clicking the play/pause button virtually again");
					btn.trigger("click"); // pause

					setTimeout(function() {
						tester.log("clicking the play/pause button virtually for the third time");
						btn.trigger("click"); // play again
					}, 1000);
				}, 1000);
			}

		});
		</script>
	</body>
</html>