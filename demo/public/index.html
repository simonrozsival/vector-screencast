<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta name="robots" value="noindex, nofollow"> <!-- this is just a demo app, no indexing by search engines please -->
        <title>List of all available videos</title>

        <!-- CSS -->
        <link rel="stylesheet" media="screen,projection,tv" href="/css/demo-skin.css">
        <link rel="shortcut icon" href="/favicon.ico">
    </head>
    <body>
        <header id="header">
    		<h1>Vector Screencast Project</h1>
    		<p>This is a Vector Video project DEMO by Šimon Rozsíval.</p>
            <p><a href="record.html" class="btn">Record new video</a></p>
        </header>
        
        <div id="page-body">
    		<table>
    			<thead>
                    <tr>
    				    <th>Title</th><th>Author</th><th>Tags</th><th>Embed</th><th></th>
                    </tr>
    			</thead>
    			<tbody id="data">				
                    <tr>
                        <td>(data is being loaded)</td>
                    </tr>
    			</tbody>
    		</table>
        </div>
        
        <footer id="footer">
            <p><a href="http://github.com/simonrozsival/vectorvideo">View on GitHub</a></p>
        </footer>
			
        <!-- initialisation script -->
        <script>
        // wait until the DOM is loaded and ready
        window.onload = function() {
            var req = new XMLHttpRequest();
            req.open("get", "/recordings-list.json", true);
            req.onreadystatechange = function(data) {
                if(req.status === 200 && req.readyState === 4) {
                    var db = JSON.parse(req.response);
                    if(!db || !db.hasOwnProperty("recordings") || !Array.isArray(db.recordings)) {
                        alert("Database is corrupted.");
                    } else {
                        // read all the records from the DB and add them to the table
                        for(var i = 0; i < db.recordings.length; ++i) {
                            addRecordingRow(db.recordings[i]);
                        }                        
                    }
                }
            }
            req.send();
            
            var data = document.getElementById("data");
            while (!!data.firstChild) {
                data.removeChild(data.firstChild);
            }
            
            /**
             * Turn a DB record into a row of the table.
             * @param {Object}  rec     Recording record from the DB.
             */
            function addRecordingRow(rec) {
                var row = document.createElement("tr");
                
                var td = document.createElement("td");
                td.textContent = decodeURIComponent(rec.author);
                row.appendChild(td);
                                
                td = document.createElement("td");
                td.textContent = decodeURIComponent(rec.title);
                row.appendChild(td);
                
                td = document.createElement("td");
                td.classList.add("tags");
                for(var i = 0; i < rec.tags.length; ++i) {
                    var tag = rec.tags[i];
                    var a = document.createElement("a");
                    a.href = "#" + tag;
                    a.textContent = decodeURIComponent(tag);
                    td.appendChild(a);
                }                
                row.appendChild(td);
                
                //
                // The EMBED HTML snippet
                //
                td = document.createElement("td");
                var input = document.createElement("input");
                input.type = "text";
                input.value = '<iframe src="' + document.location.origin + '/play.html?source=' + decodeURIComponent(rec.src) + '" width="600" height="400"></iframe>';
                td.appendChild(input);
                row.appendChild(td);
                
                //
                // Link - Play the screencast
                //
                td = document.createElement("td");
                var a = document.createElement("a");
                a.href = "play.html?source=" + decodeURIComponent(rec.src);
                a.classList.add("btn");
                a.textContent = "Play screencast";
                td.appendChild(a);
                row.appendChild(td);
                
                
                data.appendChild(row);
            }
        };
        </script>
    </body>
</html>
